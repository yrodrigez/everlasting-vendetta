(()=>{"use strict";var t,e;window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)},jQuery.support.cors=!0,$.ajaxTransport?($.ajaxSetup({flatOptions:{renderer:!0}}),$.ajaxTransport("+binary",function(t,e,i){if(window.FormData&&(t.dataType&&"binary"==t.dataType||t.data&&(window.ArrayBuffer&&t.data instanceof ArrayBuffer||window.Blob&&t.data instanceof Blob)))return{send:function(e,i){var s=new XMLHttpRequest,r=t.url,n=t.type,a=t.responseType||"blob",o=t.data||null;t.renderer&&s.addEventListener("progress",function(e){e.lengthComputable&&(t.renderer.downloads[this.responseURL]?t.renderer.downloads[this.responseURL].loaded=e.loaded:t.renderer.downloads[this.responseURL]={loaded:e.loaded,total:e.total},t.renderer.updateProgress())}),s.addEventListener("load",function(){t.renderer&&(delete t.renderer.downloads[this.responseURL],t.renderer.updateProgress());var e={};e[t.dataType]=s.response,i(s.status,s.statusText,e,s.getAllResponseHeaders())}),s.open(n,r,!0),s.responseType=a,s.send(o)},abort:function(){i.abort()}}})):(t=$.httpData,$.httpData=function(e,i,s){return"binary"==i?e.response:t(e,i,s)},$.ajaxSetup({beforeSend:function(t,e){"binary"==e.dataType&&(t.responseType=e.responseType||"arraybuffer",t.addEventListener("progress",function(t){e.renderer&&t.lengthComputable&&(e.renderer.downloads[this.responseURL]?e.renderer.downloads[this.responseURL].loaded=t.loaded:e.renderer.downloads[this.responseURL]={loaded:t.loaded,total:t.total},e.renderer.updateProgress())},!1),t.addEventListener("load",function(){e.renderer&&(delete e.renderer.downloads[this.responseURL],e.renderer.updateProgress())},!1))}})),Math.randomInt=Math.randomInt||function(t,e){return Math.floor(Math.random()*(e-t))+t},"function"!=typeof Object.create&&(Object.create=(e=function(){},function(t){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof t)throw TypeError("Argument must be an object");e.prototype=t;var i=new e;return e.prototype=null,i})),window.console=window.console||{log:function(){},error:function(){},warn:function(){}};let i=Float32Array;function s(t,e,s){const r=new i(3);return t&&(r[0]=t),e&&(r[1]=e),s&&(r[2]=s),r}function r(t,e,s){return(s=s||new i(3))[0]=t[0]+e[0],s[1]=t[1]+e[1],s[2]=t[2]+e[2],s}function n(t,e,s){return(s=s||new i(3))[0]=t[0]*e[0],s[1]=t[1]*e[1],s[2]=t[2]*e[2],s}let a=Float32Array;function o(t){return(t=t||new a(16))[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function h(t,e){e=e||new a(16);const i=t[0],s=t[1],r=t[2],n=t[3],o=t[4],h=t[5],l=t[6],u=t[7],c=t[8],d=t[9],f=t[10],g=t[11],_=t[12],b=t[13],p=t[14],m=t[15],x=f*m,v=p*g,T=l*m,w=p*u,y=l*g,E=f*u,A=r*m,C=p*n,M=r*g,S=f*n,F=r*u,k=l*n,I=c*b,D=_*d,U=o*b,R=_*h,B=o*d,O=c*h,P=i*b,z=_*s,G=i*d,L=c*s,N=i*h,j=o*s,H=x*h+w*d+y*b-(v*h+T*d+E*b),q=v*s+A*d+S*b-(x*s+C*d+M*b),V=T*s+C*h+F*b-(w*s+A*h+k*b),X=E*s+M*h+k*d-(y*s+S*h+F*d),Y=1/(i*H+o*q+c*V+_*X);return e[0]=Y*H,e[1]=Y*q,e[2]=Y*V,e[3]=Y*X,e[4]=Y*(v*o+T*c+E*_-(x*o+w*c+y*_)),e[5]=Y*(x*i+C*c+M*_-(v*i+A*c+S*_)),e[6]=Y*(w*i+A*o+k*_-(T*i+C*o+F*_)),e[7]=Y*(y*i+S*o+F*c-(E*i+M*o+k*c)),e[8]=Y*(I*u+R*g+B*m-(D*u+U*g+O*m)),e[9]=Y*(D*n+P*g+L*m-(I*n+z*g+G*m)),e[10]=Y*(U*n+z*u+N*m-(R*n+P*u+j*m)),e[11]=Y*(O*n+G*u+j*g-(B*n+L*u+N*g)),e[12]=Y*(U*f+O*p+D*l-(B*p+I*l+R*f)),e[13]=Y*(G*p+I*r+z*f-(P*f+L*p+D*r)),e[14]=Y*(P*l+j*p+R*r-(N*p+U*r+z*l)),e[15]=Y*(N*f+B*r+L*l-(G*l+j*f+O*r)),e}function l(t,e,i){i=i||s();const r=e[0],n=e[1],a=e[2],o=r*t[3]+n*t[7]+a*t[11]+t[15];return i[0]=(r*t[0]+n*t[4]+a*t[8]+t[12])/o,i[1]=(r*t[1]+n*t[5]+a*t[9]+t[13])/o,i[2]=(r*t[2]+n*t[6]+a*t[10]+t[14])/o,i}function u(t,e,i){i=i||s();const r=e[0],n=e[1],a=e[2];return i[0]=r*t[0]+n*t[4]+a*t[8],i[1]=r*t[1]+n*t[5]+a*t[9],i[2]=r*t[2]+n*t[6]+a*t[10],i}const c=5120,d=5121,f=5122,g=5123,_=5124,b=5125,p=5126,m={};{const t=m;t[5120]=Int8Array,t[5121]=Uint8Array,t[5122]=Int16Array,t[5123]=Uint16Array,t[5124]=Int32Array,t[5125]=Uint32Array,t[5126]=Float32Array,t[32819]=Uint16Array,t[32820]=Uint16Array,t[33635]=Uint16Array,t[5131]=Uint16Array,t[33640]=Uint32Array,t[35899]=Uint32Array,t[35902]=Uint32Array,t[36269]=Uint32Array,t[34042]=Uint32Array}function x(t){if(t instanceof Int8Array)return c;if(t instanceof Uint8Array)return d;if(t instanceof Uint8ClampedArray)return d;if(t instanceof Int16Array)return f;if(t instanceof Uint16Array)return g;if(t instanceof Int32Array)return _;if(t instanceof Uint32Array)return b;if(t instanceof Float32Array)return p;throw new Error("unsupported typed array type")}function v(t){if(t===Int8Array)return c;if(t===Uint8Array)return d;if(t===Uint8ClampedArray)return d;if(t===Int16Array)return f;if(t===Uint16Array)return g;if(t===Int32Array)return _;if(t===Uint32Array)return b;if(t===Float32Array)return p;throw new Error("unsupported typed array type")}function T(t){const e=m[t];if(!e)throw new Error("unknown gl type");return e}const w="undefined"!=typeof SharedArrayBuffer?function(t){return t&&t.buffer&&(t.buffer instanceof ArrayBuffer||t.buffer instanceof SharedArrayBuffer)}:function(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer};function y(...t){console.error(...t)}const E=new Map;function A(t,e){if(!t||"object"!=typeof t)return!1;let i=E.get(e);i||(i=new WeakMap,E.set(e,i));let s=i.get(t);if(void 0===s){const r=Object.prototype.toString.call(t);s=r.substring(8,r.length-1)===e,i.set(t,s)}return s}function C(t,e){return"undefined"!=typeof WebGLTexture&&A(e,"WebGLTexture")}const M=34962,S={attribPrefix:""};function F(t,e,i,s,r){t.bindBuffer(e,i),t.bufferData(e,s,r||35044)}function k(t,e,i,s){if(r=e,"undefined"!=typeof WebGLBuffer&&A(r,"WebGLBuffer"))return e;var r;i=i||M;const n=t.createBuffer();return F(t,i,n,e,s),n}function I(t){return"indices"===t}function D(t){return t.length?t:t.data}const U=/coord|texture/i,R=/color|colour/i;function B(t,e,i){return t.numComponents||t.size||function(t,e){let i;if(i=U.test(t)?2:R.test(t)?4:3,e%i>0)throw new Error(`Can not guess numComponents for attribute '${t}'. Tried ${i} but ${e} values is not evenly divisible by ${i}. You should specify it.`);return i}(e,i||D(t).length)}function O(t,e){if(w(t))return t;if(w(t.data))return t.data;Array.isArray(t)&&(t={data:t});let i=t.type?P(t.type):void 0;return i||(i=I(e)?Uint16Array:Float32Array),new i(t.data)}function P(t){return"number"==typeof t?T(t):t||Float32Array}function z(t,e){return{buffer:e.buffer,numValues:24,type:(i=e.type,"number"==typeof i?i:i?v(i):5126),arrayType:P(e.type)};var i}function G(t,e){const i=e.data||e,s=P(e.type),r=i*s.BYTES_PER_ELEMENT,n=t.createBuffer();return t.bindBuffer(M,n),t.bufferData(M,r,e.drawType||35044),{buffer:n,numValues:i,type:v(s),arrayType:s}}function L(t,e,i){const s=O(e,i);return{arrayType:s.constructor,buffer:k(t,s,void 0,e.drawType),type:x(s),numValues:0}}function N(t,e){const i={};return Object.keys(e).forEach(function(s){if(!I(s)){const n=e[s],a=n.attrib||n.name||n.attribName||S.attribPrefix+s;if(n.value){if(!Array.isArray(n.value)&&!w(n.value))throw new Error("array.value is not array or typedarray");i[a]={value:n.value}}else{let e;e=n.buffer&&n.buffer instanceof WebGLBuffer?z:"number"==typeof n||"number"==typeof n.data?G:L;const{buffer:o,type:h,numValues:l,arrayType:u}=e(t,n,s),c=void 0!==n.normalize?n.normalize:(r=u)===Int8Array||r===Uint8Array,d=B(n,s,l);i[a]={buffer:o,numComponents:d,type:h,normalize:c,stride:n.stride||0,offset:n.offset||0,divisor:void 0===n.divisor?void 0:n.divisor,drawType:n.drawType}}}var r}),t.bindBuffer(M,null),i}const j=["position","positions","a_position"];function H(t,e,i){const s=N(t,e),r=Object.assign({},i||{});r.attribs=Object.assign({},i?i.attribs:{},s);const n=e.indices;if(n){const e=O(n,"indices");r.indices=k(t,e,34963),r.numElements=e.length,r.elementType=x(e)}else r.numElements||(r.numElements=function(t,e){let i,s;for(s=0;s<j.length&&(i=j[s],!(i in e))&&(i=S.attribPrefix+i,!(i in e));++s);s===j.length&&(i=Object.keys(e)[0]);const r=e[i];if(!r.buffer)return 1;t.bindBuffer(M,r.buffer);const n=t.getBufferParameter(M,34660);var a;t.bindBuffer(M,null);const o=n/(5120===(a=r.type)||5121===a?1:5122===a||5123===a?2:5124===a||5125===a||5126===a?4:0),h=r.numComponents||r.size,l=o/h;if(l%1!=0)throw new Error(`numComponents ${h} not correct for length ${length}`);return l}(t,r.attribs));return r}function q(t,e,i){const s="indices"===i?34963:M;return k(t,O(e,i),s)}function V(t,e){const i={};return Object.keys(e).forEach(function(s){i[s]=q(t,e[s],s)}),e.indices?(i.numElements=e.indices.length,i.elementType=x(O(e.indices))):i.numElements=function(t){let e,i;for(i=0;i<j.length&&(e=j[i],!(e in t));++i);i===j.length&&(e=Object.keys(t)[0]);const s=t[e],r=D(s).length;if(void 0===r)return 1;const n=B(s,e),a=r/n;if(r%n>0)throw new Error(`numComponents ${n} not correct for length ${r}`);return a}(e),i}function X(t,e){let i=0;return t.push=function(){for(let e=0;e<arguments.length;++e){const s=arguments[e];if(s instanceof Array||w(s))for(let e=0;e<s.length;++e)t[i++]=s[e];else t[i++]=s}},t.reset=function(t){i=t||0},t.numComponents=e,Object.defineProperty(t,"numElements",{get:function(){return this.length/this.numComponents|0}}),t}function Y(t,e,i){return X(new(i||Float32Array)(t*e),t)}function W(t,e,i){const s=t.length,r=new Float32Array(3);for(let n=0;n<s;n+=3)i(e,[t[n],t[n+1],t[n+2]],r),t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2]}function K(t,e,i){i=i||s();const r=e[0],n=e[1],a=e[2];return i[0]=r*t[0]+n*t[1]+a*t[2],i[1]=r*t[4]+n*t[5]+a*t[6],i[2]=r*t[8]+n*t[9]+a*t[10],i}function Z(t,e){return W(t,e,u),t}function Q(t,e){return W(t,h(e),K),t}function J(t,e){return W(t,e,l),t}function tt(t,e){return Object.keys(t).forEach(function(i){const s=t[i];i.indexOf("pos")>=0?J(s,e):i.indexOf("tan")>=0||i.indexOf("binorm")>=0?Z(s,e):i.indexOf("norm")>=0&&Q(s,e)}),t}function et(t,e,i){return t=t||2,{position:{numComponents:2,data:[(e=e||0)+-1*(t*=.5),(i=i||0)+-1*t,e+1*t,i+-1*t,e+-1*t,i+1*t,e+1*t,i+1*t]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function it(t,e,i,s,r){t=t||1,e=e||1,i=i||1,s=s||1,r=r||o();const n=(i+1)*(s+1),a=Y(3,n),h=Y(3,n),l=Y(2,n);for(let r=0;r<=s;r++)for(let n=0;n<=i;n++){const o=n/i,u=r/s;a.push(t*o-.5*t,0,e*u-.5*e),h.push(0,1,0),l.push(o,u)}const u=i+1,c=Y(3,i*s*2,Uint16Array);for(let t=0;t<s;t++)for(let e=0;e<i;e++)c.push((t+0)*u+e,(t+1)*u+e,(t+0)*u+e+1),c.push((t+1)*u+e,(t+1)*u+e+1,(t+0)*u+e+1);return tt({position:a,normal:h,texcoord:l,indices:c},r)}function st(t,e,i,s,r,n,a){if(e<=0||i<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");s=s||0,n=n||0;const o=(r=r||Math.PI)-s,h=(a=a||2*Math.PI)-n,l=(e+1)*(i+1),u=Y(3,l),c=Y(3,l),d=Y(2,l);for(let r=0;r<=i;r++)for(let a=0;a<=e;a++){const l=a/e,f=r/i,g=h*l+n,_=o*f+s,b=Math.sin(g),p=Math.cos(g),m=Math.sin(_),x=p*m,v=Math.cos(_),T=b*m;u.push(t*x,t*v,t*T),c.push(x,v,T),d.push(1-l,f)}const f=e+1,g=Y(3,e*i*2,Uint16Array);for(let t=0;t<e;t++)for(let e=0;e<i;e++)g.push((e+0)*f+t,(e+0)*f+t+1,(e+1)*f+t),g.push((e+1)*f+t,(e+0)*f+t+1,(e+1)*f+t+1);return{position:u,normal:c,texcoord:d,indices:g}}const rt=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function nt(t){const e=(t=t||1)/2,i=[[-e,-e,-e],[+e,-e,-e],[-e,+e,-e],[+e,+e,-e],[-e,-e,+e],[+e,-e,+e],[-e,+e,+e],[+e,+e,+e]],s=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],r=[[1,0],[0,0],[0,1],[1,1]],n=Y(3,24),a=Y(3,24),o=Y(2,24),h=Y(3,12,Uint16Array);for(let t=0;t<6;++t){const e=rt[t];for(let h=0;h<4;++h){const l=i[e[h]],u=s[t],c=r[h];n.push(l),a.push(u),o.push(c)}const l=4*t;h.push(l+0,l+1,l+2),h.push(l+0,l+2,l+3)}return{position:n,normal:a,texcoord:o,indices:h}}function at(t,e,i,s,r,n,a){if(s<3)throw new Error("radialSubdivisions must be 3 or greater");if(r<1)throw new Error("verticalSubdivisions must be 1 or greater");const o=void 0===n||n,h=void 0===a||a,l=(o?2:0)+(h?2:0),u=(s+1)*(r+1+l),c=Y(3,u),d=Y(3,u),f=Y(2,u),g=Y(3,s*(r+l/2)*2,Uint16Array),_=s+1,b=Math.atan2(t-e,i),p=Math.cos(b),m=Math.sin(b),x=r+(h?2:0);for(let n=o?-2:0;n<=x;++n){let a,o=n/r,h=i*o;n<0?(h=0,o=1,a=t):n>r?(h=i,o=1,a=e):a=t+n/r*(e-t),-2!==n&&n!==r+2||(a=0,o=0),h-=i/2;for(let t=0;t<_;++t){const e=Math.sin(t*Math.PI*2/s),i=Math.cos(t*Math.PI*2/s);c.push(e*a,h,i*a),n<0?d.push(0,-1,0):n>r?d.push(0,1,0):0===a?d.push(0,0,0):d.push(e*p,m,i*p),f.push(t/s,1-o)}}for(let t=0;t<r+l;++t)if(!(1===t&&o||t===r+l-2&&h))for(let e=0;e<s;++e)g.push(_*(t+0)+0+e,_*(t+0)+1+e,_*(t+1)+1+e),g.push(_*(t+0)+0+e,_*(t+1)+1+e,_*(t+1)+0+e);return{position:c,normal:d,texcoord:f,indices:g}}function ot(t,e){e=e||[];const i=[];for(let s=0;s<t.length;s+=4){const r=t[s],n=t.slice(s+1,s+4);n.push.apply(n,e);for(let t=0;t<r;++t)i.push.apply(i,n)}return i}function ht(){const t=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],e=ot([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),i=ot([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),s=t.length/3,r={position:Y(3,s),texcoord:Y(2,s),normal:Y(3,s),color:Y(4,s,Uint8Array),indices:Y(3,s/3,Uint16Array)};r.position.push(t),r.texcoord.push([.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0]),r.normal.push(e),r.color.push(i);for(let t=0;t<s;++t)r.indices.push(t);return r}function lt(t,e,i,s,a,o,h){if(a<=0)throw new Error("subdivisionDown must be > 0");const l=(h=h||1)-(o=o||0),u=2*(a+1)*4,c=Y(3,u),d=Y(3,u),f=Y(2,u);function g(t,e,i){return t+(e-t)*i}function _(e,i,h,u,_,b){for(let p=0;p<=a;p++){const m=i/1,x=p/a,v=2*(m-.5),T=(o+x*l)*Math.PI,w=Math.sin(T),y=Math.cos(T),E=g(t,e,w),A=v*s,C=y*t,M=w*E;c.push(A,C,M);const S=r(n([0,w,y],h),u);d.push(S),f.push(m*_+b,x)}}for(let t=0;t<2;t++){const s=2*(t/1-.5);_(e,t,[1,1,1],[0,0,0],1,0),_(e,t,[0,0,0],[s,0,0],0,0),_(i,t,[1,1,1],[0,0,0],1,0),_(i,t,[0,0,0],[s,0,0],0,1)}const b=Y(3,2*a*4,Uint16Array);function p(t,e){for(let i=0;i<a;++i)b.push(t+i+0,t+i+1,e+i+0),b.push(t+i+1,e+i+1,e+i+0)}const m=a+1;return p(0*m,4*m),p(5*m,7*m),p(6*m,2*m),p(3*m,1*m),{position:c,normal:d,texcoord:f,indices:b}}function ut(t,e,i,s,r,n){return at(t,t,e,i,s,r,n)}function ct(t,e,i,s,r,n){if(i<3)throw new Error("radialSubdivisions must be 3 or greater");if(s<3)throw new Error("verticalSubdivisions must be 3 or greater");r=r||0;const a=(n=n||2*Math.PI)-r,o=i+1,h=s+1,l=o*h,u=Y(3,l),c=Y(3,l),d=Y(2,l),f=Y(3,i*s*2,Uint16Array);for(let n=0;n<h;++n){const h=n/s,l=h*Math.PI*2,f=Math.sin(l),g=t+f*e,_=Math.cos(l),b=_*e;for(let t=0;t<o;++t){const e=t/i,s=r+e*a,n=Math.sin(s),o=Math.cos(s),l=n*g,p=o*g,m=n*f,x=o*f;u.push(l,b,p),c.push(m,_,x),d.push(e,1-h)}}for(let t=0;t<s;++t)for(let e=0;e<i;++e){const i=1+e,s=1+t;f.push(o*t+e,o*s+e,o*t+i),f.push(o*s+e,o*s+i,o*t+i)}return{position:u,normal:c,texcoord:d,indices:f}}function dt(t,e,i,s,r){if(e<3)throw new Error("divisions must be at least 3");r=r||1,s=s||0;const n=(e+1)*((i=i||1)+1),a=Y(3,n),o=Y(3,n),h=Y(2,n),l=Y(3,i*e*2,Uint16Array);let u=0;const c=t-s,d=e+1;for(let t=0;t<=i;++t){const n=s+c*Math.pow(t/i,r);for(let s=0;s<=e;++s){const r=2*Math.PI*s/e,c=n*Math.cos(r),f=n*Math.sin(r);if(a.push(c,0,f),o.push(0,1,0),h.push(1-s/e,t/i),t>0&&s!==e){const t=u+(s+1),e=u+s,i=u+s-d,r=u+(s+1)-d;l.push(t,e,i),l.push(t,i,r)}}u+=e+1}return{position:a,normal:o,texcoord:h,indices:l}}function ft(t){return function(e){return V(e,t.apply(this,Array.prototype.slice.call(arguments,1)))}}function gt(t){return function(e){return H(e,t.apply(null,Array.prototype.slice.call(arguments,1)))}}gt(ht),ft(ht),gt(nt),ft(nt),gt(it),ft(it),gt(st),ft(st),gt(at),ft(at),gt(et),ft(et),gt(lt),ft(lt),gt(ut),ft(ut),gt(ct),ft(ct),gt(dt),ft(dt);function _t(t){return!!t.texStorage2D}const bt=function(){const t={},e={};return function(i,s){return function(i){const s=i.constructor.name;if(!t[s]){for(const t in i)if("number"==typeof i[t]){const s=e[i[t]];e[i[t]]=s?`${s} | ${t}`:t}t[s]=!0}}(i),e[s]||("number"==typeof s?`0x${s.toString(16)}`:s)}}();new Uint8Array([128,192,255,255]),function(){let t}();const pt=6407,mt=33319,xt=6403,vt={};{const t=vt;t[6406]={numColorComponents:1},t[6409]={numColorComponents:1},t[6410]={numColorComponents:2},t[pt]={numColorComponents:3},t[6408]={numColorComponents:4},t[xt]={numColorComponents:1},t[36244]={numColorComponents:1},t[mt]={numColorComponents:2},t[33320]={numColorComponents:2},t[pt]={numColorComponents:3},t[36248]={numColorComponents:3},t[6408]={numColorComponents:4},t[36249]={numColorComponents:4},t[6402]={numColorComponents:1},t[34041]={numColorComponents:2}}const Tt=y;function wt(t){return"undefined"!=typeof document&&document.getElementById?document.getElementById(t):null}const yt=33984,Et=34962,At=5126,Ct=5124,Mt=5125,St=3553,Ft=34067,kt=32879,It=35866,Dt={};function Ut(t,e){return Dt[e].bindPoint}function Rt(t,e){return function(i){t.uniform1i(e,i)}}function Bt(t,e){return function(i){t.uniform1iv(e,i)}}function Ot(t,e){return function(i){t.uniform2iv(e,i)}}function Pt(t,e){return function(i){t.uniform3iv(e,i)}}function zt(t,e){return function(i){t.uniform4iv(e,i)}}function Gt(t,e,i,s){const r=Ut(0,e);return _t(t)?function(e){let n,a;!e||C(0,e)?(n=e,a=null):(n=e.texture,a=e.sampler),t.uniform1i(s,i),t.activeTexture(yt+i),t.bindTexture(r,n),t.bindSampler(i,a)}:function(e){t.uniform1i(s,i),t.activeTexture(yt+i),t.bindTexture(r,e)}}function Lt(t,e,i,s,r){const n=Ut(0,e),a=new Int32Array(r);for(let t=0;t<r;++t)a[t]=i+t;return _t(t)?function(e){t.uniform1iv(s,a),e.forEach(function(e,s){let r,o;t.activeTexture(yt+a[s]),!e||C(0,e)?(r=e,o=null):(r=e.texture,o=e.sampler),t.bindSampler(i,o),t.bindTexture(n,r)})}:function(e){t.uniform1iv(s,a),e.forEach(function(e,i){t.activeTexture(yt+a[i]),t.bindTexture(n,e)})}}function Nt(t,e){return function(i){if(i.value)switch(t.disableVertexAttribArray(e),i.value.length){case 4:t.vertexAttrib4fv(e,i.value);break;case 3:t.vertexAttrib3fv(e,i.value);break;case 2:t.vertexAttrib2fv(e,i.value);break;case 1:t.vertexAttrib1fv(e,i.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else t.bindBuffer(Et,i.buffer),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,i.numComponents||i.size,i.type||At,i.normalize||!1,i.stride||0,i.offset||0),t.vertexAttribDivisor&&t.vertexAttribDivisor(e,i.divisor||0)}}function jt(t,e){return function(i){if(i.value){if(t.disableVertexAttribArray(e),4!==i.value.length)throw new Error("The length of an integer constant value must be 4!");t.vertexAttrib4iv(e,i.value)}else t.bindBuffer(Et,i.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,i.numComponents||i.size,i.type||Ct,i.stride||0,i.offset||0),t.vertexAttribDivisor&&t.vertexAttribDivisor(e,i.divisor||0)}}function Ht(t,e){return function(i){if(i.value){if(t.disableVertexAttribArray(e),4!==i.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");t.vertexAttrib4uiv(e,i.value)}else t.bindBuffer(Et,i.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,i.numComponents||i.size,i.type||Mt,i.stride||0,i.offset||0),t.vertexAttribDivisor&&t.vertexAttribDivisor(e,i.divisor||0)}}function qt(t,e,i){const s=i.size,r=i.count;return function(i){t.bindBuffer(Et,i.buffer);const n=i.size||i.numComponents||s,a=n/r,o=i.type||At,h=Dt[o].size*n,l=i.normalize||!1,u=i.offset||0,c=h/r;for(let s=0;s<r;++s)t.enableVertexAttribArray(e+s),t.vertexAttribPointer(e+s,a,o,l,h,u+c*s),t.vertexAttribDivisor&&t.vertexAttribDivisor(e+s,i.divisor||0)}}Dt[5126]={Type:Float32Array,size:4,setter:function(t,e){return function(i){t.uniform1f(e,i)}},arraySetter:function(t,e){return function(i){t.uniform1fv(e,i)}}},Dt[35664]={Type:Float32Array,size:8,setter:function(t,e){return function(i){t.uniform2fv(e,i)}},cols:2},Dt[35665]={Type:Float32Array,size:12,setter:function(t,e){return function(i){t.uniform3fv(e,i)}},cols:3},Dt[35666]={Type:Float32Array,size:16,setter:function(t,e){return function(i){t.uniform4fv(e,i)}},cols:4},Dt[Ct]={Type:Int32Array,size:4,setter:Rt,arraySetter:Bt},Dt[35667]={Type:Int32Array,size:8,setter:Ot,cols:2},Dt[35668]={Type:Int32Array,size:12,setter:Pt,cols:3},Dt[35669]={Type:Int32Array,size:16,setter:zt,cols:4},Dt[5125]={Type:Uint32Array,size:4,setter:function(t,e){return function(i){t.uniform1ui(e,i)}},arraySetter:function(t,e){return function(i){t.uniform1uiv(e,i)}}},Dt[36294]={Type:Uint32Array,size:8,setter:function(t,e){return function(i){t.uniform2uiv(e,i)}},cols:2},Dt[36295]={Type:Uint32Array,size:12,setter:function(t,e){return function(i){t.uniform3uiv(e,i)}},cols:3},Dt[36296]={Type:Uint32Array,size:16,setter:function(t,e){return function(i){t.uniform4uiv(e,i)}},cols:4},Dt[35670]={Type:Uint32Array,size:4,setter:Rt,arraySetter:Bt},Dt[35671]={Type:Uint32Array,size:8,setter:Ot,cols:2},Dt[35672]={Type:Uint32Array,size:12,setter:Pt,cols:3},Dt[35673]={Type:Uint32Array,size:16,setter:zt,cols:4},Dt[35674]={Type:Float32Array,size:32,setter:function(t,e){return function(i){t.uniformMatrix2fv(e,!1,i)}},rows:2,cols:2},Dt[35675]={Type:Float32Array,size:48,setter:function(t,e){return function(i){t.uniformMatrix3fv(e,!1,i)}},rows:3,cols:3},Dt[35676]={Type:Float32Array,size:64,setter:function(t,e){return function(i){t.uniformMatrix4fv(e,!1,i)}},rows:4,cols:4},Dt[35685]={Type:Float32Array,size:32,setter:function(t,e){return function(i){t.uniformMatrix2x3fv(e,!1,i)}},rows:2,cols:3},Dt[35686]={Type:Float32Array,size:32,setter:function(t,e){return function(i){t.uniformMatrix2x4fv(e,!1,i)}},rows:2,cols:4},Dt[35687]={Type:Float32Array,size:48,setter:function(t,e){return function(i){t.uniformMatrix3x2fv(e,!1,i)}},rows:3,cols:2},Dt[35688]={Type:Float32Array,size:48,setter:function(t,e){return function(i){t.uniformMatrix3x4fv(e,!1,i)}},rows:3,cols:4},Dt[35689]={Type:Float32Array,size:64,setter:function(t,e){return function(i){t.uniformMatrix4x2fv(e,!1,i)}},rows:4,cols:2},Dt[35690]={Type:Float32Array,size:64,setter:function(t,e){return function(i){t.uniformMatrix4x3fv(e,!1,i)}},rows:4,cols:3},Dt[35678]={Type:null,size:0,setter:Gt,arraySetter:Lt,bindPoint:St},Dt[35680]={Type:null,size:0,setter:Gt,arraySetter:Lt,bindPoint:Ft},Dt[35679]={Type:null,size:0,setter:Gt,arraySetter:Lt,bindPoint:kt},Dt[35682]={Type:null,size:0,setter:Gt,arraySetter:Lt,bindPoint:St},Dt[36289]={Type:null,size:0,setter:Gt,arraySetter:Lt,bindPoint:It},Dt[36292]={Type:null,size:0,setter:Gt,arraySetter:Lt,bindPoint:It},Dt[36293]={Type:null,size:0,setter:Gt,arraySetter:Lt,bindPoint:Ft},Dt[36298]={Type:null,size:0,setter:Gt,arraySetter:Lt,bindPoint:St},Dt[36299]={Type:null,size:0,setter:Gt,arraySetter:Lt,bindPoint:kt},Dt[36300]={Type:null,size:0,setter:Gt,arraySetter:Lt,bindPoint:Ft},Dt[36303]={Type:null,size:0,setter:Gt,arraySetter:Lt,bindPoint:It},Dt[36306]={Type:null,size:0,setter:Gt,arraySetter:Lt,bindPoint:St},Dt[36307]={Type:null,size:0,setter:Gt,arraySetter:Lt,bindPoint:kt},Dt[36308]={Type:null,size:0,setter:Gt,arraySetter:Lt,bindPoint:Ft},Dt[36311]={Type:null,size:0,setter:Gt,arraySetter:Lt,bindPoint:It};const Vt={};Vt[5126]={size:4,setter:Nt},Vt[35664]={size:8,setter:Nt},Vt[35665]={size:12,setter:Nt},Vt[35666]={size:16,setter:Nt},Vt[Ct]={size:4,setter:jt},Vt[35667]={size:8,setter:jt},Vt[35668]={size:12,setter:jt},Vt[35669]={size:16,setter:jt},Vt[5125]={size:4,setter:Ht},Vt[36294]={size:8,setter:Ht},Vt[36295]={size:12,setter:Ht},Vt[36296]={size:16,setter:Ht},Vt[35670]={size:4,setter:jt},Vt[35671]={size:8,setter:jt},Vt[35672]={size:12,setter:jt},Vt[35673]={size:16,setter:jt},Vt[35674]={size:4,setter:qt,count:2},Vt[35675]={size:9,setter:qt,count:3},Vt[35676]={size:16,setter:qt,count:4};const Xt=/ERROR:\s*\d+:(\d+)/gi;const Yt=/^[ \t]*\n/;function Wt(t){let e=0;return Yt.test(t)&&(e=1,t=t.replace(Yt,"")),{lineOffset:e,shaderSource:t}}function Kt(t,e){return t.errorCallback(e),t.callback&&setTimeout(()=>{t.callback(`${e}\n${t.errors.join("\n")}`)}),null}function Zt(t,e,i,s){s=s||Tt;if(!t.getShaderParameter(i,35713)){const r=t.getShaderInfoLog(i),{lineOffset:n,shaderSource:a}=Wt(t.getShaderSource(i)),o=`${function(t,e="",i=0){const s=[...e.matchAll(Xt)],r=new Map(s.map((t,i)=>{const r=parseInt(t[1]),n=s[i+1],a=n?n.index:e.length;return[r-1,e.substring(t.index,a)]}));return t.split("\n").map((t,e)=>{const s=r.get(e);return`${e+1+i}: ${t}${s?`\n\n^^^ ${s}`:""}`}).join("\n")}(a,r,n)}\nError compiling ${bt(t,e)}: ${r}`;return s(o),o}return""}function Qt(t,e,i){let s,r,n;if("function"==typeof e&&(i=e,e=void 0),"function"==typeof t)i=t,t=void 0;else if(t&&!Array.isArray(t)){const e=t;i=e.errorCallback,t=e.attribLocations,s=e.transformFeedbackVaryings,r=e.transformFeedbackMode,n=e.callback}const a=i||Tt,o=[],h={errorCallback(t,...e){o.push(t),a(t,...e)},transformFeedbackVaryings:s,transformFeedbackMode:r,callback:n,errors:o};{let i={};Array.isArray(t)?t.forEach(function(t,s){i[t]=e?e[s]:s}):i=t||{},h.attribLocations=i}return h}const $t=["VERTEX_SHADER","FRAGMENT_SHADER"];function Jt(t,e){return e.indexOf("frag")>=0?35632:e.indexOf("vert")>=0?35633:void 0}const te=(t=0)=>new Promise(e=>setTimeout(e,t));function ee(t,e,i){const s=t.createProgram(),{attribLocations:r,transformFeedbackVaryings:n,transformFeedbackMode:a}=Qt(i);for(let i=0;i<e.length;++i){let r=e[i];if("string"==typeof r){const e=wt(r),n=e?e.text:r;let a=t[$t[i]];e&&e.type&&(a=Jt(0,e.type)||a),r=t.createShader(a),t.shaderSource(r,Wt(n).shaderSource),t.compileShader(r),t.attachShader(s,r)}}Object.entries(r).forEach(([e,i])=>t.bindAttribLocation(s,i,e));{let e=n;e&&(e.attribs&&(e=e.attribs),Array.isArray(e)||(e=Object.keys(e)),t.transformFeedbackVaryings(s,e,a||35981))}return t.linkProgram(s),s}function ie(t,e,i,s,r){const n=Qt(i,s,r),a=new Set(e),o=ee(t,e,n);function h(t,e){const i=ne(t,e,n.errorCallback);return i&&function(t,e,i){const s=t.getAttachedShaders(e);for(const e of s)i.has(e)&&t.deleteShader(e);t.deleteProgram(e)}(t,e,a),i}if(!n.callback)return h(t,o)?void 0:o;re(t,o).then(()=>{const e=h(t,o);n.callback(e,e?void 0:o)})}function se(t){return function(e,i,...s){return new Promise((r,n)=>{const a=Qt(...s);a.callback=(t,e)=>{t?n(t):r(e)},t(e,i,a)})}}se(ie),se(xe);async function re(t,e){const i=t.getExtension("KHR_parallel_shader_compile"),s=i?(t,e)=>t.getProgramParameter(e,i.COMPLETION_STATUS_KHR):()=>!0;let r=0;do{await te(r),r=1e3/60}while(!s(t,e))}function ne(t,e,i){i=i||Tt;if(!t.getProgramParameter(e,35714)){const s=t.getProgramInfoLog(e);i(`Error in program linking: ${s}`);return`${s}\n${t.getAttachedShaders(e).map(e=>Zt(t,t.getShaderParameter(e,t.SHADER_TYPE),e,i)).filter(t=>t).join("\n")}`}}function ae(t,e,i,s,r){return ie(t,e,i,s,r)}function oe(t){const e=t.name;return e.startsWith("gl_")||e.startsWith("webgl_")}const he=/(\.|\[|]|\w+)/g,le=t=>t>="0"&&t<="9";function ue(t,e,i,s){const r=t.split(he).filter(t=>""!==t);let n=0,a="";for(;;){const t=r[n++];a+=t;const o=le(t[0]),h=o?parseInt(t):t;o&&(a+=r[n++]);if(n===r.length){i[h]=e;break}{const t=r[n++],e="["===t,o=i[h]||(e?[]:{});i[h]=o,i=o,s[a]=s[a]||function(t){return function(e){ge(t,e)}}(o),a+=t}}}function ce(t,e){let i=0;function s(e,s,r){const n=s.name.endsWith("[0]"),a=s.type,o=Dt[a];if(!o)throw new Error(`unknown type: 0x${a.toString(16)}`);let h;if(o.bindPoint){const e=i;i+=s.size,h=n?o.arraySetter(t,a,e,r,s.size):o.setter(t,a,e,r,s.size)}else h=o.arraySetter&&n?o.arraySetter(t,r):o.setter(t,r);return h.location=r,h}const r={},n={},a=t.getProgramParameter(e,35718);for(let i=0;i<a;++i){const a=t.getActiveUniform(e,i);if(oe(a))continue;let o=a.name;o.endsWith("[0]")&&(o=o.substr(0,o.length-3));const h=t.getUniformLocation(e,a.name);if(h){const t=s(0,a,h);r[o]=t,ue(o,t,n,r)}}return r}function de(t,e){const i={},s=t.getProgramParameter(e,35971);for(let r=0;r<s;++r){const s=t.getTransformFeedbackVarying(e,r);i[s.name]={index:r,type:s.type,size:s.size}}return i}function fe(t,e){const i=t.getProgramParameter(e,35718),s=[],r=[];for(let n=0;n<i;++n){r.push(n),s.push({});const i=t.getActiveUniform(e,n);s[n].name=i.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(i){const n=i[0],a=i[1];t.getActiveUniforms(e,r,t[n]).forEach(function(t,e){s[e][a]=t})});const n={},a=t.getProgramParameter(e,35382);for(let i=0;i<a;++i){const s=t.getActiveUniformBlockName(e,i),r={index:t.getUniformBlockIndex(e,s),usedByVertexShader:t.getActiveUniformBlockParameter(e,i,35396),usedByFragmentShader:t.getActiveUniformBlockParameter(e,i,35398),size:t.getActiveUniformBlockParameter(e,i,35392),uniformIndices:t.getActiveUniformBlockParameter(e,i,35395)};r.used=r.usedByVertexShader||r.usedByFragmentShader,n[s]=r}return{blockSpecs:n,uniformData:s}}function ge(t,e){for(const i in e){const s=t[i];"function"==typeof s?s(e[i]):ge(t[i],e[i])}}function _e(t,...e){const i=t.uniformSetters||t,s=e.length;for(let t=0;t<s;++t){const s=e[t];if(Array.isArray(s)){const t=s.length;for(let e=0;e<t;++e)_e(i,s[e])}else for(const t in s){const e=i[t];e&&e(s[t])}}}function be(t,e){const i={},s=t.getProgramParameter(e,35721);for(let r=0;r<s;++r){const s=t.getActiveAttrib(e,r);if(oe(s))continue;const n=t.getAttribLocation(e,s.name),a=Vt[s.type],o=a.setter(t,n,a);o.location=n,i[s.name]=o}return i}function pe(t,e){const i={program:e,uniformSetters:ce(t,e),attribSetters:be(t,e)};return _t(t)&&(i.uniformBlockSpec=fe(t,e),i.transformFeedbackInfo=de(t,e)),i}const me=/\s|{|}|;/;function xe(t,e,i,s,r){const n=Qt(i,s,r),a=[];if(e=e.map(function(t){if(!me.test(t)){const e=wt(t);if(e)t=e.text;else{const e=`no element with id: ${t}`;n.errorCallback(e),a.push(e)}}return t}),a.length)return Kt(n,"");const o=n.callback;o&&(n.callback=(e,i)=>{o(e,e?void 0:pe(t,i))});const h=ae(t,e,n);return h?pe(t,h):null}function ve(t,e,i,s,r){for(const[n,a]of Object.entries(e)){const o={...r},h=i[n];Array.isArray(h)||Object.assign(o,h);const l=ne(t,a,o.errorCallback);if(l){for(const i of Object.values(e)){const e=t.getAttachedShaders(i);t.deleteProgram(i);for(const i of e)s.has(i)||t.deleteShader(i)}return l}}}function Te(t,e,i={}){const s=new Set,r=Object.fromEntries(Object.entries(e).map(([e,r])=>{const n={...i},a=Array.isArray(r)?r:r.shaders;return Array.isArray(r)||Object.assign(n,r),a.forEach(s.add,s),[e,ee(t,a,n)]}));if(i.callback)return void async function(t,e){for(const i of Object.values(e))await re(t,i)}(t,r).then(()=>{const n=ve(t,r,e,s,i);i.callback(n,n?void 0:r)});return ve(t,r,e,s,i)?void 0:r}function we(t,e,i){function s(t,e){return Object.fromEntries(Object.entries(e).map(([e,i])=>[e,pe(t,i)]))}const r=(i=Qt(i)).callback;r&&(i.callback=(e,i)=>{r(e,e?void 0:s(t,i))});const n=Te(t,e,i);if(!r&&n)return s(t,n)}se(Te),se(we);const ye=36096,Ee=33306,Ae={};Ae[34041]=Ee,Ae[6401]=36128,Ae[36168]=36128,Ae[6402]=ye,Ae[33189]=ye,Ae[33190]=ye,Ae[36012]=ye,Ae[35056]=Ee,Ae[36013]=Ee;const Ce={};Ce[32854]=!0,Ce[32855]=!0,Ce[36194]=!0,Ce[34041]=!0,Ce[33189]=!0,Ce[6401]=!0,Ce[36168]=!0;var Me={};const Se={position:3,normal:3,tangent:3,texcoord:2,texcoord0:2,texcoord1:2,texcoord2:2};var Fe={};class ke{constructor(){this.attribs={}}disableAll(){for(let t in this.attribs)this.gl.disableVertexAttribArray(this.attribs[t]);this.attribs={}}enable(t,e){this.gl=t;var i={};for(let r in e){var s=e[r];void 0!==s.loc&&(void 0===this.attribs[s.loc]&&t.enableVertexAttribArray(s.loc),t.vertexAttribPointer(s.loc,s.size,s.type,!1,s.stride,s.offset),i[s.loc]=s.loc,this.attribs[r]=null)}for(let t in this.attribs);this.attribs=i}}class Ie{static CreateProgramAttributes(t,e){var i={},s=0;for(let a in e){var r=e[a],n=Se[a];i[r]={type:t.FLOAT,size:n,offset:4*s},s+=n}for(let t in i)i[t].stride=4*s;return i}CleanUpPrograms(){Fe={}}ReleaseProgram(t){}static _GetProgram(t){return Fe[t]}static RegisterProgram(t,e){if(!Fe[t]){var i=e.shaders;Fe[t]={shaders:[i[0],i[1]],attributes:e.attributes}}return Fe[t]}static GetProgram(t,e,i,s){var r=Fe[e],n="";for(var a in i)n+=a+":"+i[a]+"-";if(!r){var o=e.split("."),h=Me[o[0]][o[1]];h&&(r=Ie.RegisterProgram(e,h))}if(!r)throw"Program not registered: "+o;r.programInfo||(r.programInfo={}),r.programInfo[n]=Ie.CompileProgram(t,r.shaders,i),s=s||r.attributes&&Ie.CreateProgramAttributes(t,r.attributes);var l=r.programInfo[n];if(s)for(var a in s){var u=l.attribSetters[a];u&&(s[a]=s[a]||{},s[a].loc=u.location)}return l.attributes=s,l}static CompileProgram(t,e,i,s){var r="";for(var n in i){var a=i[n];r="#define "+n+" "+(null===a?"":a)+"\n"}var o={};const h=xe(t,[r+e[0],r+e[1]],null,null);if(s)for(var n in s){var l=h.attribSetters[n];l&&(s[n]=s[n]||{},s[n].loc=l.location)}for(var n in h.uniformSetters)o[n]=h.uniformSetters[n].location;return h.uniforms=o,h}}var De=new Ie,Ue=1e-6,Re="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function Be(){var t=new Re(3);return Re!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Oe(t){var e=t[0],i=t[1],s=t[2];return Math.hypot(e,i,s)}function Pe(t,e,i){var s=new Re(3);return s[0]=t,s[1]=e,s[2]=i,s}function ze(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ge(t,e,i,s){return t[0]=e,t[1]=i,t[2]=s,t}function Le(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Ne(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function je(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function He(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function qe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function Ve(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Xe(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t}function Ye(t){var e=t[0],i=t[1],s=t[2];return e*e+i*i+s*s}function We(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Ke(t,e){var i=e[0],s=e[1],r=e[2],n=i*i+s*s+r*r;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Ze(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Qe(t,e,i){var s=e[0],r=e[1],n=e[2],a=i[0],o=i[1],h=i[2];return t[0]=r*h-n*o,t[1]=n*a-s*h,t[2]=s*o-r*a,t}function $e(t,e,i,s){var r=e[0],n=e[1],a=e[2];return t[0]=r+s*(i[0]-r),t[1]=n+s*(i[1]-n),t[2]=a+s*(i[2]-a),t}function Je(t,e,i){var s=e[0],r=e[1],n=e[2],a=i[3]*s+i[7]*r+i[11]*n+i[15];return a=a||1,t[0]=(i[0]*s+i[4]*r+i[8]*n+i[12])/a,t[1]=(i[1]*s+i[5]*r+i[9]*n+i[13])/a,t[2]=(i[2]*s+i[6]*r+i[10]*n+i[14])/a,t}function ti(t,e,i){var s=e[0],r=e[1],n=e[2];return t[0]=s*i[0]+r*i[3]+n*i[6],t[1]=s*i[1]+r*i[4]+n*i[7],t[2]=s*i[2]+r*i[5]+n*i[8],t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ei,ii=Ne,si=Oe;ei=Be();function ri(){var t=new Re(16);return Re!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function ni(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ai(t,e,i,s,r,n,a,o,h,l,u,c,d,f,g,_){var b=new Re(16);return b[0]=t,b[1]=e,b[2]=i,b[3]=s,b[4]=r,b[5]=n,b[6]=a,b[7]=o,b[8]=h,b[9]=l,b[10]=u,b[11]=c,b[12]=d,b[13]=f,b[14]=g,b[15]=_,b}function oi(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function hi(t,e){if(t===e){var i=e[1],s=e[2],r=e[3],n=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=s,t[9]=n,t[11]=e[14],t[12]=r,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function li(t,e){var i=e[0],s=e[1],r=e[2],n=e[3],a=e[4],o=e[5],h=e[6],l=e[7],u=e[8],c=e[9],d=e[10],f=e[11],g=e[12],_=e[13],b=e[14],p=e[15],m=i*o-s*a,x=i*h-r*a,v=i*l-n*a,T=s*h-r*o,w=s*l-n*o,y=r*l-n*h,E=u*_-c*g,A=u*b-d*g,C=u*p-f*g,M=c*b-d*_,S=c*p-f*_,F=d*p-f*b,k=m*F-x*S+v*M+T*C-w*A+y*E;return k?(k=1/k,t[0]=(o*F-h*S+l*M)*k,t[1]=(r*S-s*F-n*M)*k,t[2]=(_*y-b*w+p*T)*k,t[3]=(d*w-c*y-f*T)*k,t[4]=(h*C-a*F-l*A)*k,t[5]=(i*F-r*C+n*A)*k,t[6]=(b*v-g*y-p*x)*k,t[7]=(u*y-d*v+f*x)*k,t[8]=(a*S-o*C+l*E)*k,t[9]=(s*C-i*S-n*E)*k,t[10]=(g*w-_*v+p*m)*k,t[11]=(c*v-u*w-f*m)*k,t[12]=(o*A-a*M-h*E)*k,t[13]=(i*M-s*A+r*E)*k,t[14]=(_*x-g*T-b*m)*k,t[15]=(u*T-c*x+d*m)*k,t):null}function ui(t,e,i){var s=e[0],r=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],d=e[9],f=e[10],g=e[11],_=e[12],b=e[13],p=e[14],m=e[15],x=i[0],v=i[1],T=i[2],w=i[3];return t[0]=x*s+v*o+T*c+w*_,t[1]=x*r+v*h+T*d+w*b,t[2]=x*n+v*l+T*f+w*p,t[3]=x*a+v*u+T*g+w*m,x=i[4],v=i[5],T=i[6],w=i[7],t[4]=x*s+v*o+T*c+w*_,t[5]=x*r+v*h+T*d+w*b,t[6]=x*n+v*l+T*f+w*p,t[7]=x*a+v*u+T*g+w*m,x=i[8],v=i[9],T=i[10],w=i[11],t[8]=x*s+v*o+T*c+w*_,t[9]=x*r+v*h+T*d+w*b,t[10]=x*n+v*l+T*f+w*p,t[11]=x*a+v*u+T*g+w*m,x=i[12],v=i[13],T=i[14],w=i[15],t[12]=x*s+v*o+T*c+w*_,t[13]=x*r+v*h+T*d+w*b,t[14]=x*n+v*l+T*f+w*p,t[15]=x*a+v*u+T*g+w*m,t}function ci(t,e,i){var s,r,n,a,o,h,l,u,c,d,f,g,_=i[0],b=i[1],p=i[2];return e===t?(t[12]=e[0]*_+e[4]*b+e[8]*p+e[12],t[13]=e[1]*_+e[5]*b+e[9]*p+e[13],t[14]=e[2]*_+e[6]*b+e[10]*p+e[14],t[15]=e[3]*_+e[7]*b+e[11]*p+e[15]):(s=e[0],r=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],d=e[9],f=e[10],g=e[11],t[0]=s,t[1]=r,t[2]=n,t[3]=a,t[4]=o,t[5]=h,t[6]=l,t[7]=u,t[8]=c,t[9]=d,t[10]=f,t[11]=g,t[12]=s*_+o*b+c*p+e[12],t[13]=r*_+h*b+d*p+e[13],t[14]=n*_+l*b+f*p+e[14],t[15]=a*_+u*b+g*p+e[15]),t}function di(t,e,i){var s=i[0],r=i[1],n=i[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function fi(t,e,i){var s=Math.sin(i),r=Math.cos(i),n=e[4],a=e[5],o=e[6],h=e[7],l=e[8],u=e[9],c=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*r+l*s,t[5]=a*r+u*s,t[6]=o*r+c*s,t[7]=h*r+d*s,t[8]=l*r-n*s,t[9]=u*r-a*s,t[10]=c*r-o*s,t[11]=d*r-h*s,t}function gi(t,e,i){var s=Math.sin(i),r=Math.cos(i),n=e[0],a=e[1],o=e[2],h=e[3],l=e[4],u=e[5],c=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r+l*s,t[1]=a*r+u*s,t[2]=o*r+c*s,t[3]=h*r+d*s,t[4]=l*r-n*s,t[5]=u*r-a*s,t[6]=c*r-o*s,t[7]=d*r-h*s,t}function _i(t,e,i){var s=e[0],r=e[1],n=e[2],a=e[3],o=s+s,h=r+r,l=n+n,u=s*o,c=s*h,d=s*l,f=r*h,g=r*l,_=n*l,b=a*o,p=a*h,m=a*l;return t[0]=1-(f+_),t[1]=c+m,t[2]=d-p,t[3]=0,t[4]=c-m,t[5]=1-(u+_),t[6]=g+b,t[7]=0,t[8]=d+p,t[9]=g-b,t[10]=1-(u+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function bi(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function pi(t,e){var i=e[0],s=e[1],r=e[2],n=e[4],a=e[5],o=e[6],h=e[8],l=e[9],u=e[10];return t[0]=Math.hypot(i,s,r),t[1]=Math.hypot(n,a,o),t[2]=Math.hypot(h,l,u),t}var mi=function(t,e,i,s,r){var n,a=1/Math.tan(e/2);return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(n=1/(s-r),t[10]=(r+s)*n,t[14]=2*r*s*n):(t[10]=-1,t[14]=-2*s),t};var xi=ui;const vi={2:"Wowhead",3:"LolKing",6:"HeroKing",7:"DestinyDB"};class Ti{constructor(t){if(!t.type||!vi[t.type])throw"Viewer error: Bad viewer type given";if(!t.container)throw"Viewer error: Bad container given";if(!t.aspect)throw"Viewer error: Bad aspect ratio given";if(!t.contentPath)throw"Viewer error: No content path given";console.log("Creating viewer with options",t),this.type=t.type,this.container=t.container,this.aspect=parseFloat(t.aspect),this.renderer=null,this.options=t;const e=this.container.width(),i=Math.round(e/this.aspect);this.init(e,i)}destroy(){this.renderer&&this.renderer.destroy(),this.options=null,this.container=null}init(t,e){if(void 0!==typeof window.Uint8Array&&void 0!==typeof window.DataView)try{const t=document.createElement("canvas");if(!(t.getContext("webgl",{alpha:!1})||t.getContext("experimental-webgl",{alpha:!1})))return void console.log("viewer init failed")}catch(t){return void console.log("viewer init failed")}this.mode=1,this.renderer=new gl(this),this.renderer.resize(t,e),this.renderer.init()}setAdaptiveMode(t){this.renderer.setAdaptiveMode(t)}setZoom(t){this.renderer.zoom.target=t}setOffset(t,e){this.renderer.setTranslation(t,e,0)}setFullscreen(t){t?Ti.requestFullscreen(this.renderer.canvas[0]):Ti.exitFullscreen()}method(t,e){return void 0===e&&(e=[]),this.renderer?this.renderer.method(t,[].concat(e)):null}option(t,e){return void 0!==e&&(this.options[t]=e),this.options[t]}static isFullscreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}static requestFullscreen(t){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||(t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen())}static exitFullscreen(){(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen())}}const wi=Ti;const yi=class{constructor(t,e,i){this.ba=t,this.dc=e,this.e=i,this.g=!1,this.f=t.createBuffer(),this.dc=0}d(t){const e=this.ba;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.f),!this.g||this.dc<t.byteLength?(e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,this.e?e.DYNAMIC_DRAW:e.STATIC_DRAW),this.dc=t.byteLength,this.g=!0):e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}a(){return this.dc}c(){const t=this.ba;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.f)}b(){const t=this.ba;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}};const Ei=class{constructor(t,e,i){this.dc=t,this.g=e,this.f=i,this.ba=!1,this.e=t.createBuffer(),this.g=0}c(){const t=this.dc;t.bindBuffer(t.ARRAY_BUFFER,this.e)}b(){const t=this.dc;t.bindBuffer(t.ARRAY_BUFFER,null)}d(t){const e=this.dc;e.bindBuffer(e.ARRAY_BUFFER,this.e),!this.ba||this.g<t.byteLength?(e.bufferData(e.ARRAY_BUFFER,t,this.f?e.DYNAMIC_DRAW:e.STATIC_DRAW),this.ba=!0,this.g=t.byteLength):e.bufferSubData(e.ARRAY_BUFFER,0,t),e.bindBuffer(e.ARRAY_BUFFER,null)}a(){return this.g}};var Ai;!function(t){t[t.GFLOAT=0]="GFLOAT",t[t.GUNSIGNED_BYTE=1]="GUNSIGNED_BYTE"}(Ai||(Ai={}));class Ci{constructor(t,e,i,s,r,n){this.b=t,this.c=e,this.f=i,this.e=s,this.a=r,this.d=n}}function Mi(t,e){switch(e){case Ai.GFLOAT:return t.FLOAT;case Ai.GUNSIGNED_BYTE:return t.UNSIGNED_BYTE}}const Si=class{constructor(t,e){this.dc=t,this.ba=e,this.e=null,this.f=[],this.e=e.createVertexArrayOES()}c(t){this.dc;this.a(),t.c(),this.d(),this.f.push(t)}b(t,e){const i=this.dc;this.a(),t.c();for(const t of e)i.enableVertexAttribArray(t.b),i.vertexAttribPointer(t.b,t.c,Mi(i,t.f),t.e,t.a,t.d);this.d(),this.f.push(t)}a(){this.ba.bindVertexArrayOES(this.e)}d(){this.ba.bindVertexArrayOES(null)}};const Fi=class{constructor(t,e){this.f=t,this.ba=e,this.e=[]}c(t){this.dc=t}b(t,e){this.e.push({buffer:t,bindings:e})}a(){const t=this.f;this.dc.c();const e=this.ba.a();for(const e of this.e){e.b.c();for(const i of e.a)this.ba.d(i.b),t.vertexAttribPointer(i.b,i.c,Mi(t,i.f),i.e,i.a,i.d)}this.ba.c(e)}d(){}};class ki{}class Ii{constructor(t,e,i,s){this.b=t,this.a=e,this.d=i,this.c=s}}class Di{constructor(t,e){this.a=t,this.b=e}}class Ui{constructor(t,e){this.a=t,this.b=e}}class Ri extends ki{}const Bi=class extends Ri{constructor(t,e,i,s){super(),this.cba=t,this.e=e,this.d=i,this.ba=s}a(){return this.d.a}b(t){const e=this.d;t.a(this.e),t.f(e.a),t.h(e.d),t.b(e.b),t.g(e.c),t.c(e.f),t.j(e.e),_e(this.e.ba(),this.ba)}};const Oi=class{constructor(t,e,i,s){if(this.d=t,this.c=xe(t,[i,s],Object.keys(e),null),!this.c)throw"Failed to create program"}a(){this.d.useProgram(this.c.program)}ba(){return this.c}};class Pi{static b(t){const e=32767&t;return e<zi.length?zi[e]:(WH.debug("Unknown shader effect:",e),["PS_Combiners_Opaque","VS_Diffuse_T1"])}static d(t,e){let i="";if(-1e3==t&&3==e)return"Skin";if(32768&t)return Pi.b(t)[0];if(1==e)i=112&t?"PS_Combiners_Mod":"PS_Combiners_Opaque";else{i=(112&t?"PS_Combiners_Mod":"PS_Combiners_Opaque")+"_"+(112&t?["Opaque","Mod","Mod","Add","Mod2x","Mod","Mod2xNA","AddNA"]:["Opaque","Mod","Mod","AddAlpha","Mod2x","Mod","Mod2xNA","AddAlpha"])[7&t]}return i}static f(t,e){let i="";if(-1e3==t&&3==e)i="T1_T1_T1";else{if(32768&t)return Pi.b(t)[1];i=1==e?128&t?"Env":16384&t?"T2":"T1":128&t?8&t?"Env_Env":"Env_T1":8&t?"T1_Env":16384&t?"T1_T2":"T1_T1"}return"VS_Diffuse_"+i}static h(t,e,i){const s=Pi.d(t,e),r=Pi.f(t,e),n="Wow."+r+"_"+s;if(Ie._GetProgram(n))return{name:n};const a={shaders:[Pi.g(r,i),Pi.a(r,s,!1)],attributes:{position:"aPosition",normal:"aNormal",texcoord0:"aTexCoord0",texcoord1:"aTexCoord1"}};return Ie.RegisterProgram(n,a),{name:n}}static e(t){const e={},i={texcoord1:function(t,e){t.INPUT_TEXCOORD1="aTexCoord"+e}};for(let s in t.options){const r=t.options[s];i[s](e,r)}return{name:"Wow."+t.name,config:e}}static c(t){var e="";if(e+="lTexCoord1 = (uTextureMatrix1 * vec4(vTexCoord1, 0, 1)).st;\n",e+="lTexCoord2 = (uTextureMatrix2 * vec4(vTexCoord2, 0, 1)).st;\n","VS"===t.slice(0,2)){let i=(t=t.slice(3)).split("_"),s=i[0];if("Diffuse"===s||"Color"===s){e="",i.splice(0,1);let s={T1:["uTextureMatrix1","vTexCoord1"],T2:["uTextureMatrix2","vTexCoord2"],T3:["","aTexCoord2"],Env:["","texEnv"]},r=1;for(let n in i)s[i[n]]?(s[i[n]][0]&&"texEnv"!=s[i[n]][1]?e+="lTexCoord"+r+" = ("+s[i[n]][0]+" * vec4("+s[i[n]][1]+", 0, 1)).st;\n":"texEnv"==s[i[n]][1]?e+="lTexCoord"+r+" = texEnv;\n":e+="lTexCoord"+r+" = (uTextureMatrix"+r+" * vec4("+s[i[n]][1]+", 0, 1)).st;\n",r++):WH.debug("Missing vertex shader def?",t)}}return e}static g(t,e){var i;return"attribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord0;\nattribute vec2 aTexCoord1;\nattribute vec3 aColor;\n"+((i={SKINNING:e}).SKINNING?"attribute vec4 aBoneWeights;\nattribute vec4 aBones;\n":"")+"varying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nuniform mat4 uModelMatrix;\nuniform mat4 uPanningMatrix;\nuniform mat4 uViewMatrix;\nuniform mat4 uInvTranspViewModelMat;\nuniform mat4 uProjMatrix;\nuniform vec3 uCameraPos;\n"+(i.SKINNING?"uniform sampler2D uBoneMatricesTex;\n#define ROW0_U ((0.5 + 0.0) / 4.)\n#define ROW1_U ((0.5 + 1.0) / 4.)\n#define ROW2_U ((0.5 + 2.0) / 4.)\n#define ROW3_U ((0.5 + 3.0) / 4.)\nconst float numBones = 256.0;\nmat4 getBoneMatrix(float boneNdx) {\nfloat v = (boneNdx + 0.5) / numBones;\nreturn mat4(\ntexture2D(uBoneMatricesTex, vec2(ROW0_U, v)),\ntexture2D(uBoneMatricesTex, vec2(ROW1_U, v)),\ntexture2D(uBoneMatricesTex, vec2(ROW2_U, v)),\ntexture2D(uBoneMatricesTex, vec2(ROW3_U, v))\n);\n}\nhighp mat4 transpose(in highp mat4 inMatrix) {\nhighp vec4 i0 = inMatrix[0];\nhighp vec4 i1 = inMatrix[1];\nhighp vec4 i2 = inMatrix[2];\nhighp vec4 i3 = inMatrix[3];\nhighp mat4 outMatrix = mat4(\nvec4(i0.x, i1.x, i2.x, i3.x),\nvec4(i0.y, i1.y, i2.y, i3.y),\nvec4(i0.z, i1.z, i2.z, i3.z),\nvec4(i0.w, i1.w, i2.w, i3.w)\n);\nreturn outMatrix;\n}\nmat4 inverse(mat4 m) {\nfloat\na00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\nb00 = a00 * a11 - a01 * a10,\nb01 = a00 * a12 - a02 * a10,\nb02 = a00 * a13 - a03 * a10,\nb03 = a01 * a12 - a02 * a11,\nb04 = a01 * a13 - a03 * a11,\nb05 = a02 * a13 - a03 * a12,\nb06 = a20 * a31 - a21 * a30,\nb07 = a20 * a32 - a22 * a30,\nb08 = a20 * a33 - a23 * a30,\nb09 = a21 * a32 - a22 * a31,\nb10 = a21 * a33 - a23 * a31,\nb11 = a22 * a33 - a23 * a32,\ndet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\nreturn mat4(\na11 * b11 - a12 * b10 + a13 * b09,\na02 * b10 - a01 * b11 - a03 * b09,\na31 * b05 - a32 * b04 + a33 * b03,\na22 * b04 - a21 * b05 - a23 * b03,\na12 * b08 - a10 * b11 - a13 * b07,\na00 * b11 - a02 * b08 + a03 * b07,\na32 * b02 - a30 * b05 - a33 * b01,\na20 * b05 - a22 * b02 + a23 * b01,\na10 * b10 - a11 * b08 + a13 * b06,\na01 * b08 - a00 * b10 - a03 * b06,\na30 * b04 - a31 * b02 + a33 * b00,\na21 * b02 - a20 * b04 - a23 * b00,\na11 * b07 - a10 * b09 - a12 * b06,\na00 * b09 - a01 * b07 + a02 * b06,\na31 * b01 - a30 * b03 - a32 * b00,\na20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n":"")+"void main(void) {\nmat4 boneTransformMat =  mat4(1.0);\n"+(i.SKINNING?"if (length(aBoneWeights) > 0.0) {\nboneTransformMat =  mat4(0.0);\nfor (int i = 0; i < 4; i++) {\nboneTransformMat += getBoneMatrix(aBones[i]) * aBoneWeights[i];\n}\n}\nmat4 viewModelMat = uViewMatrix * uModelMatrix * boneTransformMat;\nmat4 invTranspViewModelMat = transpose(inverse(viewModelMat));\n":"mat4 viewModelMat = uViewMatrix * uModelMatrix;\nmat4 invTranspViewModelMat = uInvTranspViewModelMat;\n")+"vec4 pos = viewModelMat * vec4(aPosition, 1);\nvPosition = pos.rgb;\ngl_Position = uProjMatrix * pos;\nvTexCoord1 = aTexCoord0;\nvTexCoord2 = aTexCoord1;\nvNormal = normalize((invTranspViewModelMat * vec4(aNormal, 0.0)).xyz);\n}\n"}static a(t,e,i){let s=Gi[e];s||(WH.debug("Missing pixel shader def",e),s=Gi[e="PS_Combiners_Opaque_Mod"]);let r="\t\t"+s.slice(1,s.length).join("\n\t\t");for(let t=0;t<s[0];t++){let e=t+1;r="vec4 tex"+t+" = texture2D(uTexture"+e+", lTexCoord"+e+".st);\n"+r}let n=this.c(t);var a;return"precision mediump float;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nuniform bool uHasAlpha;\nuniform bool uHasSpecEmiss;\nuniform bool uHasEmissiveGlowing;\nuniform int uBlendMode;\nuniform bool uUnlit;\nuniform vec4 uColor;\nuniform vec4 uAmbientColor;\nuniform vec4 uDiffuseColor;\nuniform vec4 uPrimaryColor;\nuniform vec4 uSecondaryColor;\nuniform vec3 uLightDir1;\nuniform vec3 uLightDir2;\nuniform vec3 uLightDir3;\nuniform mat4 uTextureMatrix1;\nuniform mat4 uTextureMatrix2;\nuniform mat4 uTextureMatrix3;\nuniform mat4 uTextureMatrix4;\nuniform sampler2D uTexture1;\nuniform sampler2D uTexture2;\nuniform sampler2D uTexture3;\nuniform sampler2D uTexture4;\nuniform sampler2D uAlpha;\nuniform vec4 uTexSampleAlpha;\n"+((a={EXCERPT_TEX_COORD:n,EXCERPT_BASE:r,GRADIENT:i}).GRADIENT?"uniform vec4 u_gradGradientColors_0;\nuniform vec4 u_gradGradientColors_1;\nuniform vec4 u_gradGradientColors_2;\nuniform vec4 u_gradEdgeColor;\nuniform vec4 u_gradBoundingBox;\nuniform vec4 u_gradUpVec;\nuniform vec4 u_gradFlags;\nuniform vec4 u_mulLum_OpaqMat;\n":"")+"vec2 sphereMap(vec3 vertex, vec3 normal) {\nvec3 normPos = (normalize(vertex.xyz));\nvec3 reflection = reflect(normPos, normalize(normal));\nreflection = vec3(reflection.x, reflection.y, reflection.z + 1.0);\nvec2 texCoord = ((normalize(reflection).xy * 0.5) + vec2(0.5));\nreturn texCoord;\n}\nvoid main(void) {\nvec2 lTexCoord1 = vec2(0.0);\nvec2 lTexCoord2 = vec2(0.0);\nvec2 lTexCoord3 = vec2(0.0);\nvec4 _output = vec4(1.0);\nvec4 _input = uColor;\nvec3 _specular = vec3(0.0);\nvec2 texEnv = sphereMap(vPosition.xyz,normalize(vNormal.xyz));\n"+(a.EXCERPT_TEX_COORD?a.EXCERPT_TEX_COORD:"")+(a.EXCERPT_BASE?a.EXCERPT_BASE:"")+"_output.a = _output.a * uDiffuseColor.a;\nif (uBlendMode == 13) {\n_output.a = _output.a * _input.a;\n} else if (uBlendMode == 1) {\nif (_output.a < (128.0/255.0))\ndiscard;\n_output.a = _input.a;\n} else if (uBlendMode == 0) {\n_output.a = _input.a;\n} else {\n_output.a = _output.a * _input.a;\n}\nif (!uUnlit) {\nvec4 litColor = uAmbientColor;\nvec3 normal = normalize(vNormal);\nfloat dp = max(0.0, dot(normal, uLightDir1));\nlitColor += uPrimaryColor * dp;\ndp = max(0.0, dot(normal, uLightDir2));\nlitColor += uSecondaryColor * dp;\ndp = max(0.0, dot(normal, uLightDir3));\nlitColor += uSecondaryColor * dp;\nlitColor = clamp(litColor, vec4(0,0,0,0), vec4(1,1,1,1));\n_output.rgb *= (litColor * uDiffuseColor).rgb;\n}\n_output += vec4(_specular, 0.0);\n"+(a.GRADIENT?"float power = u_gradEdgeColor.w;\nfloat midValue = u_gradGradientColors_2.w;\nfloat opaqueMaterial = u_mulLum_OpaqMat.y;\nfloat lum = clamp(dot(_output.xyz, vec3(0.212599993, 0.715200007, 0.0722000003)), 0.0, 1.0);\nfloat val0 = 0.0;\nfloat val1 = midValue;\nif (lum > midValue) {\nval0 = midValue;\nval1 = 1.0;\n}\nfloat lerpValue = clamp(((lum - val0) / (val1 - val0)), 0.0, 1.0);\nvec3 gradColor0 = u_gradGradientColors_0.xyz;\nvec3 gradColor1 = u_gradGradientColors_1.xyz;\nif (lum > midValue) {\ngradColor0 = u_gradGradientColors_1.xyz;\ngradColor1 = u_gradGradientColors_2.xyz;\n}\nvec3 gradientColor = mix(gradColor0, gradColor1, vec3(lerpValue));\nbool flipNormal = ((u_gradGradientColors_0.w > 0.0) && (vNormal.z > 0.0));\nvec3 normal = flipNormal ? -vNormal.xyz : vNormal.xyz;\nvec2 term = vec2(dot(-(vPosition.xyz), normal), dot(normalize(-(vPosition.xyz)), (normal * vec3(0.05, 0.05, 1.0))));\nvec2 invTerm = (vec2(1.0) - clamp(term, 0.0, 1.0));\nvec2 f = (invTerm * invTerm);\nfloat fresnel_rim = pow((f.x + f.y), power);\nbool disableHeightFade = bool(u_gradFlags.x);\nfloat visMod = 0.0;\nvec4 res = _output;\nvec3 distVecTest = vec3(0,0,0);\nif (!(disableHeightFade))\n{\nvec3 distVec = (vPosition - u_gradBoundingBox.xyz);\nfloat _dot = dot(distVec, u_gradUpVec.xyz);\nfloat relHeight = (_dot * u_gradBoundingBox.w);\nbool invertHeightFade = bool(u_gradFlags.w);\ndistVecTest = vec3(relHeight);\nrelHeight = invertHeightFade ? clamp((1.0 - relHeight), 0.0, 1.0) : relHeight;\nfloat visMod = clamp((relHeight * 1.66666663), 0.0, 0.899999976);\nvisMod = (visMod * visMod);\nres = vec4(_output.r, _output.g, _output.b, (_output.w * visMod));\n}\nvec3 lerp = mix(gradientColor, u_gradEdgeColor.xyz, vec3(fresnel_rim));\nfloat multiplyLum = u_mulLum_OpaqMat.x;\nif (bool(multiplyLum))\n{\nres = vec4(lerp.xyz, (res.w * lum));\n}\nelse\n{\nres = vec4(lerp.xyz, res.w);\n}\n_output = mix(_output, res, vec4(u_gradFlags.y));\n_output = vec4(_output.xyz, res.a * _output.a);\n":"")+"gl_FragColor = _output;\n}\n"}}const zi=[["PS_Combiners_Opaque_Mod2xNA_Alpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_AddAlpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_AddAlpha_Alpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_Mod2xNA_Alpha_Add","VS_Diffuse_T1_Env_T1","HS_T1_T2_T3","DS_T1_T2_T3"],["PS_Combiners_Mod_AddAlpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_AddAlpha","VS_Diffuse_T1_T1","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod_AddAlpha","VS_Diffuse_T1_T1","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod_AddAlpha_Alpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_Alpha_Alpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_Mod2xNA_Alpha_3s","VS_Diffuse_T1_Env_T1","HS_T1_T2_T3","DS_T1_T2_T3"],["PS_Combiners_Opaque_AddAlpha_Wgt","VS_Diffuse_T1_T1","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod_Add_Alpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_ModNA_Alpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod_AddAlpha_Wgt","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod_AddAlpha_Wgt","VS_Diffuse_T1_T1","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_AddAlpha_Wgt","VS_Diffuse_T1_T2","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_Mod_Add_Wgt","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha","VS_Diffuse_T1_Env_T1","HS_T1_T2_T3","DS_T1_T2_T3"],["PS_Combiners_Mod_Dual_Crossfade","VS_Diffuse_T1","HS_T1","DS_T1"],["PS_Combiners_Mod_Depth","VS_Diffuse_EdgeFade_T1","HS_T1","DS_T1"],["PS_Combiners_Opaque_Mod2xNA_Alpha_Alpha","VS_Diffuse_T1_Env_T2","HS_T1_T2_T3","DS_T1_T2_T3"],["PS_Combiners_Mod_Mod","VS_Diffuse_EdgeFade_T1_T2","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod_Masked_Dual_Crossfade","VS_Diffuse_T1_T2","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_Alpha","VS_Diffuse_T1_T1","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha","VS_Diffuse_T1_Env_T2","HS_T1_T2_T3","DS_T1_T2_T3"],["PS_Combiners_Mod_Depth","VS_Diffuse_EdgeFade_Env","HS_T1","DS_T1"],["PS_Guild","VS_Diffuse_T1_T2_T1","HS_T1_T2_T3","DS_T1_T2"],["PS_Guild_NoBorder","VS_Diffuse_T1_T2","HS_T1_T2","DS_T1_T2_T3"],["PS_Guild_Opaque","VS_Diffuse_T1_T2_T1","HS_T1_T2_T3","DS_T1_T2"],["PS_Illum","VS_Diffuse_T1_T1","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod_Mod_Mod_Const","VS_Diffuse_T1_T2_T3","HS_T1_T2_T3","DS_T1_T2_T3"],["PS_Combiners_Mod_Mod_Mod_Const","VS_Color_T1_T2_T3","HS_T1_T2_T3","DS_T1_T2_T3"],["PS_Combiners_Opaque","VS_Diffuse_T1","HS_T1","DS_T1"],["PS_Combiners_Mod_Mod2x","VS_Diffuse_EdgeFade_T1_T2","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod","VS_Diffuse_EdgeFade_T1","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod_Mod_Depth","VS_Diffuse_EdgeFade_T1_T2","HS_T1_T2","DS_T1_T2"]],Gi={PS_Combiners_Add:[1,"_output.rgb = _input.rgb + tex0.rgb;","_output.a = _input.a + tex0.a;"],PS_Combiners_Decal:[1,"_output.rgb = mix(_input.rgb, tex0.rgb, _input.a);","_output.a = _input.a;"],PS_Combiners_Fade:[1,"_output.rgb = mix(tex0.rgb, _input.rgb, _input.a);","_output.a = _input.a;"],PS_Combiners_Mod:[1,"_output.rgb = _input.rgb * tex0.rgb;","_output.a = tex0.a;"],PS_Combiners_Mod2x:[1,"_output.rgb = _input.rgb * tex0.rgb * 2.0;","_output.a = tex0.a * 2.0;"],PS_Combiners_Opaque:[1,"_output.rgb = _input.rgb * tex0.rgb;","_output.a = 1.0;"],PS_Combiners_Add_Add:[2,"_output.rgb = (_input.rgb + tex0.rgb) + tex1.rgb;","_output.a = (_input.a + tex0.a) + tex1.a;"],PS_Combiners_Add_Mod:[2,"_output.rgb = (_input.rgb + tex0.rgb) * tex1.rgb;","_output.a = (_input.a + tex0.a) * tex1.a;"],PS_Combiners_Add_Mod2x:[2,"_output.rgb = (_input.rgb + tex0.rgb) * tex1.rgb * 2.0;","_output.a = (_input.a + tex0.a) * tex1.a * 2.0;"],PS_Combiners_Add_Opaque:[2,"_output.rgb = (_input.rgb + tex0.rgb) * tex1.rgb;","_output.a = _input.a + tex0.a;"],PS_Combiners_Mod_AddNA:[2,"_output.rgb = (_input.rgb * tex0.rgb);","_output.a = tex0.a;","_specular = tex1.rgb;"],PS_Combiners_Mod_Mod:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb;","_output.a = tex0.a * tex1.a;"],PS_Combiners_Mod_Mod2x:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 2.0;","_output.a = tex0.a * tex1.a * 2.0;"],PS_Combiners_Mod_Add:[2,"_output.rgb = (_input.rgb * tex0.rgb);","_output.a = tex0.a + tex1.a;","_specular = tex1.rgb;"],PS_Combiners_Mod_Mod2xNA:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 2.0;","_output.a = tex0.a;"],PS_Combiners_Mod_Opaque:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb;","_output.a = tex0.a;"],PS_Combiners_Mod2x_Add:[2,"_output.rgb = (_input.rgb * tex0.rgb) * 2.0 + tex1.rgb;","_output.a = (tex0.a) * 2.0 + tex1.a;"],PS_Combiners_Mod2x_Mod2x:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 4.0;","_output.a = (tex0.a) * tex1.a * 4.0;"],PS_Combiners_Mod2x_Opaque:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 2.0;","_output.a = tex0.a * 2.0;"],PS_Combiners_Opaque_Add:[2,"_output.rgb = (_input.rgb * tex0.rgb) + tex1.rgb;","_output.a = _input.a + tex1.a;"],PS_Combiners_Opaque_AddAlpha:[2,"_output.rgb = (_input.rgb * tex0.rgb);","_specular = (tex1.rgb * tex1.a);"],PS_Combiners_Opaque_AddAlpha_Wgt:[2,"_output.rgb = (_input.rgb * tex0.rgb);","_specular = (tex1.rgb * tex1.a) * uTexSampleAlpha.g;"],PS_Combiners_Opaque_AddAlpha_Alpha:[2,"_output.rgb = (_input.rgb * tex0.rgb);","_specular = (tex1.rgb * tex1.a * (1.0 - tex0.a));"],PS_Combiners_Opaque_AddNA:[2,"_output.rgb = (_input.rgb * tex0.rgb) + tex1.rgb;","_output.a = _input.a;"],PS_Combiners_Opaque_Mod:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb;","_output.a = tex1.a;"],PS_Combiners_Opaque_Mod2x:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 2.0;","_output.a = tex1.a * 2.0;"],PS_Combiners_Opaque_Mod2xNA:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 2.0;",""],PS_Combiners_Opaque_Mod2xNA_Alpha:[2,"_output.rgb = _input.rgb * mix(tex0.rgb * tex1.rgb * 2.0, tex0.rgb, vec3(tex0.a));",""],PS_Combiners_Opaque_Opaque:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb;",""],PS_Combiners_Opaque_Mod2xNA_Alpha_Add:[3,"_output.rgb = _input.rgb * mix(tex0.rgb * tex1.rgb * 2.0, tex0.rgb, vec3(tex0.a));","_specular = tex2.rgb * tex2.a * uTexSampleAlpha.b;"],PS_Combiners_Mod_Mod_Mod_Const:[3,"_output.rgb = _input.rgb * (tex0 * tex1 * tex2).rgb;","_output.a = (tex0 * tex1 * tex2).a;"],PS_Combiners_Mod_AddAlpha:[2,"_output.rgb = (_input.rgb * tex0.rgb);","_output.a = tex0.a;","_specular = tex1.rgb * tex1.a;"],PS_Combiners_Mod_AddAlpha_Wgt:[2,"_output.rgb = (_input.rgb * tex0.rgb);","_output.a = tex0.a;","_specular = tex1.rgb * tex1.a * uTexSampleAlpha.g;"],PS_Combiners_Mod_AddAlpha_Alpha:[2,"_output.rgb = _input.rgb * tex0.rgb;","_output.a = (tex0.a + tex1.a * (0.3 * tex1.r + 0.59 * tex1.g + 0.11 * tex1.b));","_specular = tex1.rgb * tex1.a * (1.0 - tex0.a);"],PS_Combiners_Opaque_Mod_Add_Wgt:[2,"_output.rgb = _input.rgb * mix(tex0.rgb, tex1.rgb, vec3(tex1.a));","_specular = (tex0.rgb * tex0.a) * uTexSampleAlpha.r;"],PS_Guild:[3,"_output.rgb = _input.rgb * mix(tex0.rgb * mix(vec3(1.0, 1.0, 1.0), tex1.rgb * vec3(1.0, 1.0, 1.0), vec3(tex1.a)), tex2.rgb * vec3(1.0, 1.0, 1.0), vec3(tex2.a));","_output.a = tex0.a;"],PS_Guild_Opaque:[3,"_output.rgb = _input.rgb * mix(tex0.rgb * mix(vec3(1.0, 1.0, 1.0), tex1.rgb * vec3(1.0, 1.0, 1.0), vec3(tex1.a)), tex2.rgb * vec3(1.0, 1.0, 1.0), vec3(tex2.a));",""],PS_Guild_NoBorder:[2,"_output.rgb = _input.rgb * tex0.rgb * mix(vec3(1.0, 1.0, 1.0), tex1.rgb * vec3(1.0, 1.0, 1.0), vec3(tex1.a));","_output.a = tex0.a;"],PS_Combiners_Opaque_Alpha_Alpha:[2,"_output.rgb = _input.rgb * mix(mix(tex0.rgb, tex1.rgb, vec3(tex1.a)), tex0.rgb, vec3(tex0.a));",""],PS_Combiners_Opaque_Mod2xNA_Alpha_3s:[3,"_output.rgb = _input.rgb * mix(tex0.rgb * tex1.rgb * 2.0, tex2.rgb, vec3(tex2.a));"],PS_Combiners_Mod_Add_Alpha:[2,"_output.rgb = _input.rgb * tex0.rgb;","_output.a = (tex0.a + tex1.a);","_specular = tex1.rgb * (1.0 - tex0.a);"],PS_Combiners_Opaque_ModNA_Alpha:[2,"_output.rgb = _input.rgb * mix(tex0.rgb * tex1.rgb, tex0.rgb, vec3(tex0.a));",""],PS_Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha:[3,"float glowOpacity = clamp((tex2.a * vec4(1.0, 1.0, 1.0, 1.0).z), 0.0, 1.0); _output.rgb = _input.rgb * mix(tex0.rgb * tex1.rgb * 2.000000, tex0.rgb, vec3(tex0.a)) * (1.0 - glowOpacity);","_specular = tex2.rgb * glowOpacity;"],PS_Combiners_Opaque_Mod2xNA_Alpha_Alpha:[3,"_output.rgb = _input.rgb * mix(mix(tex0.rgb * tex1.rgb * 2.000000, tex2.rgb, vec3(tex2.a)), tex0.rgb, vec3(tex0.a));",""],PS_Combiners_Mod_Depth:[1,"_output.rgb = _input.rgb * tex0.rgb;","_output.a = tex0.a;"],PS_Combiners_Opaque_Alpha:[2,"_output.rgb = _input.rgb * mix(tex0.rgb, tex1.rgb, vec3(tex1.a));",""],Skin:[3,"//Fresnel Rim\r\nif (uHasSpecEmiss) {\r\n    vec3 emissiveColor = tex2.rgb;\r\n    vec3 emissiveTerm = tex2.rgb;\r\n    if (uHasEmissiveGlowing) {\r\n        vec3 eyeVec_120 = vPosition.xyz;\r\n        vec3 t121 = -(eyeVec_120);\r\n        vec2 term_126 = vec2(dot(t121, vNormal), dot(normalize(t121), (vNormal * vec3(0.0500000007, 0.0500000007, 1.0))));\r\n        vec2 invTerm_128 = (vec2(1.0) - clamp(term_126, 0.0, 1.0));\r\n        vec2 f_129 = (invTerm_128 * invTerm_128);\r\n        float fresnel_rim_133 = pow((f_129.x + f_129.y), 0.600000024);\r\n        vec3 t136 = (tex2.rgb /*+ ((vec3(0.0500000007, 0.0, 0.400000006) * 1.0) * fresnel_rim_133)*/);\r\n        emissiveColor = vec3(t136.r, tex2.g, t136.b);\r\n\r\n        float t267 = dot(normalize(vNormal),  normalize(-(vPosition.xyz)));\r\n        emissiveTerm = mix(vec3(0.0), 2.0*emissiveColor, vec3(pow(clamp(t267, 0.0, 1.0), (( 128.0 * (tex2.a)) + 9.99999975e-006))));\r\n    }\r\n\r\n    _output.rgb = _input.rgb * tex0.rgb + tex1.rgb + emissiveTerm.rgb;\r\n} else {\r\n    _output.rgb = _input.rgb * tex0.rgb;\r\n}\r\n_output.a = tex0.a; //\r\n"],PS_Combiners_Mod_Dual_Crossfade:[3,"_output.rgb = _input.rgb * mix(mix(tex0, texture2D(uTexture2,vTexCoord1), vec4(clamp(uTexSampleAlpha.g, 0.000000, 1.000000))), texture2D(uTexture3,vTexCoord1), vec4(clamp(uTexSampleAlpha.b, 0.000000, 1.000000))).rgb;","_output.a = mix(mix(tex0, texture2D(uTexture2,vTexCoord1), vec4(clamp(uTexSampleAlpha.g, 0.000000, 1.000000))), texture2D(uTexture3,vTexCoord1), vec4(clamp(uTexSampleAlpha.b, 0.000000, 1.000000))).a;"],PS_Combiners_Mod_Masked_Dual_Crossfade:[4,"_output.rgb = _input.rgb * mix(mix(tex0, texture2D(uTexture2,texCoord), vec4(clamp(uTexSampleAlpha.g, 0.000000, 1.000000))), texture2D(uTexture3,texCoord), vec4(clamp(uTexSampleAlpha.b, 0.000000, 1.000000))).rgb;","_output.a = mix(mix(tex0, texture2D(uTexture2,texCoord), vec4(clamp(uTexSampleAlpha.g, 0.000000, 1.000000))), texture2D(uTexture3,texCoord), vec4(clamp(uTexSampleAlpha.b, 0.000000, 1.000000))).a * texture(uTexture4,texCoord2).a;"],PS_Combiners_Mod_Mod_Depth:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb;","_output.a = tex0.a * tex1.a;"]},Li=Pi;const Ni=class{constructor(t){this.e=t,this.b=new Set}a(){const t=this.b;return this.b=new Set,t}d(t){this.b.has(t)||(this.e.enableVertexAttribArray(t),this.b.add(t))}c(t){const e=this.e;[...t].filter(t=>!this.b.has(t)).forEach(t=>e.disableVertexAttribArray(t))}};const ji=class{};const Hi=class{};const qi=class extends Hi{};function Vi(){var t=new Re(4);return Re!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Xi(t,e,i,s){var r=new Re(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=s,r}function Yi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Wi(t,e,i,s,r){return t[0]=e,t[1]=i,t[2]=s,t[3]=r,t}function Ki(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function Zi(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Qi(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function $i(t){var e=t[0],i=t[1],s=t[2],r=t[3];return Math.hypot(e,i,s,r)}function Ji(t,e){var i=e[0],s=e[1],r=e[2],n=e[3],a=i*i+s*s+r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=i*a,t[1]=s*a,t[2]=r*a,t[3]=n*a,t}function ts(t,e,i){var s=e[0],r=e[1],n=e[2],a=e[3];return t[0]=i[0]*s+i[4]*r+i[8]*n+i[12]*a,t[1]=i[1]*s+i[5]*r+i[9]*n+i[13]*a,t[2]=i[2]*s+i[6]*r+i[10]*n+i[14]*a,t[3]=i[3]*s+i[7]*r+i[11]*n+i[15]*a,t}var es=$i;!function(){var t=Vi()}();const is=class extends qi{constructor(t,e){super(),this.h=e,this.cba=Be(),this.j=Pe(0,0,0),this.ed=Vi(),this.i=Xi(0,0,0,0),this.g=new Ei(t,40*e.length/4,!0),this.ba(e)}dc(t,e){const i=this.f;let s=this.h.length;for(let r=0;r<s;++r){if(!e.has(r))continue;Ge(this.j,0,0,0),Wi(this.i,0,0,0,0);const s=this.h[r];let n=!1;for(let e=0;e<4;++e){const i=s.g[e]/255;if(i>0){const r=t[s.b[e]];Je(this.cba,s.a,r.j),ts(this.ed,s.d,r.g),this.j[0]=this.j[0]+this.cba[0]*i,this.j[1]=this.j[1]+this.cba[1]*i,this.j[2]=this.j[2]+this.cba[2]*i,this.i[0]=this.i[0]+this.ed[0]*i,this.i[1]=this.i[1]+this.ed[1]*i,this.i[2]=this.i[2]+this.ed[2]*i,n=!0}}if(n){let t=10*r;i[t++]=this.j[0],i[t++]=this.j[1],i[t++]=this.j[2],i[t++]=this.i[0],i[t++]=this.i[1],i[t++]=this.i[2]}}this.g.d(this.f)}ba(t){const e=40*t.length/4;this.f=new Float32Array(e);const i=this.f,s=t;let r=0;for(let t=0;t<s.length;++t)i[r++]=s[t].a[0],i[r++]=s[t].a[1],i[r++]=s[t].a[2],i[r++]=s[t].d[0],i[r++]=s[t].d[1],i[r++]=s[t].d[2],i[r++]=s[t].h,i[r++]=s[t].f,i[r++]=s[t].i,i[r++]=s[t].e;this.g.d(this.f)}d(t){this.g.d(t)}a(){return this.g.a()}c(){this.g.c()}b(){this.g.b()}};const ss=class extends qi{constructor(t,e){super(),this.f=e,this.cba=new Ei(t,48*e.length,!0),this.ba(e)}dc(t,e){}ba(t){const e=48*t.length;this.ed=new Uint8Array(e);let i=new DataView(this.ed.buffer);const s=t;let r=0;for(let t=0;t<s.length;++t)i.setFloat32(r,s[t].a[0],!0),r+=4,i.setFloat32(r,s[t].a[1],!0),r+=4,i.setFloat32(r,s[t].a[2],!0),r+=4,i.setFloat32(r,s[t].d[0],!0),r+=4,i.setFloat32(r,s[t].d[1],!0),r+=4,i.setFloat32(r,s[t].d[2],!0),r+=4,i.setUint8(r,s[t].b[0]),r+=1,i.setUint8(r,s[t].b[1]),r+=1,i.setUint8(r,s[t].b[2]),r+=1,i.setUint8(r,s[t].b[3]),r+=1,i.setUint8(r,s[t].g[0]),r+=1,i.setUint8(r,s[t].g[1]),r+=1,i.setUint8(r,s[t].g[2]),r+=1,i.setUint8(r,s[t].g[3]),r+=1,i.setFloat32(r,s[t].h,!0),r+=4,i.setFloat32(r,s[t].f,!0),r+=4,i.setFloat32(r,s[t].i,!0),r+=4,i.setFloat32(r,s[t].e,!0),r+=4;this.cba.d(this.ed)}d(t){this.cba.d(t)}a(){return this.cba.a()}c(){this.cba.c()}b(){this.cba.b()}};const rs=class{a(){return{}}b(t){}};const ns=class{constructor(t,e){this.c=t,this.d=e,this.d=256,this.ba=new Float32Array(16*this.d),this.e=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null)}a(){return{uBoneMatricesTex:this.e}}b(t){const e=Math.min(256,t.length);for(let i=0;i<e;i++)this.ba.set(t[i].j,16*i);const i=this.c;i.bindTexture(i.TEXTURE_2D,this.e),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,4,this.d,0,i.RGBA,i.FLOAT,this.ba),i.bindTexture(i.TEXTURE_2D,null)}};var as;!function(t){t[t.aPosition=0]="aPosition",t[t.aNormal=1]="aNormal",t[t.aTexCoord0=2]="aTexCoord0",t[t.aTexCoord1=3]="aTexCoord1"}(as||(as={}));const os={aPosition:as.aPosition,aNormal:as.aNormal,aTexCoord0:as.aTexCoord0,aTexCoord1:as.aTexCoord1},hs=[new Ci(as.aPosition,3,Ai.GFLOAT,!1,40,0),new Ci(as.aNormal,3,Ai.GFLOAT,!1,40,12),new Ci(as.aTexCoord0,2,Ai.GFLOAT,!1,40,24),new Ci(as.aTexCoord1,2,Ai.GFLOAT,!1,40,32)];var ls;!function(t){t[t.aPosition=0]="aPosition",t[t.aNormal=1]="aNormal",t[t.aBones=2]="aBones",t[t.aBoneWeights=3]="aBoneWeights",t[t.aTexCoord0=4]="aTexCoord0",t[t.aTexCoord1=5]="aTexCoord1"}(ls||(ls={}));const us={aPosition:ls.aPosition,aNormal:ls.aNormal,aBones:ls.aBones,aBoneWeights:ls.aBoneWeights,aTexCoord0:ls.aTexCoord0,aTexCoord1:ls.aTexCoord1},cs=[new Ci(ls.aPosition,3,Ai.GFLOAT,!1,48,0),new Ci(ls.aNormal,3,Ai.GFLOAT,!1,48,12),new Ci(ls.aBones,4,Ai.GUNSIGNED_BYTE,!1,48,24),new Ci(ls.aBoneWeights,4,Ai.GUNSIGNED_BYTE,!0,48,28),new Ci(ls.aTexCoord0,2,Ai.GFLOAT,!1,48,32),new Ci(ls.aTexCoord1,2,Ai.GFLOAT,!1,48,40)];var ds;!function(t){t[t.aPosition=0]="aPosition",t[t.aColor=1]="aColor",t[t.aTexcoord0=2]="aTexcoord0",t[t.aTexcoord1=3]="aTexcoord1",t[t.aTexcoord2=4]="aTexcoord2",t[t.aAlphaCutoff=5]="aAlphaCutoff"}(ds||(ds={}));const fs={[ds.aPosition]:ds.aPosition,[ds.aColor]:ds.aColor,[ds.aTexcoord0]:ds.aTexcoord0,[ds.aTexcoord1]:ds.aTexcoord1,[ds.aTexcoord2]:ds.aTexcoord2,[ds.aAlphaCutoff]:ds.aAlphaCutoff},gs=[new Ci(ds.aPosition,3,Ai.GFLOAT,!1,56,0),new Ci(ds.aColor,4,Ai.GFLOAT,!1,56,12),new Ci(ds.aTexcoord0,2,Ai.GFLOAT,!1,56,28),new Ci(ds.aTexcoord1,2,Ai.GFLOAT,!1,56,36),new Ci(ds.aTexcoord2,2,Ai.GFLOAT,!1,56,44),new Ci(ds.aAlphaCutoff,1,Ai.GFLOAT,!1,56,52)];var _s;!function(t){t[t.aPosition=0]="aPosition",t[t.aColor=1]="aColor",t[t.aTexcoord0=2]="aTexcoord0"}(_s||(_s={}));const bs={[_s.aPosition]:_s.aPosition,[_s.aColor]:_s.aColor,[_s.aTexcoord0]:_s.aTexcoord0},ps=[new Ci(_s.aPosition,3,Ai.GFLOAT,!1,36,0),new Ci(_s.aColor,4,Ai.GFLOAT,!1,36,12),new Ci(_s.aTexcoord0,2,Ai.GFLOAT,!1,36,28)];const ms=class{constructor(t,e){this.hg=t,this.ji=e,this.lk=new Map,this.ba=new Ni(t.o());const i=t.o();this.dc=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.dc),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([0,0,0,0])),i.bindTexture(i.TEXTURE_2D,null)}fe(){throw new Error("Method not implemented.")}g(){return this.hg}n(t){return new yi(this.hg.o(),t,!1)}o(t){return this.hg.h?new ss(this.hg.o(),t):new is(this.hg.o(),t)}d(t){return new Ei(this.hg.o(),t,!0)}a(t){return new Ei(this.hg.o(),t,!0)}h(t,e){const i=this.hg.g(),s=i?new Si(this.hg.o(),i):new Fi(this.hg.o(),this.ba),r=this.hg.h?cs:hs;return s.b(t,r),s.c(e),s}c(t,e){const i=this.hg.g(),s=i?new Si(this.hg.o(),i):new Fi(this.hg.o(),this.ba);return s.c(e),s.b(t,gs),s}k(t,e){const i=this.hg.g(),s=i?new Si(this.hg.o(),i):new Fi(this.hg.o(),this.ba);return s.c(e),s.b(t,ps),s}l(t,e,i,s){return this.hg.h?new ns(this.hg.o(),t):new rs}e(t,e,i){const s=Li.d(i.b,i.a.length),r=Li.f(i.b,i.a.length),n="Wow."+r+"_"+s+(i.c?"_gradient":"");let a;this.lk.has(n)?a=this.lk.get(n):(a=new Oi(this.hg.o(),this.hg.h?us:os,Li.g(r,this.hg.h),Li.a(r,s,i.c)),this.lk.set(n,a));const o=Object.assign(Object.assign(Object.assign({},this.ji),t.a()),i.d);for(let t=0;t<Math.max(i.a.length,4);t++){let e=t<i.a.length?i.a[t].l:this.dc;o["uTexture"+(t+1).toString()]=e}return new Bi(this.hg.o(),a,e,o)}m(t,e,i){const s=Object.assign(Object.assign(Object.assign({},this.ji),t.a()),i.b);let r;const n="ParticleShader";this.lk.has(n)?r=this.lk.get(n):(r=new Oi(this.hg.o(),fs,"attribute vec3 aPosition;\r\nattribute vec4 aColor;\r\nattribute vec2 aTexcoord0;\r\nattribute vec2 aTexcoord1;\r\nattribute vec2 aTexcoord2;\r\nattribute float aAlphaCutoff;\r\n\r\nvarying vec4 vColor;\r\nvarying vec2 vTexcoord0;\r\nvarying vec2 vTexcoord1;\r\nvarying vec2 vTexcoord2;\r\nvarying float vAlphaCutoff;\r\n\r\nuniform mat4 uModelMatrix;\r\nuniform mat4 uViewMatrix;\r\nuniform mat4 uProjMatrix;\r\n\r\nvoid main(void) {\r\n    vec4 pos = vec4(aPosition, 1);\r\n\r\n    gl_Position = uProjMatrix * pos;\r\n\r\n    vColor = aColor;\r\n    vTexcoord0 = aTexcoord0;\r\n    vTexcoord1 = aTexcoord1;\r\n    vTexcoord2 = aTexcoord2;\r\n    vAlphaCutoff = aAlphaCutoff;\r\n}","precision mediump float;\r\n\r\nvarying vec4 vColor;\r\nvarying vec2 vTexcoord0;\r\nvarying vec2 vTexcoord1;\r\nvarying vec2 vTexcoord2;\r\nvarying float vAlphaCutoff;\r\n\r\nuniform bool uHasTexture;\r\nuniform bool uHasTexture2;\r\nuniform bool uHasTexture3;\r\nuniform bool uHasAlpha;\r\nuniform int uBlendMode;\r\nuniform int uPixelShader;\r\nuniform sampler2D uTexture0;\r\nuniform sampler2D uTexture1;\r\nuniform sampler2D uTexture2;\r\nuniform float uAlphaTreshold;\r\n\r\nuniform float alphaMult;\r\nuniform float colorMult;\r\n\r\nvoid main(void) {\r\n    float lo_thresh = 0.01;\r\n    vec4 color = vec4(1, 1, 1, 1);\r\n    vec4 tex = vec4(1, 1, 1, 1);\r\n    vec4 tex2 = vec4(1, 1, 1, 1);\r\n    vec4 tex3 = vec4(1, 1, 1, 1);\r\n    if (uHasTexture) {\r\n        tex = texture2D(uTexture0, vTexcoord0).rgba;\r\n    }\r\n    if (uHasTexture2) {\r\n        tex2 = texture2D(uTexture1, vTexcoord1).rgba;\r\n    }\r\n    if (uHasTexture3) {\r\n        tex3 = texture2D(uTexture2, vTexcoord2).rgba;\r\n    }\r\n    vec4 finalColor = vec4((tex * vColor ).rgb, tex.a*vColor.a );\r\n    vec3 matDiffuse = vec3(1.0);\r\n    float opacity = 1.0;\r\n    if (uPixelShader == 0) {\r\n        matDiffuse = vColor.xyz * tex.rgb;\r\n        opacity = tex.a*vColor.a;\r\n    } else if (uPixelShader == 1) {\r\n        vec4 textureMod = tex*tex2;\r\n        float texAlpha = (textureMod.w * tex3.w);\r\n        opacity = texAlpha*vColor.a;\r\n        matDiffuse = vColor.xyz * 4.0 * textureMod.rgb;\r\n    } else if (uPixelShader == 2) {\r\n        vec4 textureMod = tex*tex2*tex3;\r\n        float texAlpha = (textureMod.w);\r\n        opacity = texAlpha*vColor.a;\r\n        matDiffuse = vColor.xyz * textureMod.rgb;\r\n    } else if (uPixelShader == 3) {\r\n        vec4 textureMod = tex*tex2*tex3;\r\n        float texAlpha = (textureMod.w);\r\n        opacity = texAlpha*vColor.a;\r\n\r\n        matDiffuse = vColor.xyz * textureMod.rgb;\r\n    } else if (uPixelShader == 4) {\r\n        discard;\r\n    }\r\n\r\n    finalColor = vec4(matDiffuse.rgb * colorMult, opacity * alphaMult);\r\n\r\n    if (finalColor.a < vAlphaCutoff ) discard;\r\n    if (finalColor.a < uAlphaTreshold ) discard;\r\n    gl_FragColor = finalColor;\r\n}\r\n"),this.lk.set(n,r));for(let t=0;t<i.a.length;t++)i.a[t]&&(s["uTexture"+t.toString()]=i.a[t].l);return new Bi(this.hg.o(),r,e,s)}i(t,e,i){const s=Object.assign(Object.assign(Object.assign({},this.ji),t.a()),i.b);let r;const n="RibbonShader";return this.lk.has(n)?r=this.lk.get(n):(r=new Oi(this.hg.o(),bs,"attribute vec3 aPosition;\r\nattribute vec4 aColor;\r\nattribute vec2 aTexcoord0;\r\n\r\nuniform mat4 uViewMatrix;\r\nuniform mat4 uProjMatrix;\r\n\r\nvarying vec4 vColor;\r\nvarying vec2 vTexcoord0;\r\n\r\nvoid main() {\r\n    vec4 aPositionVec4 = vec4(aPosition, 1);\r\n    vColor = aColor;\r\n    vTexcoord0 = aTexcoord0;\r\n\r\n    gl_Position = uProjMatrix * uViewMatrix * aPositionVec4;\r\n}\r\n\r\n\r\n","precision mediump float;\r\n\r\nvarying vec4 vColor;\r\nvarying vec2 vTexcoord0;\r\nuniform sampler2D uTexture;\r\n\r\nvoid main() {\r\n    vec4 tex = texture2D(uTexture, vTexcoord0).rgba;\r\n    gl_FragColor = vec4((vColor.rgb*tex.rgb), tex.a * vColor.a );\r\n}\r\n"),this.lk.set(n,r)),s["uTexture".toString()]=i.a[0].l,new Bi(this.hg.o(),r,e,s)}b(t,e,i,s){const r=this.hg.o();let n=new ji;return n.b=e,n.g=t.b,n.e=r.TRIANGLES,n.f=t.a,n.h=t.c,n.a=s,n.c=i,n}f(t,e,i,s){const r=this.hg.o();let n=new ji;return n.b=e,n.g=t.b,n.e=r.TRIANGLE_STRIP,n.f=t.a,n.h=t.c,n.a=s,n.c=i,n}j(t){const e=this.hg.o(),i=e.createTexture();function s(t){return!(t&t-1)}e.bindTexture(e.TEXTURE_2D,i),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),s(t.width)&&s(t.height)?e.generateMipmap(e.TEXTURE_2D):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR));const r=this.hg.fe;return r&&e.texParameteri(e.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY_EXT,this.hg.j),i}};var xs;!function(t){t[t.GxBlend_UNDEFINED=-1]="GxBlend_UNDEFINED",t[t.GxBlend_Opaque=0]="GxBlend_Opaque",t[t.GxBlend_AlphaKey=1]="GxBlend_AlphaKey",t[t.GxBlend_Alpha=2]="GxBlend_Alpha",t[t.GxBlend_Add=3]="GxBlend_Add",t[t.GxBlend_Mod=4]="GxBlend_Mod",t[t.GxBlend_Mod2x=5]="GxBlend_Mod2x",t[t.GxBlend_ModAdd=6]="GxBlend_ModAdd",t[t.GxBlend_InvSrcAlphaAdd=7]="GxBlend_InvSrcAlphaAdd",t[t.GxBlend_InvSrcAlphaOpaque=8]="GxBlend_InvSrcAlphaOpaque",t[t.GxBlend_SrcAlphaOpaque=9]="GxBlend_SrcAlphaOpaque",t[t.GxBlend_NoAlphaAdd=10]="GxBlend_NoAlphaAdd",t[t.GxBlend_ConstantAlpha=11]="GxBlend_ConstantAlpha",t[t.GxBlend_Screen=12]="GxBlend_Screen",t[t.GxBlend_BlendAdd=13]="GxBlend_BlendAdd",t[t.GxBlend_MAX=14]="GxBlend_MAX"}(xs||(xs={}));const vs=xs;const Ts=class{constructor(t){this.p=t,this.fe=-1,this.t=-1,this.q=-1,this.k=-1,this.m=-1,this.n=vs.GxBlend_UNDEFINED,this.hg=null,this.l=null,this.ji=null,this.r=null,this.s=null}ba(){this.fe=-1,this.t=-1,this.q=-1,this.k=-1,this.m=-1,this.n=vs.GxBlend_UNDEFINED,this.hg=null,this.l=null,this.ji=null,this.r=null,this.s=null}f(t){this.n!=t&&(this.o(t),this.n=t)}b(t){const e=t?1:0;e!=this.fe&&(this.p.depthMask(t),this.fe=e)}h(t){const e=t?1:0;e!=this.t&&(t?this.p.enable(this.p.DEPTH_TEST):this.p.disable(this.p.DEPTH_TEST),this.t=e)}g(t){const e=t?1:0;e!=this.q&&(t?this.p.enable(this.p.CULL_FACE):this.p.disable(this.p.CULL_FACE),this.q=e)}j(t){const e=t?1:0;e!=this.k&&(t?this.p.frontFace(this.p.CCW):this.p.frontFace(this.p.CW),this.k=e)}c(t){this.m!=t&&(this.p.colorMask((1&t)>0,(2&t)>0,(4&t)>0,(8&t)>0),this.m=t)}e(t){this.l!=t&&(t?t.c():t.b(),this.l=t)}i(t){this.hg!=t&&(t?t.c():t.b(),this.hg=t)}d(t){this.ji!=t&&(t?t.a():this.ji.d(),this.ji=t,this.hg=null,this.l=null)}a(t){t!=this.r&&(t&&t.a(),this.r=t)}o(t){const e=this.p;switch(0==t?e.disable(e.BLEND):(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD)),t){case 0:break;case 1:e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ONE);break;case 2:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE,e.ONE,e.ONE);break;case 4:e.blendFuncSeparate(e.DST_COLOR,e.ZERO,e.ONE,e.ONE);break;case 5:e.blendFuncSeparate(e.DST_COLOR,e.SRC_COLOR,e.ONE,e.ONE);break;case 6:e.blendFuncSeparate(e.DST_COLOR,e.ONE,e.ONE,e.ONE);break;case 10:e.blendFunc(e.ONE,e.ONE);break;case 7:e.blendFuncSeparate(e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE,e.ONE);break;case 8:e.blendFuncSeparate(e.ONE_MINUS_SRC_ALPHA,e.ZERO,e.ONE,e.ONE);break;case 13:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE);break;default:throw 3735927486}}dc(t){this.s!=t&&(t.b(this),this.s=t)}};const ws=class{constructor(t,e){this.dc=t,this.l=e,this.ba=!1,this.h=!1,this.n=t.getExtension("OES_vertex_array_object"),this.fe=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.fe?(this.j=t.getParameter(this.fe.MAX_TEXTURE_MAX_ANISOTROPY_EXT),WH.debug("Texture anisotropy enabled",this.j)):WH.debug("Texture anisotropy disabled (not supported)"),this.ba=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0,this.k=t.getExtension("OES_texture_float"),this.h=this.ba&&null!=this.k,this.h?WH.debug("(float texture) Skinning in shader is supported"):WH.debug("(float texture) Skinning in shader is (not supported) "),this.i=new ms(this,e),this.m=new Ts(t)}o(){return this.dc}g(){return this.n}c(){return this.i}d(t){const e=this.m,i=this.o();e.d(t.g),e.dc(t.b),i.drawElements(t.e,t.h,i.UNSIGNED_SHORT,t.f)}e(){this.m.ba()}a(){this.m.d(null)}b(t){this.e(),t.forEach(t=>{this.d(t)}),this.a()}};const ys=class{constructor(t,e){this.k=t,this.i=e,this.l=null,this.h=!1,this.g=0,this.f=0,0!=e&&(this.a=t.options.contentPath+"textures/"+e+WH.WebP.getImageExtension(),this.e=new Image,this.e.onload=()=>{this.c()},this.e.onerror=()=>{this.e=null},this.b(this.e,this.a))}b(t,e){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=e=>{var s=new Blob([i.response]);t.src=window.URL.createObjectURL(s)},i.addEventListener("progress",t=>{const i=this.k;i&&t.lengthComputable&&(i.downloads[e]?i.downloads[e].loaded=t.loaded:i.downloads[e]={loaded:t.loaded,total:t.total},i.updateProgress())}),i.addEventListener("load",()=>{const t=this.k;t&&(delete t.downloads[e],t.updateProgress())}),i.send()}d(){return this.h}j(){this.l=null}c(){this.g=this.e.width,this.f=this.e.height,this.l=this.k.renderer.j(this.e),this.h=!0,this.e=null}},Es={147259:!0},As=[1,1,1,1,1,1,1,2,1,1,1,1,1,1,0,1,0,0,1,1,1,1,1,1,0,0,1,0,1,0,0,0,2,1,1,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1],Cs={2:{GeosetType:15,Original:2,Override:11},3:{GeosetType:15,Original:3,Override:12},4:{GeosetType:15,Original:4,Override:13},5:{GeosetType:15,Original:5,Override:14},6:{GeosetType:15,Original:6,Override:15},7:{GeosetType:15,Original:7,Override:16},8:{GeosetType:15,Original:8,Override:17},9:{GeosetType:15,Original:9,Override:18},10:{GeosetType:15,Original:10,Override:19},11:{GeosetType:12,Original:2,Override:0},12:{GeosetType:12,Original:3,Override:0},13:{GeosetType:12,Original:1,Override:5},14:{GeosetType:12,Original:2,Override:3},15:{GeosetType:12,Original:2,Override:2},16:{GeosetType:22,Original:2,Override:1},17:{GeosetType:22,Original:1,Override:2},18:{GeosetType:22,Original:1,Override:3},19:{GeosetType:22,Original:2,Override:3},20:{GeosetType:12,Original:1,Override:1},21:{GeosetType:12,Original:1,Override:9},22:{GeosetType:12,Original:2,Override:10},23:{GeosetType:12,Original:2,Override:6},24:{GeosetType:12,Original:1,Override:5},25:{GeosetType:27,Original:0,Override:1},26:{GeosetType:27,Original:0,Override:1},27:{GeosetType:27,Original:0,Override:1},28:{GeosetType:13,Original:1,Override:0},31:{GeosetType:12,Original:1,Override:13},32:{GeosetType:12,Original:2,Override:14},33:{GeosetType:42,Original:11,Override:1},38:{GeosetType:20,Original:1,Override:9}},Ms={ITEM:1,HELM:2,SHOULDER:4,NPC:8,CHARACTER:16,HUMANOIDNPC:32,OBJECT:64,ARMOR:128,PATH:256,ITEMVISUAL:512,COLLECTION:1024},Ss=[0,1,0,3,4,5,6,7,8,9,10,0,0,21,22,22,16,21,0,19,5,21,22,22,0,21,21,27],Fs=[0,16,0,15,1,7,10,5,6,6,8,0,0,17,18,19,14,20,0,9,7,21,22,23,0,24,25,0],ks=[0,0,0,0,0,0,0,0,0,0,0,0,0,22,0,0,0,22,0,0,0,0,0,0,0,0,0,0],Is=[0,2,0,4,128,128,128,128,128,128,128,0,0,1,1,1,128,1,0,128,128,1,1,1,0,1,1,2],Ds=[13,14,15,16,17,88,89],Us=[8,9,10,11,12,86,87],Rs={86:[4,0,4,1,4,0,4,1],85:[84,0,84,1,84,0,84,1],84:[3,0,3,1,3,0,3,1],77:[5,1,0,-1,5,0,0,-1],76:[10,0,1,1,10,0,1,1],75:[10,0,1,1,10,0,1,1],74:[5,1,0,-1,5,0,0,-1],73:[5,1,0,-1,5,0,0,-1],72:[5,1,0,-1,5,0,0,-1],71:[5,1,0,-1,5,0,0,-1],37:[7,0,7,1,7,0,7,1],36:[2,0,2,1,2,0,2,1],34:[3,0,3,1,3,0,3,1],33:[5,1,0,-1,5,0,0,-1],31:[0,-1,8,1,0,-1,8,1],30:[11,0,11,1,11,0,11,1],29:[10,0,10,1,10,0,10,1],28:[6,0,6,1,6,0,6,1],27:[4,0,4,1,4,0,4,1],26:[24,0,24,1,24,0,24,1],25:[24,0,24,1,24,0,24,1],23:[1,0,1,1,1,0,1,1],15:[5,0,5,1,5,0,5,1],1:[0,-1,0,-1,0,-1,0,3]},Bs={21:26,22:27,15:28,17:26,25:32,13:32,23:33,14:28,26:26},Os={0:{21:26,22:27},1:{21:26,22:27},2:{21:30,22:31},3:{21:32,22:33},4:{21:26,22:27,15:28},5:{21:26},6:{21:26,22:27},7:{21:26,22:27},8:{21:26,22:27},9:{21:33,22:28}},Ps=5300,zs="precision mediump float;\r\n\r\nuniform float x;\r\nuniform float y;\r\nuniform float width;\r\nuniform float height;\r\n\r\nattribute vec2 aTextCoord;\r\nvarying vec2 vTextCoords;\r\nvoid main() {\r\n    vTextCoords = aTextCoord;\r\n\r\n    vec2 pos = vec2(\r\n        (x + aTextCoord.x*width)* 2.0 - 1.0,\r\n        (y + aTextCoord.y*height)* 2.0 - 1.0\r\n    );\r\n\r\n    gl_Position = vec4(pos.x, pos.y, 0, 1);\r\n}";class Gs{constructor(){this.c=null,this.a=null,this.b=null}e(){null!=this.c&&this.c.j(),null!=this.a&&this.a.j(),null!=this.b&&this.b.j()}d(){return!(this.c&&!this.c.d())&&(!(this.a&&!this.a.d())&&!(this.b&&!this.b.d()))}}class Ls{constructor(){this.f=null,this.j=null,this.d=null,this.g={},this.b=new ke,this.a=null,this.k=null}}const Ns={uDiffuseTexture:null,uSpecularTexture:null,uEmissiveTexture:null};class js{constructor(t,e,i){this.l=e,this.u=i,this.c=null,this.h=null,this.m=null,this.q=null,this.i=null,this.e=!1,this.f=0,this.g="",this.b=t,this.i=function(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,0,0])),t.bindTexture(t.TEXTURE_2D,null);let i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,0,255])),t.bindTexture(t.TEXTURE_2D,null);let s=new Ls;return s.a=e,s.k=i,s.f=xe(t,[zs,"precision mediump float;\r\n\r\nvarying vec2 vTextCoords;\r\nuniform sampler2D uDiffuseTexture;\r\nuniform sampler2D uSpecularTexture;\r\nuniform sampler2D uEmissiveTexture;\r\nuniform sampler2D renderResultTexture;\r\nuniform int uBlendMode;\r\nuniform vec2 screenResolution;\r\nuniform int layer;\r\n\r\nuniform float diffuseTexWidth;\r\nuniform float diffuseTexHeight;\r\n\r\nfloat overlayBlend(float a, float b) {\r\n    if (b > 0.5) {\r\n        return (1.0 - (1.0 - 2.0 * (a - 0.5)) * (1.0 - b));\r\n    } else {\r\n        return ((2.0 * a) * b);\r\n    }\r\n}\r\n\r\nfloat alphaStraightBlend(float a, float b, float alpha) {\r\n    return (a * alpha) + (b * (1.0 - alpha));\r\n}\r\n\r\nvoid main() {\r\n    vec2 l_texCoord = vTextCoords.xy;\r\n\r\n\r\n    l_texCoord.x = max(min(l_texCoord.x, (diffuseTexWidth-0.5)/diffuseTexWidth), 0.5/diffuseTexWidth);\r\n    l_texCoord.y = max(min(l_texCoord.y, (diffuseTexHeight-0.5)/diffuseTexHeight), 0.5/diffuseTexHeight);\r\n\r\n    vec4 diffuse = texture2D( uDiffuseTexture, l_texCoord );\r\n    vec4 backGround = texture2D( renderResultTexture, gl_FragCoord.xy / screenResolution );\r\n\r\n    if (uBlendMode == 1) {\r\n        // Blit (we do nothing?)\r\n        //if (diffuse.a < 0.001) discard;\r\n\r\n        //vec4 finalColor = diffuse;\r\n\r\n        //diffuse = vec4(finalColor.rgb, finalColor.a);\r\n    } else if (uBlendMode == 2) {\r\n        // Multiply\r\n        if (diffuse.a < 0.001) discard;\r\n\r\n        vec4 multTexture = diffuse;\r\n        vec3 finalColor = (backGround.rgb * multTexture.rgb);\r\n\r\n        diffuse = vec4(finalColor.rgb, 1.0);\r\n    } else if (uBlendMode == 3) {\r\n        // Overlay\r\n        if (diffuse.a < 0.001) discard;\r\n\r\n        vec4 overlayTex = diffuse;\r\n\r\n        vec3 finalColor = vec3(\r\n            overlayBlend(overlayTex.r, backGround.r),\r\n            overlayBlend(overlayTex.g, backGround.g),\r\n            overlayBlend(overlayTex.b, backGround.b)\r\n        );\r\n\r\n        vec3 mainTexVisible = backGround.rgb * (1.0 - overlayTex.a);\r\n        vec3 overlayTexVisible = finalColor.rgb * (overlayTex.a);\r\n        finalColor = (mainTexVisible + overlayTexVisible);\r\n\r\n        diffuse = vec4(finalColor, backGround.a);\r\n    } else if (uBlendMode == 5) {\r\n        // AlphaStraight\r\n        vec4 overlayTex = diffuse;\r\n\r\n        //float alphaMult = 1.0;\r\n        //vec3 finalColor = vec3(\r\n        //    alphaStraightBlend(overlayTex.r, backGround.r, alphaMult*overlayTex.a),\r\n        //    alphaStraightBlend(overlayTex.g, backGround.g, alphaMult*overlayTex.a),\r\n        //    alphaStraightBlend(overlayTex.b, backGround.b, alphaMult*overlayTex.a)\r\n        //);\r\n        vec3 finalColor = overlayTex.rgb * overlayTex.a + backGround.rgb * (1.0 - overlayTex.a);\r\n\r\n        diffuse = vec4(finalColor.rgb, 1.0);\r\n    } else if (uBlendMode == 0 || uBlendMode == 4 || uBlendMode == 6 || uBlendMode == 7) {\r\n        // default, Screen, InferAlphaBlend, Unknown1\r\n        if (diffuse.a < 0.001) discard;\r\n\r\n        vec3 finalColor = mix(backGround.rgb, diffuse.rgb, diffuse.a);\r\n\r\n        diffuse = vec4(finalColor.rgb, 1.0);\r\n    }\r\n\r\n    gl_FragColor = diffuse;\r\n}"],null,null),s.j=xe(t,[zs,"precision mediump float;\r\n\r\nvarying vec2 vTextCoords;\r\nuniform sampler2D uDiffuseTexture;\r\nuniform sampler2D uSpecularTexture;\r\nuniform sampler2D uEmissiveTexture;\r\nuniform sampler2D renderResultTexture;\r\nuniform int uBlendMode;\r\n\r\nvoid main() {\r\n    vec4 diffuse = texture2D( uDiffuseTexture, vTextCoords.xy );\r\n    vec4 specular = texture2D( uSpecularTexture, vTextCoords.xy );\r\n    if (diffuse.a < 0.001) discard;\r\n    gl_FragColor = vec4(specular.rgb, 1.0);\r\n}"],null,null),s.d=xe(t,[zs,"precision mediump float;\r\n\r\nvarying vec2 vTextCoords;\r\nuniform sampler2D uDiffuseTexture;\r\nuniform sampler2D uSpecularTexture;\r\nuniform sampler2D uEmissiveTexture;\r\nuniform sampler2D renderResultTexture;\r\nuniform int uBlendMode;\r\nuniform vec2 screenResolution;\r\nuniform float emissiveAlphaOverride;\r\nuniform int layer;\r\n\r\nvoid main() {\r\n    vec4 diffuse = texture2D( uDiffuseTexture, vTextCoords.xy );\r\n    vec4 emissive = texture2D( uEmissiveTexture, vTextCoords.xy );\r\n    vec4 backGround = texture2D( renderResultTexture, gl_FragCoord.xy / screenResolution );\r\n\r\n    if (diffuse.a < 0.001) discard;\r\n//    if (emissive.a < 0.001) discard;\r\n\r\n    //TODO: This is a hack from what was observed in Nightborne texture customization with tatoos.\r\n    //TODO: But Maybe switch should be over layer or something else instead of blend\r\n    float alpha = 1.0;\r\n\r\n    if (emissiveAlphaOverride > -1.0) {\r\n        alpha = emissiveAlphaOverride;\r\n    } else if (layer <= 1) {\r\n        alpha = 0.0;\r\n    } else {\r\n        alpha = emissive.a;\r\n    }\r\n\r\n    gl_FragColor = vec4(emissive.rgb, alpha);\r\n}"],null,null),s.g={},s.e=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s.e),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),s.c=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s.c),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Int16Array([0,1,2,1,3,2]),t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),s.h=t.createFramebuffer(),s.i={loc:t.getAttribLocation(s.f.program,"aTextCoord"),type:t.FLOAT,size:2,offset:0,stride:0},s}(t)}r(){const t=new Date,e=t.toISOString().split("T")[0],i=`${String(t.getHours()).padStart(2,"0")}-${String(t.getMinutes()).padStart(2,"0")}-${String(t.getSeconds()).padStart(2,"0")}`,s=65536*Math.random()|0;this.g=`${s}_${e}_${i}`,this.f=0;let r=this.b;this.q||(this.q=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.q),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.l,this.u,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)),this.c||(this.c=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.c),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.l,this.u,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)),this.h||(this.h=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.h),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.l,this.u,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)),this.m||(this.m=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.m),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.l,this.u,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.bindTexture(r.TEXTURE_2D,null)),r.bindFramebuffer(r.FRAMEBUFFER,this.i.h),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.c,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.h,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.m,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.useProgram(this.i.j.program),r.bindBuffer(r.ARRAY_BUFFER,this.i.e),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.i.c),this.i.b.disableAll(),this.i.b.enable(r,[this.i.i]),r.viewport(0,0,this.l,this.u)}d(t,e,i,s,r,n,a,o){const h=this.b,l=this.i;l.g.x=e,l.g.y=i,l.g.width=s,l.g.height=r,l.g.diffuseTexWidth=t.c.g,l.g.diffuseTexHeight=t.c.f,null==t.a&&null==t.b||(this.e=!0);let u=0;1==n?u=1:4==n?u=2:6==n?u=3:7==n?u=4:9==n?u=5:15==n?u=6:16==n&&(u=7),l.g.uBlendMode=u,l.g.screenResolution=new Float32Array([this.l,this.u]),l.g.uDiffuseTexture=null!=t.c?t.c.l:l.a,l.g.uSpecularTexture=null!=t.a?t.a.l:l.a,l.g.uEmissiveTexture=null!=t.b?t.b.l:l.k,l.g.renderResultTexture=null!=this.q?this.q:l.a,l.g.layer=a,l.g.emissiveAlphaOverride=o,h.disable(h.CULL_FACE),h.disable(h.DEPTH_TEST),h.disable(h.BLEND),this.t(l.f,l.g,this.c),this.t(l.j,l.g,this.h),this.t(l.d,l.g,this.m),this.f++,h.useProgram(null)}a(){let t=this.b;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST)}t(t,e,i){let s=this.b;s.useProgram(t.program),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,i,0),s.bindTexture(s.TEXTURE_2D,this.q),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,this.l,this.u,0),s.bindTexture(s.TEXTURE_2D,null),_e(t,e),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),_e(t,Ns)}s(t){if(0==t)return this.c;if(1==t)return this.h;if(2==t)return this.m;throw new Error("unknown usage "+t)}j(t){let e=null;return e={l:t,g:this.l,f:this.u,h:!0},e}n(){let t=this.b;this.q&&t.deleteTexture(this.q),this.c&&t.deleteTexture(this.c),this.h&&t.deleteTexture(this.h),this.m&&t.deleteTexture(this.m),this.c=null,this.h=null,this.m=null,this.q=null,this.i=null,this.b=null}k(t){switch(t){case 0:return this.j(this.c);case 1:return this.j(this.h);case 2:return this.j(this.m);default:return null}}p(){}o(t){}}function Hs(){var t=new Re(2);return Re!=Float32Array&&(t[0]=0,t[1]=0),t}function qs(t,e){var i=new Re(2);return i[0]=t,i[1]=e,i}function Vs(t,e,i){return t[0]=e,t[1]=i,t}function Xs(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Ys(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function Ws(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}!function(){var t=Hs()}();function Ks(){var t=new Re(9);return Re!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Zs(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Qs(t,e,i){var s=e[0],r=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],d=i[0],f=i[1],g=i[2],_=i[3],b=i[4],p=i[5],m=i[6],x=i[7],v=i[8];return t[0]=d*s+f*a+g*l,t[1]=d*r+f*o+g*u,t[2]=d*n+f*h+g*c,t[3]=_*s+b*a+p*l,t[4]=_*r+b*o+p*u,t[5]=_*n+b*h+p*c,t[6]=m*s+x*a+v*l,t[7]=m*r+x*o+v*u,t[8]=m*n+x*h+v*c,t}function $s(){var t=new Re(4);return Re!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Js(t,e,i){i*=.5;var s=Math.sin(i);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(i),t}function tr(t,e,i,s){var r,n,a,o,h,l=e[0],u=e[1],c=e[2],d=e[3],f=i[0],g=i[1],_=i[2],b=i[3];return(n=l*f+u*g+c*_+d*b)<0&&(n=-n,f=-f,g=-g,_=-_,b=-b),1-n>Ue?(r=Math.acos(n),a=Math.sin(r),o=Math.sin((1-s)*r)/a,h=Math.sin(s*r)/a):(o=1-s,h=s),t[0]=o*l+h*f,t[1]=o*u+h*g,t[2]=o*c+h*_,t[3]=o*d+h*b,t}var er,ir,sr,rr,nr,ar,or=Yi,hr=Wi,lr=Ji;er=Be(),ir=Pe(1,0,0),sr=Pe(0,1,0),rr=$s(),nr=$s(),ar=Ks();class ur{constructor(){this.e=-1,this.c=null,this.a=0,this.d=-1,this.b=!1}}class cr{constructor(){this.b=new ur,this.c=new ur,this.e=new ur,this.f=0,this.d=1,this.a=!1}}class dr{f(){var t=this;if(t.e)for(var e=0;e<t.e.length;++e)t.e[e]=null;return t.b=null,t.e=null,null}j(t,e,i,s){let r=this;if(null==s&&(s=this.i()),this.d>=0&&(t=this.d<e.length?e[this.d]:e[0]),0!=r.k||r.e.length>1){if(r.b.length>1){for(var n=-1,a=r.b.length-1,o=0;o<a;++o)if(t>=r.b[o]&&t<=r.b[o+1]){n=o;break}if(-1==n&&(n=r.b.length-1),1==r.k){var h=r.b[n],l=r.b[n+1],u=0;return t>l?(u=1,console.log("time > t2")):h!=l&&(u=(t-h)/(l-h)),u=Math.max(0,Math.min(1,u)),r.g(r.e[n],r.e[n+1],u,s)}return s=r.c(s,r.e[n])}return r.e.length>0?s=r.c(s,r.e[0]):i}return 0==r.e.length?s:s=r.c(s,r.e[0])}h(t){var e,i=this;i.k=t.getInt16(),i.d=t.getInt16(),i.l=t.getBool();var s=t.getInt32();for(i.b=new Array(s),e=0;e<s;++e)i.b[e]=t.getInt32();var r=t.getInt32();for(i.e=new Array(r),e=0;e<r;++e)i.e[e]=i.a(t)}}class fr extends dr{constructor(t){super();this.ba=Be(),this.h(t)}i(){return Be()}g(t,e,i,s){return $e(s,t,e,i)}c(t,e){return ze(t,e),t}a(t){return Ge(Be(),t.getFloat(),t.getFloat(),t.getFloat())}}class gr extends dr{constructor(t){super();this.h(t),this.ba=$s()}i(){return $s()}g(t,e,i,s){return tr(s,t,e,i)}c(t,e){return or(t,e),t}a(t){let e=t.getFloat(),i=t.getFloat(),s=t.getFloat(),r=t.getFloat();const n=hr($s(),-e,-i,-s,r);return lr(n,n),n}}class _r extends dr{constructor(t){super();this.h(t)}a(t){return t.getUint16()}i(){return 0}g(t,e,i,s){return t+(e-t)*i}c(t,e){return e}}class br extends _r{a(t){return t.getFloat()}}class pr extends _r{a(t){return t.getUint8()}}class mr{g(){for(var t=this,e=0;e<t.j.length;++e)t.j[e]=null;return t.e=null,t.j=null,t.b=null,null}d(t,e,i,s){let r=this;i||(i=this.c());let n=s||r.j;if(r.j.length>1&&r.e.length>1){for(var a=-1,o=r.e.length,h=0;h<o-1;++h)if(t>=r.e[h]&&t<=r.e[h+1]){a=h;break}-1==a&&(a=r.e.length-1);var l=r.e[a],u=r.e[a+1],c=0;return l!=u&&(c=(t-l)/(u-l)),r.i(n[a],n[a+1],c,i)}return n.length>0?i=r.a(i,n[0]):e}h(t){var e,i=this,s=t.getInt32();for(i.e=new Array(s),e=0;e<s;++e)i.e[e]=t.getInt16()/32767;var r=t.getInt32();for(i.j=new Array(r),e=0;e<r;++e)i.j[e]=i.f(t)}}class xr extends mr{constructor(t){super();this.ba=Hs(),this.h(t)}c(){return Hs()}i(t,e,i,s){return r=s,a=e,o=i,h=(n=t)[0],l=n[1],r[0]=h+o*(a[0]-h),r[1]=l+o*(a[1]-l),r;var r,n,a,o,h,l}a(t,e){var i,s;return s=e,(i=t)[0]=s[0],i[1]=s[1],t}f(t){return Vs(Hs(),t.getFloat(),t.getFloat())}}class vr extends mr{constructor(t){super();this.h(t)}c(){return Be()}i(t,e,i,s){return $e(s,t,e,i)}a(t,e){return ze(t,e),t}f(t){return Ge(Be(),t.getFloat(),t.getFloat(),t.getFloat())}}class Tr extends mr{constructor(t){super();this.h(t)}c(){return 0}i(t,e,i,s){return t+(e-t)*i}a(t,e){return t}f(t){return t.getUint16()}}class wr{constructor(t,e){this.a(t,e)}a(t,e){var i=t.getInt32();this.d=new Array(i);for(let s=0;s<i;++s)this.d[s]=new e(t)}b(t){return!(!this.d||0==this.d.length)&&(t>=this.d.length&&(t=0),this.d[t].l)}e(t,e,i,s){if(!this.d||0==this.d.length)return i;let r=t.c.e;r>=this.d.length&&(r=0);let n=this.d[r].j(t.c.a,e,i,s);if(t.f>0&&t.f<1){let s=this.d[0].i(),r=t.e.e;r>=this.d.length&&(r=0);let a=this.d[r].j(t.e.a,e,i,s);a||(a=s),s=this.d[0].i(),n=a}return n}c(){if(this.d&&0!=this.d.length){for(var t=0;t<this.d.length;++t)this.d[t].f(),this.d[t]=null;return null}}}function yr(t,e){return Xi(t[4*e+0],t[4*e+1],t[4*e+2],0)}function Er(t,e,i){for(let s=0;s<4;s++)t[4*e+s]=i[s]}const Ar=class{constructor(t,e,i){this.A=t,this.q=i,this.m=null,this.o=null,this.z=null,this.f=ri(),this.y=ri(),this.e=ri();const s=this;s.b=e,s.n=Be(),s.j=ri(),s.u=ri(),s.g=ri(),s.x=Be(),s.r=$s(),s.h=ri(),s.v=!1,s.i=!1,s.d=!1}l(){var t=this;t.n=null,t.j=null,t.x=null,t.r=null,t.h=null}c(){this.v=!0;for(var t=0;t<16;++t)this.j[t]=0}a(t){t?(null==this.m&&(this.m=new cr),this.A.av(t,this.m)):this.m=null;let e=this.A.ai[this.b];for(let i=0;i<e.length;i++)this.A.O[e[i]].a(t)}p(t){t?(null==this.o&&(this.o=new cr),this.A.av(t,this.o)):this.o=null;let e=this.A.ai[this.b];for(let i=0;i<e.length;i++)this.A.O[e[i]].p(t)}t(t){const e=this.q;var i=this;if(i.v)return void i.c();if(null!=this.m&&this.A.q(this.m,t),i.i||i.d)return;if(i.i=!0,!i.A)return;oi(i.j);var s=i.A.m;if(!s)return;let r=this.y;if(oi(r),ui(r,r,this.A.Q.viewMatrix),ui(r,r,this.A.au),ui(i.j,i.j,r),e.e>-1){i.A.O[e.e].t(t);let s=this.e;if(ni(s,i.A.O[e.e].j),ui(s,r,s),1&e.b||2&e.b||4&e.b){if(4&e.b&&2&e.b)Er(s,0,yr(r,0)),Er(s,1,yr(r,1)),Er(s,2,yr(r,2));else if(4&e.b){{let t=yr(r,0),e=$i(t);Qi(t,t,$i(yr(s,0))/e),Er(s,0,t)}{let t=yr(r,1),e=$i(t);Qi(t,t,$i(yr(s,1))/e),Er(s,1,t)}{let t=yr(r,2),e=$i(t);Qi(t,t,$i(yr(s,2))/e),Er(s,2,t)}}else if(2&e.b){{let t=yr(r,0);Qi(t,t,1/$i(yr(s,0))),Qi(t,t,$i(yr(r,0))),Er(s,0,t)}{let t=yr(r,1);Qi(t,t,1/$i(yr(s,1))),Qi(t,t,$i(yr(r,1))),Er(s,1,t)}{let t=yr(r,2);Qi(t,t,1/$i(yr(s,2))),Qi(t,t,$i(yr(r,2))),Er(s,2,t)}}if(1&e.b)Er(s,3,yr(r,3));else{let t=Xi(e.i[0],e.i[1],e.i[2],1),n=Vi();Yi(n,t),n[3]=0;let a=Vi(),o=Vi();ts(a,t,i.A.O[i.q.e].j),ts(a,a,r),ts(o,n,s),Zi(a,a,o),a[3]=1,Er(s,3,a)}}let n=this.f;li(n,r),ui(s,n,s),ui(i.j,i.j,s)}let n=null;if(null!=this.m){let t=this.s(this.m);this.A.af||(this.w=t),this.A.R||(n=this.A.af?this.w:t)}else{let t=this.s(s);this.A.af||(this.w=t),this.A.R||(n=this.A.af?this.w:t)}let a=null;if(null!=this.o){let t=this.s(this.o);this.A.af||(this.k=t),a=this.A.af?this.k:t}let o=null!=n||null!=a,h=ri();o&&(null!=n&&ui(h,h,n),null!=a&&ui(h,h,a)),null!=this.z&&(ci(h,h,this.q.i),ui(h,h,this.z),ci(h,h,We(this.x,this.q.i))),ui(i.j,i.j,h);let l=120&e.b;if(l){let t=ri();ni(t,i.j);let e=i.j,s=Be();pi(s,i.j);let r=Vi();if(16==l){let t=yr(i.j,0);Qi(t,t,1/Oe(t)),Er(i.j,0,t);let s=Xi(e[4],-e[0],0,0);Er(e,1,Ji(s,s)),Qe(r,s,t),r[3]=0,Er(e,2,r)}else if(l>16){if(32==l){let t=yr(e,1);Qi(t,t,1/$i(t)),Er(i.j,1,t);let s=Xi(-e[5],e[1],0,0);Er(e,0,Ji(s,s)),r[3]=0,Er(e,2,r)}else if(64==l){let t=yr(e,2);Ji(t,t),Er(e,2,t);let i=Xi(t[1],-t[0],0,0);Ji(i,i),Er(e,1,i),Qe(r,t,i),r[3]=0,Er(e,0,r)}}else if(8==l){let t=this.A.isMirrored;if(o){let i=yr(h,0);i=Xi(i[1],i[2],-i[0],0),Ji(i,i),Er(e,0,i);let s=yr(h,1);s=Xi(t?-s[1]:s[1],t?-s[2]:s[2],t?s[0]:-s[0],0),Ji(s,s),Er(e,1,s);let r=yr(h,2);r=Xi(r[1],r[2],-r[0],0),Ji(r,r),Er(e,2,r)}else{Er(e,0,Xi(0,0,-1,0)),Er(e,1,Xi(t?-1:1,0,0,0)),Er(e,2,Xi(0,1,0,0))}}let n=Xi(this.q.i[0],this.q.i[1],this.q.i[2],1),a=Xi(this.q.i[0],this.q.i[1],this.q.i[2],0),u=yr(e,0),c=yr(e,1),d=yr(e,2);Qi(u,u,s[0]),Qi(c,c,s[1]),Qi(d,d,s[2]),Er(e,0,u),Er(e,1,c),Er(e,2,d),ts(n,n,t),ts(a,a,e);let f=Vi();Zi(f,n,a),f[3]=1,Er(e,3,f)}li(r,r),ui(i.j,r,i.j),li(i.u,i.j),hi(i.g,i.u),Je(i.n,i.q.i,i.j)}s(t){const e=this.q;var i=e.a.b(t.c.e),s=e.h.b(t.c.e),r=e.g.b(t.c.e);if(!!(640&e.b)){let y=ri();return oi(y),ci(y,y,this.q.i),i&&(this.x=e.a.e(t,this.A.g),ci(y,y,this.x)),s&&(this.r=e.h.e(t,this.A.g,$s()),n=this.h,a=this.r,o=a[0],h=a[1],l=a[2],u=a[3],g=o*(c=o+o),_=h*c,b=h*(d=h+h),p=l*c,m=l*d,x=l*(f=l+l),v=u*c,T=u*d,w=u*f,n[0]=1-b-x,n[1]=_+w,n[2]=p-T,n[3]=0,n[4]=_-w,n[5]=1-g-x,n[6]=m+v,n[7]=0,n[8]=p+T,n[9]=m-v,n[10]=1-g-b,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,ui(y,y,this.h)),r&&(this.x=e.g.e(t,this.A.g),di(y,y,this.x)),ci(y,y,We(this.x,this.q.i)),y}var n,a,o,h,l,u,c,d,f,g,_,b,p,m,x,v,T,w;return null}};const Cr=class{constructor(t){this.f=t,this.e=267320826^t;let e=new ArrayBuffer(4);this.c=new DataView(e)}d(){let t=this.e;return t^=t<<13,t^=t>>17,t^=t<<5,this.e=t,t}a(){let t,e=this.d();return this.c.setInt32(0,1065353216|8388607&e),t=2147483648&e?2-this.c.getFloat32(0):this.c.getFloat32(0)-2,t}b(){let t=this.d();return this.c.setInt32(0,1065353216|8388607&t),this.c.getFloat32(0)-1}};const Mr=class{constructor(){this.i=0,this.h=0,this.e=0,this.a=0,this.d=Be(),this.f=0,this.j=0,this.b=0,this.g=0,this.c=0}};const Sr=class{constructor(t,e){this.g=t,this.j=e,this.c=new Mr}e(){return this.c.a+this.g.a()*this.j.L}d(){return this.c.a+this.j.L}b(){return this.c.e+this.j.o}k(t){return this.c.e+30518509e-12*t*this.j.o}a(){let t=this.c.i;return t*=1+this.c.h*this.g.a(),t}f(){return this.c}i(t){ze(t,this.c.d)}};const Fr=class extends Sr{h(t,e){let i,s=e*this.g.b(),r=this.g.a();i=r<1?r>-1?Math.trunc(32767*r+.5):-32767:32767,t.b=i;let n=this.k(i);n<.001&&(n=.001),t.d=function(t,e){let i=Math.abs(t),s=Math.abs(e);return Number((i-Math.floor(i/s)*s).toPrecision(8))*Math.sign(t)}(s,n),t.f=65535&this.g.d(),Ge(t.g,this.g.a()*this.c.j*.5,this.g.a()*this.c.b*.5,0);let a=this.a(),o=this.c.f;if(o<.001){let e=this.c.g*this.g.a(),i=this.c.c*this.g.a(),s=Math.sin(e),r=Math.sin(i),n=Math.cos(e),o=Math.cos(i);Ge(t.e,o*s*a,r*s*a,n*a)}else{let e=Be();ze(e,t.g),e[2]=e[2]-o,Oe(e)>1e-4&&(Ke(e,e),Ve(t.e,e,a))}}};const kr=class extends Sr{constructor(t,e,i){super(t,e),this.ba=i}h(t,e){let i,s=e*this.g.b(),r=this.g.a();i=r<1?r>-1?Math.trunc(32767*r+.5):-32767:32767,t.b=i;let n=this.k(i);n<.001&&(n=.001),t.d=function(t,e){let i=Math.abs(t),s=Math.abs(e);return Number((i-Math.floor(i/s)*s).toPrecision(8))*Math.sign(t)}(s,n),t.f=65535&this.g.d();let a=this.c.b-this.c.j,o=this.c.j+a*this.g.b(),h=this.c.g*this.g.a(),l=this.c.c*this.g.a(),u=Math.cos(h),c=Pe(u*Math.cos(l),u*Math.sin(l),Math.sin(h));Ve(t.g,c,o);let d=this.a(),f=this.c.f,g=Pe(.5,.5,.5);0==f?this.ba?Ge(g,0,0,1):Ge(g,u*Math.cos(l),u*Math.sin(l),Math.sin(h)):(Ge(g,0,0,f),Ne(g,t.g,g),Oe(g)>1e-4&&Ke(g,g)),Ve(t.e,g,d)}};const Ir=class{constructor(){this.g=Be(),this.d=0,this.e=Be(),this.b=0,this.f=2147483647*Math.random()|0,this.c=[Hs(),Hs()],this.a=[Hs(),Hs()]}};const Dr=class{constructor(t,e,i,s,r,n){this.c=t,this.e=e,this.a=i,this.d=s,this.b=r,this.f=n}};const Ur=class{constructor(t,e,i){this.b=t,this.a=e,this.c=i}};let Rr=new Array(128);for(let t=0;t<128;t++)Rr[t]=Math.random();const Br=ai(0,1,0,0,-1,0,0,0,0,0,1,0,0,0,0,1),Or=1e3;class Pr{}class zr{constructor(){this.c=Be(),this.a=0,this.b={a:Hs(),e:Be(),c:0,d:0,f:1,b:0}}}function Gr(t){return Xi((t>>16&255)/255,(t>>8&255)/255,(255&t)/255,(t>>24&255)/255)}const Lr=[0,0,1,2,3,4];const Nr=class{constructor(t,e){this.Q=t,this.z=e,this.O=null,this.F=0,this.aj=!0,this.u=null,this.k=(new Date).getTime(),this.s=e,this.ak=ri(),this.w=ri(),this.K=ri(),this.Y=ri(),this.f=Vi(),this.p=Ks(),this.M=Be(),this.av=1,this.t=Be(),this.W=0,this.R=Be(),this.X=Be(),this.aa=[],this.ac=Be(),this.C=0,this.ah=0,this.m=0,this.L=0,this.P=Be(),this.J=Be(),this.V=0,this.af=0,this.ap=0,this.n=0,this.x=0,this.j=0,this.r=0,this.G=[],this.c=[];for(let t=0;t<Or;t++)this.c.push(4*t+0),this.c.push(4*t+1),this.c.push(4*t+2),this.c.push(4*t+3),this.c.push(4*t+2),this.c.push(4*t+1);switch(this.ab=new Cr(2147483647*Math.random()|0),this.s.E){case 1:this.au=new Fr(this.ab,e);break;case 2:this.au=new kr(this.ab,e,!!(256&this.s.c));break;default:this.au=null,WH.debug("Found unimplemented generator ",this.s.E)}const i=this.s.j-this.s.l;0!=i?(this.ah=(this.s.S-this.s.Z)/i,this.m=this.s.Z-this.s.l*this.ah):(this.ah=0,this.m=0);let s=this.s.h;s<=0&&(s=1);let r=this.s.g;r<=0&&(r=1),this.af=s*r-1,this.ap=0;let n=s,a=-1;do{++a,n>>=1}while(n);if(this.n=a,this.x=s-1,this.ap=0,(32768&this.s.c)>0){let t=(this.af+1)*this.ab.d();this.ap=t/4294967296|0}this.j=1/s,this.r=1/r;let o=!1;(269484032&this.s.c)>0?(o=!!(1&this.s.c>>28),this.C=o?2:3):this.C=0;let h=!1,l=!1;(268435456&this.s.c)>0?l=(1073741824&this.s.c)>0:1048576&this.s.c||(h=!(1&this.s.c)),2==this.C||4==this.C&&o?this.o=l?3:2:3==this.C?this.o=5:this.o=h?1:0,this.B=e.f>1,this.am=this.Q.ax.d(224e3),this.ar=this.Q.ax.n(8e3),this.v=this.Q.ax.c(this.am,this.ar)}h(){var t=this;t.s.u=null,t.s.C=null,t.s.d=null,t.s.x=t.s.x.c(),t.s.z=t.s.z.c(),t.s.J=t.s.J.c(),t.s.q=t.s.q.c(),t.s.H=t.s.H.c(),t.s.i=t.s.i.c(),t.s.aa=t.s.aa.c(),t.s.B=t.s.B.c(),t.s.R=t.s.R.c(),t.s.a=t.s.a.c(),t.s.P=t.s.P.c(),t.s.s=t.s.s.g(),t.s.N=t.s.N.g(),t.s.A=t.s.A.g(),t.s.F=t.s.F.g(),t.s.r=t.s.r.g(),t.aa=null}g(t){const e=this.z;e.V>=11&&e.V<=13&&t&&(this.l=[Vi(),Vi(),Vi()],Yi(this.l[0],Gr(t.Start[e.V-11])),Yi(this.l[1],Gr(t.Mid[e.V-11])),Yi(this.l[2],Gr(t.End[e.V-11])))}as(t){this.O=t}E(){if(this.u)return;this.Q.Q.context;if(!this.U)if(this.U=[null,null,null],268435456&this.s.c)for(let t=0;t<this.s.b.length;t++){const e=this.s.b[t];e>-1&&e<this.Q.T.length&&(this.U[t]=this.Q.T[e])}else this.s.t>-1&&this.s.t<this.Q.T.length&&(this.U[0]=this.Q.T[this.s.t]);let t=!0;for(let e of this.U)t=t&&(!e||e.e&&e.e.h);if(!t)return;const e=this.Q.ax;let i=this.s.f;4==i&&(i=3);let s={};s.uViewMatrix=this.Q.Q.viewMatrix,s.uProjMatrix=this.Q.Q.projMatrix,s.uBlendMode=this.s.f,s.uPixelShader=Lr[this.o],s.colorMult=this.O?this.O.d:1,s.alphaMult=this.O?this.O.c:1;let r=[this.U[0]&&this.U[0].e&&this.U[0].e.h,this.U[1]&&this.U[1].e&&this.U[1].e.h,this.U[2]&&this.U[2].e&&this.U[2].e.h];s.uTexture=this.U[0].e.l,s.uTexture2=r[1]?this.U[1].e.l:null,s.uTexture3=r[2]?this.U[2].e.l:null,s.uHasTexture=r[0]?1:0,s.uHasTexture2=r[1]?1:0,s.uHasTexture3=r[2]?1:0;let n=-1;1==i?n=.501960814:i>1&&(n=1/255),s.uAlphaTreshold=n;const a=e.m(this.Q.U,new Dr(!1,!this.Q.l,i,!0,!1,15),new Di(this.U.map(t=>t&&t.e),s));this.u=e.b(new Ur(this.v,0,0),a,0,this.s.Q)}D(t,e){if(!this.au)return;let i=ri(),s=this.au.f(),r=!0;this.s.P.b(t.c.e)&&(r=this.s.P.e(t,this.Q.g)>0),this.ae=r;const n=Pe(0,0,0);r&&(s.i=this.s.x.e(t,this.Q.g,0),s.h=this.s.z.e(t,this.Q.g,0),s.g=this.s.J.e(t,this.Q.g,0),s.c=this.s.q.e(t,this.Q.g,0),this.s.H.e(t,this.Q.g,n,s.d),s.e=this.s.i.e(t,this.Q.g,0),s.a=this.s.aa.e(t,this.Q.g,0),s.b=this.s.R.e(t,this.Q.g,0),s.j=this.s.B.e(t,this.Q.g,0),this.O?s.f=this.O.b:s.f=this.s.a.e(t,this.Q.g,0)),ui(i,i,this.Q.au),ui(i,i,this.Q.O[this.s.K].j);let a=ri();var o,h;o=a,h=Pe(this.s.u[0],this.s.u[1],this.s.u[2]),o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=h[0],o[13]=h[1],o[14]=h[2],o[15]=1,ui(i,i,a),ui(i,i,Br);let l=ri(),u=Be();li(l,this.Q.Q.viewMatrix),bi(u,l),this.at(e,i,u,null,this.Q.Q.viewMatrix),this.y(this.Q.Q.viewMatrix),this.am.d(new Float32Array(this.G)),this.ar.d(new Uint16Array(this.c)),this.u&&(this.u.h=6*this.F|0,this.u.f=0)}Z(t){if(this.aa.length<=0)return;if(this.u||this.E(),!this.u)return;if(!t&&this.u.b.a()>vs.GxBlend_AlphaKey)return;this.Q.ax.g().d(this.u)}al(t,e){if(!(16&this.s.c))for(let i=0;i<this.aa.length;i++){const s=this.aa[i];Je(s.g,s.g,t),ti(s.e,s.e,e)}}at(t,e,i,s,r){if(null==this.au)return;if(this.Q.af)return;bi(this.t,this.ak);let n=Vi();bi(n,e),n[3]=1,ts(n,n,r),this.W=n[2];let a=Be();if(bi(a,r),this.d(e,a,s),t>0){let e=Be();if(bi(e,this.ak),16384&this.s.c){Ne(this.X,e,this.t);let i=this.ah*(Oe(this.X)/t)+this.m;i>=0&&(i=Math.min(i,1)),Ve(this.R,this.X,i)}if(64&this.s.c){this.L+=t;let i=.03;if(this.L>i)if(this.L=0,0==this.aa.length){let t=i/this.L,s=Be();Ne(s,e,this.t);let r=t*this.s.v;je(this.P,s,Pe(r,r,r))}else Ge(this.P,0,0,0)}this.H(t)}}d(t,e,i){if(ze(this.J,e),null==i||16&this.s.c)ni(this.ak,t);else{let e=ri();li(e,i),ui(this.ak,e,t)}let s=Be();pi(s,t),this.av=s[0]}H(t){if((t=Math.max(t,0))<.1)ze(this.R,this.X);else{let e=Math.floor(t/.1);t=-.1*e+t;let i=Math.min(Math.floor(this.au.f().e/.1),e),s=i+1,r=1;r=s<0?(1&s|s>>1)+(1&s|s>>1):s,Ve(this.R,this.X,1/r);for(let t=0;t<i;t++)this.q(.1)}this.q(t)}q(t){let e=new Pr;if(t<0)return;this.s.c,this.e(e,t),this.aq(t);let i=0;for(;i<this.aa.length;){let s=this.aa[i];s.d=s.d+t,s.d>Math.max(this.au.k(s.f),.001)?(this.i(i),i--):this.ao(s,t,e)||(this.i(i),i--),i++}}e(t,e){t.d=Be(),t.b=Be(),t.a=Be(),t.c=0;let i=Pe(e,e,e),s=e*e*.5,r=Pe(s,s,s);je(t.d,this.s.w,i);let n=Be();this.au.i(n),je(t.b,n,i),je(t.a,n,r),t.c=this.s.T*e}aq(t){if(!this.ae)return;if(!this.aj)return;let e=this.au.e();for(this.V=this.V+t*e;this.V>1;)this.ad(t),this.V-=1}ad(t){let e=this.an();if(this.au.h(e,t),!(16&this.s.c)){let t=Xi(e.g[0],e.g[1],e.g[2],1),i=Xi(e.e[0],e.e[1],e.e[2],0);ts(t,t,this.ak),ts(i,i,this.ak),ze(e.g,t),ze(e.e,i),8192&this.s.c&&(e.g[2]=0)}if(64&this.s.c){let t=1+this.au.f().h*this.ab.a(),i=Be();Ve(i,this.P,t),Le(e.e,e.e,i)}if(this.C>=2)for(let t=0;t<2;t++){e.c[t][0]=this.ab.b(),e.c[t][1]=this.ab.b();let i=Hs();Ws(i,this.s.W[t],this.ab.a()),Xs(e.a[t],i,this.s.U[t])}}an(){let t=new Ir;return this.aa.push(t),t}i(t){this.aa.splice(t,1)}ao(t,e,i){if(this.C>=2)for(let i=0;i<2;i++){let s=t.c[i][0]+e*t.a[i][0];t.c[i][0]=s-Math.floor(s),s=t.c[i][1]+e*t.a[i][1],t.c[i][1]=s-Math.floor(s)}Le(t.e,t.e,i.d),16384&this.s.c&&2*e<t.d&&Le(t.g,t.g,this.R);let s=Pe(e,e,e),r=Be();if(je(r,t.e,s),Le(t.e,t.e,i.b),Ve(t.e,t.e,1-i.c),Le(t.g,t.g,r),Le(t.g,t.g,i.a),2==this.s.E&&128&this.s.c){let e=Be();if(ze(e,t.g),16&this.s.c){if(Ze(e,r)>0)return!1}else{let i=Be();if(bi(i,this.ak),Ne(e,t.g,i),Ze(e,r)>0)return!1}}return!0}y(t){if(this.G.length=0,0==this.aa.length&&null!=this.au)return;li(this.K,t),Zs(Ks(),t),this.ag(null,t);let e=0;for(let t=0;t<this.aa.length;t++){let i=this.aa[t],s=new zr;if(this.S(i,s)&&(131072&this.s.c&&(this.ai(i,s),e++),262144&this.s.c&&(this.b(i,s),e++)),e>=Or)break}this.F=e}ag(t,e){var i,s,r;16&this.s.c?ui(this.Y,e,this.ak):null!=t?ui(this.Y,e,t):ni(this.Y,e),bi(this.f,e),4096&this.s.c&&(Zs(this.p,this.Y),16&this.s.c&&Math.abs(this.av)>0&&(i=this.p,s=this.p,r=1/this.av,i[0]=s[0]*r,i[1]=s[1]*r,i[2]=s[2]*r,i[3]=s[3]*r,i[4]=s[4]*r,i[5]=s[5]*r,i[6]=s[6]*r,i[7]=s[7]*r,i[8]=s[8]*r),Ge(this.M,this.p[6],this.p[7],this.p[8]),Ye(this.M)<=2.3841858e-7?Ge(this.M,0,0,1):Ke(this.M,this.M))}A(t){let e=0,i=0;if(0!=this.s.D||0!=this.s.Y){let s=new Cr(t.f);e=0==this.s.y?this.s.D:this.s.D+s.a()*this.s.y,i=0==this.s.Y?this.s.G:this.s.G+s.a()*this.s.Y}else e=this.s.D,i=this.s.G;return{deltaSpin:i,baseSpin:e}}S(t,e){let i=this.s.p,s=this.s.M,r=s[0],n=s[1]-r,a=0,o=t.f,h=t.d;if((i<1||0!=n)&&(a=127&h*this.s.X+o),i<Rr[a])return 0;this.T(t,e,o);let l=n*Rr[a]+r;Ws(e.b.a,e.b.a,l),32&this.s.c&&Ws(e.b.a,e.b.a,this.av);let u=Xi(t.g[0],t.g[1],t.g[2],1);return ts(u,u,this.Y),ze(e.c,u),e.a=1,1}T(t,e,i){let s=t.d/this.au.b(),r=new Cr(i);Math.min(s,1)<=0?s=0:s>=1&&(s=1);let n=Pe(255,255,255),a=qs(1,1),o=1,h=e.b;this.s.s.d(s,n,h.e,this.l),this.l||Ve(h.e,h.e,1/255),this.s.A.d(s,a,h.a),h.f=this.s.N.d(s,32767)/32767,this.O?h.b=this.O.a.d(s,0)/32767:h.b=0;let l=0;this.s.F.e.length>0?(o=0,h.c=this.s.F.d(s,o),h.c=this.af&h.c+this.ap):65536&this.s.c?(l=(this.af+1)*r.d(),h.c=l/4294967296|0):h.c=0,o=0,h.d=this.s.r.d(s,o),h.d=h.d+this.ap&this.af;let u=1;524288&this.s.c?(u=Math.max(1+r.a()*this.s.e[1],99999997e-12),h.a[0]=Math.max(1+r.a()*this.s.e[0],99999997e-12)*h.a[0]):(u=Math.max(1+r.a()*this.s.e[0],99999997e-12),h.a[0]=u*h.a[0]),h.a[1]=u*h.a[1]}ai(t,e){let i=qs((e.b.c&this.x)*this.j,(e.b.c>>this.n)*this.r),s=0,r=0,n=this.A(t);s=n.baseSpin,r=n.deltaSpin;let a=0,o=Pe(0,0,0),h=Pe(0,0,0),l=!1,u=!1;if(4&this.s.c&&Ye(t.e)>2.3841858e-7)if(a=1,4096&this.s.c)l=!0;else{let i=Xi(-t.e[0],-t.e[1],-t.e[2],0);ts(i,i,this.Y);let s=Be();ze(s,i);let r=0,n=Ye(s);r=n<=2.3841858e-7?0:1/Math.sqrt(n);let a=Be();ze(a,s),Ve(a,a,r),ze(o,a),Ve(o,o,e.b.a[0]),h=Pe(a[1],-a[0],0),Ve(h,h,e.b.a[1]),u=!0,l=!1}if((4096&this.s.c||l)&&!u){let i=Ks();c=i,d=this.p,c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8];let n=e.b.a[0];if(a){let s=0,r=Pe(-t.e[0],-t.e[1],-t.e[2]),a=Ye(r);s=a<=2.3841858e-7?0:1/Math.sqrt(a),Qs(i,this.p,function(t,e,i,s,r,n,a,o,h){var l=new Re(9);return l[0]=t,l[1]=e,l[2]=i,l[3]=s,l[4]=r,l[5]=n,l[6]=a,l[7]=o,l[8]=h,l}(r[0]*s,r[1]*s,0,-r[1]*s,r[0]*s,0,0,0,1)),s>2.3841858e-7&&(n=e.b.a[0]*(1/Math.sqrt(Ye(t.e))/s))}if(this.C,Ge(o,i[0],i[1],i[2]),Ve(o,o,n),Ge(h,i[3],i[4],i[5]),Ve(h,h,e.b.a[1]),r=h[0],u=!0,0!=this.s.G||0!=this.s.Y){let e=s+r*t.d;512&this.s.c&&1&t.f&&(e=-e);let i=Be();ze(i,this.M),this.C;let n=Ks(),a=$s();Js(a,i,e),function(t,e){var i=e[0],s=e[1],r=e[2],n=e[3],a=i+i,o=s+s,h=r+r,l=i*a,u=s*a,c=s*o,d=r*a,f=r*o,g=r*h,_=n*a,b=n*o,p=n*h;t[0]=1-c-g,t[3]=u-p,t[6]=d+b,t[1]=u+p,t[4]=1-l-g,t[7]=f-_,t[2]=d-b,t[5]=f+_,t[8]=1-l-c}(n,a),ti(o,o,n),Ge(h,r,h[1],h[2]),ti(h,h,n)}}var c,d;if(!u)if(0!=this.s.G||0!=this.s.Y){let i=s+r*t.d;512&this.s.c&&1&t.f&&(i=-i);let n=Math.cos(i),a=Math.sin(i);Ge(o,n,a,0),Ve(o,o,e.b.a[0]),Ge(h,-a,n,0),Ve(h,h,e.b.a[1]),134217728&this.s.c&&Le(e.c,e.c,Pe(h[0],h[1],0))}else Ge(o,e.b.a[0],0,0),Ge(h,0,e.b.a[1],0);return this.I(o,h,e.c,e.b.e,e.b.f,e.b.b,i[0],i[1],t.c),0}b(t,e){let i=qs((e.b.d&this.x)*this.j,(e.b.d>>this.n)*this.r),s=Pe(0,0,0),r=Pe(0,0,0),n=this.s.I;1024&this.s.c&&(n=Math.min(t.d,n));let a=Vi();Ve(a,t.e,-1),a[3]=0,ts(a,a,this.Y),Ve(a,a,n);let o=Pe(a[0],a[1],0);if(Ze(o,o)>1e-4){let t=1/Oe(o);Ws(e.b.a,e.b.a,t),Ys(o,o,e.b.a),r=Pe(-o[1],o[0],0),Ve(s,a,.5),Le(e.c,e.c,s)}else s=Pe(.05*e.b.a[0],0,0),r=Pe(0,.05*e.b.a[1],0);return this.I(s,r,e.c,e.b.e,e.b.f,e.b.b,i[0],i[1],t.c),1}I(t,e,i,s,r,n,a,o,h){const l=[-1,-1,1,1],u=[1,-1,1,-1],c=[0,0,1,1],d=[0,1,0,1];let f=Be(),g=Hs(),_=Hs(),b=Hs();for(let p=0;p<4;p++)Ge(f,0,0,0),Xe(f,f,t,l[p]),Xe(f,f,e,u[p]),Le(f,f,i),Vs(g,c[p]*this.j+a,d[p]*this.r+o),Vs(_,c[p]*this.s.O[0]+h[0][0],d[p]*this.s.O[0]+h[0][1]),Vs(b,c[p]*this.s.O[1]+h[1][0],d[p]*this.s.O[1]+h[1][1]),this.G.push(f[0]),this.G.push(f[1]),this.G.push(f[2]),this.G.push(s[0]),this.G.push(s[1]),this.G.push(s[2]),this.G.push(r),this.G.push(g[0]),this.G.push(g[1]),this.G.push(_[0]),this.G.push(_[1]),this.G.push(b[0]),this.G.push(b[1]),this.G.push(n)}};class jr{constructor(){this.b=Be(),this.c=Vi(),this.a=Hs()}}class Hr{}const qr=[0,1,2,10,3,4,5,13];function Vr(t,e){return Pe(t[4*e+0],t[4*e+1],t[4*e+2])}const Xr=class{constructor(t,e){this.C=t,this.B=e,this.ac=Be(),this.g=Be(),this.w=new Hr,this.au=Be(),this.T=Be(),this.W=Be(),this.b=Be(),this.s=Be(),this.f=Be(),this.q=Be(),this.O=Be(),this.U=Be(),this.am=Be(),this.G=Be(),this.x=Be(),this.v=Be(),this.ae=t.Q.context,this.ad=new Array(e.j.length),this.V=new Array(e.j.length);for(let i=0;i<e.j.length;i++)this.V[i]=t.k.u[e.j[i]];let i=Xi(255,255,255,255),s=new Hr;s.b=0,s.c=0,s.a=1,s.d=1,this.i(e.o,e.f,i,s,e.m,e.b),this.N(e.l),this.d(!1)}d(t){this.u=t,this.u||(this.a=!1)}N(t){this.y=t}z(){return this.K==this.X}L(t){this.as=t}n(t){this.e=t}H(t){this.ah[3]=Math.max(t,0)}at(){let t=Be();ii(t,this.ac,this.v);let e=Ye(t);Ve(t,this.au,this.as),Ne(this.q,this.ac,t),Ve(t,this.T,this.as),Ne(this.O,this.v,t),Ve(t,this.au,this.e),Le(this.U,this.ac,t),Ve(t,this.T,this.e),Le(this.am,this.v,t),Ve(this.s,this.W,e),Ve(this.f,this.b,e)}aq(t,e,i){let s;if(this.p&&this.u){s=t;let i=Be();bi(i,s),Le(i,i,e),ze(this.g,e),this.a?(ze(this.ac,this.v),ze(this.W,this.b),ze(this.au,this.T)):(ze(this.ac,i),this.W=Vr(s,2),this.au=Vr(s,1),this.ai=0,this.a=!0),this.v=i,this.b=Vr(s,2),this.T=Vr(s,1)}}aa(t){var e=Ks();Zs(e,t),this.W=ti(this.W,this.W,e),this.au=ti(this.au,this.au,e),this.b=ti(this.b,this.b,e),this.T=ti(this.T,this.T,e),this.ac=Je(this.ac,this.ac,t),this.v=Je(this.v,this.v,t);for(var i=0;i<this.M.length;i++)Je(this.M[i].b,this.M[i].b,t)}aj(t,e,i){this.ah[2]=i,this.ah[1]=e,this.ah[0]=t}ao(t){if(this.ak!=t){this.ak=t;let e=t%this.I,i=e;2147483648&e&&(i=(1&e|e>>1)+(1&e|e>>1));let s=i*this.t+this.av.c;this.w.c=s;let r=t/this.I,n=r;2147483648&r&&(r=1&r|r>>1,n=r+r,s=this.w.c);let a=n*this.ap+this.av.b;this.w.b=a,this.w.d=s+this.t,this.w.a=a+this.ap}}F(t,e,i){let s,r=this.M[2*this.X],n=this.M[2*this.X+1],a=Be();Ve(a,this.f,1-e),Ne(a,this.O,a),Ve(r.b,a,e),Ve(a,this.s,e),Le(a,this.q,a),Ve(a,a,1-e),Le(r.b,r.b,a),Ve(a,this.f,1-e),Ne(a,this.am,a),Ve(n.b,a,e),Ve(a,this.s,e),Le(a,this.U,a),Ve(a,a,1-e),Le(n.b,n.b,a),this.k[this.X]=t,s=i,this.X=this.X+s,this.X>=this.k.length&&(this.X-=this.k.length)}Y(t,e){if(this.C.af)return;let i=Be(),s=1;i=this.B.q.e(t,this.C.g,i),s=this.B.n.e(t,this.C.g),this.aj(i[0],i[1],i[2]),this.H(s/32767);let r=this.B.i.e(t,this.C.g);this.n(r);let n=this.B.g.e(t,this.C.g);this.L(n);let a=this.B.c.e(t,this.C.g);this.ao(a);let o=this.B.k.e(t,this.C.g,1);this.d(0!=o);let h=ri();xi(h,this.C.au,this.C.O[this.B.r].j),ci(h,h,this.B.e);let l=Be();this.aq(h,l,null),this.A(e,!1)}A(t,e){let i,s,r,n,a,o,h,l,u,c,d,f,g,_,b,p,m,x,v,T,w,y,E,A,C,M,S,F,k,I,D,U,R,B,O,P,z,G,L,N,j,H,q,V,X,Y,W,K;for(this.D||this.ar>0&&(t=1/this.ar+99999997e-12),t>=0?this.j<=t&&(t=this.j):t=0,x=this.K;x!=this.X&&!(t+this.k[x]<=this.j);x=this.K)this.K=this.an(this.K,1);if(!e&&this.p&&this.u&&this.a){D=t*this.ar+this.ai,K=this.ah,this.at();let e=!1;if(B=0,D<1?e=!0:(W=this.ai,R=1/(D-W),m=Math.floor(D-1),B=Math.ceil(Math.max(m,0))),-1==B||e);else for(U=1,x=1;I=this.X,G=this.M.length,this.M[2*I].c=K,v=2*this.X+1,L=this.M.length,this.M[v].c=K,this.F((x-W)*R*-t,(x-W)*R,1),-1!=--B;x=U)U+=1,W=this.ai;T=Math.floor(D),this.ai=D-T,this.F(0,1,0),k=this.X,N=this.M.length,w=this.M[2*k],y=this.w.c,w.a[1]=this.w.b,w.a[0]=y,E=2*this.X+1,j=this.M.length,A=this.M[E],C=this.w.c,A.a[1]=this.w.a,A.a[0]=C,F=this.X,H=this.M.length,this.M[2*F].c=K,M=2*this.X+1,q=this.M.length,this.M[M].c=K}this.G[2]=34028235e31,this.G[1]=34028235e31,this.G[0]=34028235e31,this.x[2]=-34028235e31,this.x[1]=-34028235e31,this.x[0]=-34028235e31,O=this.K;for(let e=this.K;e!=this.X;O=e)p=2*e,Y=this.M.length,S=O,z=this.M[2*e],i=p+1,s=this.M[2*e+1],r=(this.y+this.y)*this.k[S]*t+t*this.y*t,z.b[2]=z.b[2]+r,s.b[2]=r+s.b[2],n=z.b[0],a=this.G[0],a>z.b[0]&&(a=z.b[0],this.G[0]=n,n=z.b[0]),o=z.b[1],h=this.G[1],h>o&&(h=z.b[1],this.G[1]=o,o=z.b[1]),l=z.b[2],u=this.G[2],u>l&&(u=z.b[2],this.G[2]=l,l=z.b[2]),n>this.x[0]&&(this.x[0]=n),o>this.x[1]&&(this.x[1]=o),l>this.x[2]&&(this.x[2]=l),c=s.b[0],a>s.b[0]&&(this.G[0]=c,c=s.b[0]),d=s.b[1],h>d&&(this.G[1]=d,d=s.b[1]),f=s.b[2],u>f&&(this.G[2]=f,f=s.b[2]),c>this.x[0]&&(this.x[0]=c),d>this.x[1]&&(this.x[1]=d),f>this.x[2]&&(this.x[2]=f),V=this.k.length,this.k[S]=t+this.k[S],g=this.t,X=this.k.length,_=g*this.k[S]*this.l+this.w.c,z.a[1]=this.w.b,z.a[0]=_,s.a[1]=this.w.a,s.a[0]=_,b=this.k.length,P=O+1,e=P-b,b>P&&(e=P);this.D=!0}an(t,e){let i=e+t;t=i;let s=this.k.length;return i>=s&&(t=i-s),t}i(t,e,i,s,r,n){let a,o,h,l,u,c,d,f;d=Math.ceil(t),f=Math.max(.25,e),a=Math.ceil(f*d),o=Math.ceil(Math.max(a+1+1,0)),this.k=new Array(o),this.K=0,this.X=0,this.ai=0,this.a=!1,this.M=new Array(2*o);for(let t=0;t<this.M.length;t++){this.M[t]=new jr;let e=this.M[t];e.b[0]=0,e.b[1]=0,e.b[2]=0,e.c=Xi(0,0,0,0),e.a[0]=0,e.a[1]=0}this.Q=new Array(4*o);for(let t=0;t<this.Q.length;t++)this.Q[t]=t%(2*o);this.l=1/f,h=n,2147483648&n&&(h=(1&n|n>>1)+(1&n|n>>1)),this.t=(s.d-s.c)/h,l=r,2147483648&r&&(l=(1&r|r>>1)+(1&r|r>>1)),this.ap=(s.a-s.b)/l,this.R=1/this.t,this.o=1/this.ap,this.ar=d,this.j=f,Qi(i,i,1/255),this.ah=i,this.av=s,this.al=r,this.I=n,this.ak=0,u=0*this.t+this.av.c,this.w.c=u,c=0*this.ap+this.av.b,this.w.b=c,this.w.d=u+this.t,this.w.a=c+this.ap,this.e=10,this.as=10,this.y=0,this.p=!0,this.u=!0,this.P=!0,this.ag=this.C.ax.a(0),this.af=this.C.ax.n(0),this.S=this.C.ax.k(this.ag,this.af)}r(){let t=new Array(this.M.length);for(let e=0,i=0;e<this.M.length;++e)t[i++]=this.M[e].b[0],t[i++]=this.M[e].b[1],t[i++]=this.M[e].b[2],t[i++]=this.M[e].c[0],t[i++]=this.M[e].c[1],t[i++]=this.M[e].c[2],t[i++]=this.M[e].c[3],t[i++]=this.M[e].a[0],t[i++]=this.M[e].a[1];this.z()||(this.ag.d(new Float32Array(t)),this.af.d(new Uint16Array(this.Q)))}E(t){const e=this.C.ax;var i=this.B.d[t];if(i<=-1||i>this.C.T.length)return null;let s=this.C.T[i];if(!s.e||!s.e.h)return null;let r=t;r>=this.B.j.length&&(r=0);let n=this.C.k.u[this.B.j[r]],a=Object.assign({},this.C.aN);const o=e.i(this.C.U,new Dr(!1,!this.C.l,qr[n.a],!0,!1,15),new Ui([s.e],a));return e.f(new Ur(this.S,0,0),o,0,0)}h(t){if(this.z())return;const e=this.C.ax.g();for(let i=0;i<this.B.d.length;i++){if(this.ad[i]||(this.ad[i]=this.E(i)),!this.ad[i])continue;if(!t&&this.ad[i].b.a()>vs.GxBlend_AlphaKey)continue;let s=this.X>this.K?2*(this.X-this.K)+2:2*(this.k.length+this.X-this.K)+2;this.ad[i].h=s,this.ad[i].f=2*this.K*2,e.d(this.ad[i])}}};const Yr=class{constructor(t){var e=this;e.a=Pe(t.getFloat(),t.getFloat(),t.getFloat()),e.d=Xi(t.getFloat(),t.getFloat(),t.getFloat(),0),e.h=t.getFloat(),e.f=t.getFloat(),e.i=t.getFloat(),e.e=t.getFloat(),e.g=[t.getUint8(),t.getUint8(),t.getUint8(),t.getUint8()],e.b=[t.getUint8(),t.getUint8(),t.getUint8(),t.getUint8()]}c(){var t=this;t.a=null,t.d=null,t.g=null,t.b=null}};const Wr=class{constructor(t){var e=this;e.d=t.getUint16(),e.b=t.getUint16(),e.e=t.getUint16(),e.i=t.getUint16(),e.a=t.getUint16()+65536*e.b,e.k=t.getUint16(),e.c=t.getUint16(),e.j=Pe(t.getFloat(),t.getFloat(),t.getFloat()),e.h=Pe(t.getFloat(),t.getFloat(),t.getFloat()),e.g=t.getFloat()}f(){this.j=null,this.h=null}};const Kr=class{constructor(t){this.b=t.getUint16(),this.a=t.getUint16()}static c(t){const e=t.s.k,i=t.i;e.u&&i.i<e.u.length?t.x=e.u[i.i]:t.x={b:0,a:0},t.m=!!(1&t.x.b),t.h=!(4&t.x.b),t.j=!!(16&t.x.b)}};const Zr=class{constructor(t){this.c=new wr(t,fr),this.a=new wr(t,gr),this.d=new wr(t,fr)}b(){var t=this;t.c&&(t.c.c(),t.c=null),t.a&&(t.a.c(),t.a=null),t.d&&(t.d.c(),t.d=null)}};const Qr=class{constructor(t){var e=this;e.e=t.getInt32(),e.d=t.getInt32(),e.a=Pe(t.getFloat(),t.getFloat(),t.getFloat()),e.b=-1}c(){this.a=null}};const $r=class{constructor(t){this.d=new wr(t,fr),this.g=new wr(t,_r)}e(){var t=this;t.d&&t.d.c(),t.g&&t.g.c()}a(t){return!!this.d&&this.d.b(t)}f(t){return!!this.g&&this.g.b(t)}c(t){return this.a(t)||this.f(t)}b(t,e,i){var s=this;i?i[0]=i[1]=i[2]=i[3]=1:i=Xi(1,1,1,1);let r=Pe(1,1,1);return s.a(t.c.e)&&s.d.e(t,e,r,r),s.f(t.c.e)&&(i[3]=s.g.e(t,e,32767)/32767),i[0]=r[0],i[1]=r[1],i[2]=r[2],i}};const Jr=class{constructor(t){this.a=new wr(t,_r)}c(){this.a.c(),this.a=null}b(t){return this.a.b(t)}d(t,e){var i=1;this.b(t.c.e)&&(i=this.a.e(t,e,i)/32767);return i>1?i=1:i<0&&(i=0),i}};const tn=class{constructor(t){var e=this;e.b=t.getFloat(),e.d=t.getFloat(),e.c=t.getFloat(),e.a=new Tr(t)}};const en=class{constructor(t){this.k=t.getInt32(),this.c=t.getUint32(),this.u=Pe(t.getFloat(),t.getFloat(),t.getFloat()),this.K=t.getInt16(),this.t=t.getInt16(),268435456&this.c&&(this.b=[0,0,0],this.b[0]=31&this.t,this.b[1]=this.t>>5&31,this.b[2]=this.t>>10&31),this.f=t.getUint8(),this.E=t.getUint8(),this.V=t.getUint16(),this.Q=t.getUint16(),this.g=t.getUint16(),this.h=t.getUint16(),this.x=new wr(t,br),this.z=new wr(t,br),this.J=new wr(t,br),this.q=new wr(t,br),this.H=new wr(t,fr),this.i=new wr(t,br),this.o=t.getFloat(),this.aa=new wr(t,br),this.L=t.getFloat(),this.B=new wr(t,br),this.R=new wr(t,br),this.a=new wr(t,br),this.s=new vr(t),this.N=new Tr(t),this.A=new xr(t),this.e=[t.getFloat(),t.getFloat()],this.F=new Tr(t),this.r=new Tr(t),this.I=t.getFloat(),this.X=t.getFloat(),this.p=t.getFloat(),this.M=[t.getFloat(),t.getFloat()],this.v=t.getFloat(),this.T=t.getFloat(),this.D=t.getFloat(),this.y=t.getFloat(),this.G=t.getFloat(),this.Y=t.getFloat(),this.C=Pe(t.getFloat(),t.getFloat(),t.getFloat()),this.d=Pe(t.getFloat(),t.getFloat(),t.getFloat()),this.w=Pe(t.getFloat(),t.getFloat(),t.getFloat()),this.m=t.getFloat(),this.l=t.getFloat(),this.Z=t.getFloat(),this.j=t.getFloat(),this.S=t.getFloat();var e=t.getInt32();this.n=new Array(e);for(var i=0;i<e;i++)this.n[i]=Pe(t.getFloat(),t.getFloat(),t.getFloat());this.P=new wr(t,pr),this.O=qs(t.getFloat(),t.getFloat()),this.U=[qs(t.getFloat(),t.getFloat()),qs(t.getFloat(),t.getFloat())],this.W=[qs(t.getFloat(),t.getFloat()),qs(t.getFloat(),t.getFloat())]}};class sn{constructor(t){this.c=t.getInt32(),this.b=t.getUint32(),this.e=t.getInt16(),this.f=t.getUint16(),this.d=t.getUint32(),this.i=Pe(t.getFloat(),t.getFloat(),t.getFloat()),this.a=new wr(t,fr),this.h=new wr(t,gr),this.g=new wr(t,fr)}}const rn=class{constructor(t){this.buffer=new DataView(t),this.position=0}getBool(){var t=0!=this.buffer.getUint8(this.position);return this.position+=1,t}getUint8(){var t=this.buffer.getUint8(this.position);return this.position+=1,t}getInt8(){var t=this.buffer.getInt8(this.position);return this.position+=1,t}getUint16(){var t=this.buffer.getUint16(this.position,!0);return this.position+=2,t}getInt16(){var t=this.buffer.getInt16(this.position,!0);return this.position+=2,t}getUint32(){var t=this.buffer.getUint32(this.position,!0);return this.position+=4,t}getInt32(){var t=this.buffer.getInt32(this.position,!0);return this.position+=4,t}getFloat(){var t=this.buffer.getFloat32(this.position,!0);return this.position+=4,t}getString(t){void 0===t&&(t=this.getUint16());for(var e="",i=0;i<t;++i)e+=String.fromCharCode(this.getUint8());return e}setBool(t){this.buffer.setUint8(this.position,t?1:0),this.position+=1}setUint8(t){this.buffer.setUint8(this.position,t),this.position+=1}setInt8(t){this.buffer.setInt8(this.position,t),this.position+=1}setUint16(t){this.buffer.setUint16(this.position,t,!0),this.position+=2}setInt16(t){this.buffer.setInt16(this.position,t,!0),this.position+=2}setUint32(t){this.buffer.setUint32(this.position,t,!0),this.position+=4}setInt32(t){this.buffer.setInt32(this.position,t,!0),this.position+=4}setFloat(t){this.buffer.setFloat32(this.position,t,!0),this.position+=4}};function nn(t){let e=t.length;for(;--e>=0;)t[e]=0}const an=256,on=286,hn=30,ln=15,un=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),cn=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),dn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),fn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gn=new Array(576);nn(gn);const _n=new Array(60);nn(_n);const bn=new Array(512);nn(bn);const pn=new Array(256);nn(pn);const mn=new Array(29);nn(mn);const xn=new Array(hn);function vn(t,e,i,s,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=s,this.max_length=r,this.has_stree=t&&t.length}let Tn,wn,yn;function En(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}nn(xn);const An=t=>t<256?bn[t]:bn[256+(t>>>7)],Cn=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Mn=(t,e,i)=>{t.bi_valid>16-i?(t.bi_buf|=e<<t.bi_valid&65535,Cn(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)},Sn=(t,e,i)=>{Mn(t,i[2*e],i[2*e+1])},Fn=(t,e)=>{let i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1},kn=(t,e,i)=>{const s=new Array(16);let r,n,a=0;for(r=1;r<=ln;r++)a=a+i[r-1]<<1,s[r]=a;for(n=0;n<=e;n++){let e=t[2*n+1];0!==e&&(t[2*n]=Fn(s[e]++,e))}},In=t=>{let e;for(e=0;e<on;e++)t.dyn_ltree[2*e]=0;for(e=0;e<hn;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Dn=t=>{t.bi_valid>8?Cn(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Un=(t,e,i,s)=>{const r=2*e,n=2*i;return t[r]<t[n]||t[r]===t[n]&&s[e]<=s[i]},Rn=(t,e,i)=>{const s=t.heap[i];let r=i<<1;for(;r<=t.heap_len&&(r<t.heap_len&&Un(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!Un(e,s,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=s},Bn=(t,e,i)=>{let s,r,n,a,o=0;if(0!==t.sym_next)do{s=255&t.pending_buf[t.sym_buf+o++],s+=(255&t.pending_buf[t.sym_buf+o++])<<8,r=t.pending_buf[t.sym_buf+o++],0===s?Sn(t,r,e):(n=pn[r],Sn(t,n+an+1,e),a=un[n],0!==a&&(r-=mn[n],Mn(t,r,a)),s--,n=An(s),Sn(t,n,i),a=cn[n],0!==a&&(s-=xn[n],Mn(t,s,a)))}while(o<t.sym_next);Sn(t,256,e)},On=(t,e)=>{const i=e.dyn_tree,s=e.stat_desc.static_tree,r=e.stat_desc.has_stree,n=e.stat_desc.elems;let a,o,h,l=-1;for(t.heap_len=0,t.heap_max=573,a=0;a<n;a++)0!==i[2*a]?(t.heap[++t.heap_len]=l=a,t.depth[a]=0):i[2*a+1]=0;for(;t.heap_len<2;)h=t.heap[++t.heap_len]=l<2?++l:0,i[2*h]=1,t.depth[h]=0,t.opt_len--,r&&(t.static_len-=s[2*h+1]);for(e.max_code=l,a=t.heap_len>>1;a>=1;a--)Rn(t,i,a);h=n;do{a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Rn(t,i,1),o=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=o,i[2*h]=i[2*a]+i[2*o],t.depth[h]=(t.depth[a]>=t.depth[o]?t.depth[a]:t.depth[o])+1,i[2*a+1]=i[2*o+1]=h,t.heap[1]=h++,Rn(t,i,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const i=e.dyn_tree,s=e.max_code,r=e.stat_desc.static_tree,n=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,o=e.stat_desc.extra_base,h=e.stat_desc.max_length;let l,u,c,d,f,g,_=0;for(d=0;d<=ln;d++)t.bl_count[d]=0;for(i[2*t.heap[t.heap_max]+1]=0,l=t.heap_max+1;l<573;l++)u=t.heap[l],d=i[2*i[2*u+1]+1]+1,d>h&&(d=h,_++),i[2*u+1]=d,u>s||(t.bl_count[d]++,f=0,u>=o&&(f=a[u-o]),g=i[2*u],t.opt_len+=g*(d+f),n&&(t.static_len+=g*(r[2*u+1]+f)));if(0!==_){do{for(d=h-1;0===t.bl_count[d];)d--;t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[h]--,_-=2}while(_>0);for(d=h;0!==d;d--)for(u=t.bl_count[d];0!==u;)c=t.heap[--l],c>s||(i[2*c+1]!==d&&(t.opt_len+=(d-i[2*c+1])*i[2*c],i[2*c+1]=d),u--)}})(t,e),kn(i,l,t.bl_count)},Pn=(t,e,i)=>{let s,r,n=-1,a=e[1],o=0,h=7,l=4;for(0===a&&(h=138,l=3),e[2*(i+1)+1]=65535,s=0;s<=i;s++)r=a,a=e[2*(s+1)+1],++o<h&&r===a||(o<l?t.bl_tree[2*r]+=o:0!==r?(r!==n&&t.bl_tree[2*r]++,t.bl_tree[32]++):o<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=0,n=r,0===a?(h=138,l=3):r===a?(h=6,l=3):(h=7,l=4))},zn=(t,e,i)=>{let s,r,n=-1,a=e[1],o=0,h=7,l=4;for(0===a&&(h=138,l=3),s=0;s<=i;s++)if(r=a,a=e[2*(s+1)+1],!(++o<h&&r===a)){if(o<l)do{Sn(t,r,t.bl_tree)}while(0!==--o);else 0!==r?(r!==n&&(Sn(t,r,t.bl_tree),o--),Sn(t,16,t.bl_tree),Mn(t,o-3,2)):o<=10?(Sn(t,17,t.bl_tree),Mn(t,o-3,3)):(Sn(t,18,t.bl_tree),Mn(t,o-11,7));o=0,n=r,0===a?(h=138,l=3):r===a?(h=6,l=3):(h=7,l=4)}};let Gn=!1;const Ln=(t,e,i,s)=>{Mn(t,0+(s?1:0),3),Dn(t),Cn(t,i),Cn(t,~i),i&&t.pending_buf.set(t.window.subarray(e,e+i),t.pending),t.pending+=i};var Nn=t=>{Gn||((()=>{let t,e,i,s,r;const n=new Array(16);for(i=0,s=0;s<28;s++)for(mn[s]=i,t=0;t<1<<un[s];t++)pn[i++]=s;for(pn[i-1]=s,r=0,s=0;s<16;s++)for(xn[s]=r,t=0;t<1<<cn[s];t++)bn[r++]=s;for(r>>=7;s<hn;s++)for(xn[s]=r<<7,t=0;t<1<<cn[s]-7;t++)bn[256+r++]=s;for(e=0;e<=ln;e++)n[e]=0;for(t=0;t<=143;)gn[2*t+1]=8,t++,n[8]++;for(;t<=255;)gn[2*t+1]=9,t++,n[9]++;for(;t<=279;)gn[2*t+1]=7,t++,n[7]++;for(;t<=287;)gn[2*t+1]=8,t++,n[8]++;for(kn(gn,287,n),t=0;t<hn;t++)_n[2*t+1]=5,_n[2*t]=Fn(t,5);Tn=new vn(gn,un,257,on,ln),wn=new vn(_n,cn,0,hn,ln),yn=new vn(new Array(0),dn,0,19,7)})(),Gn=!0),t.l_desc=new En(t.dyn_ltree,Tn),t.d_desc=new En(t.dyn_dtree,wn),t.bl_desc=new En(t.bl_tree,yn),t.bi_buf=0,t.bi_valid=0,In(t)},jn=(t,e,i,s)=>{let r,n,a=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<an;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),On(t,t.l_desc),On(t,t.d_desc),a=(t=>{let e;for(Pn(t,t.dyn_ltree,t.l_desc.max_code),Pn(t,t.dyn_dtree,t.d_desc.max_code),On(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*fn[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),r=t.opt_len+3+7>>>3,n=t.static_len+3+7>>>3,n<=r&&(r=n)):r=n=i+5,i+4<=r&&-1!==e?Ln(t,e,i,s):4===t.strategy||n===r?(Mn(t,2+(s?1:0),3),Bn(t,gn,_n)):(Mn(t,4+(s?1:0),3),((t,e,i,s)=>{let r;for(Mn(t,e-257,5),Mn(t,i-1,5),Mn(t,s-4,4),r=0;r<s;r++)Mn(t,t.bl_tree[2*fn[r]+1],3);zn(t,t.dyn_ltree,e-1),zn(t,t.dyn_dtree,i-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),Bn(t,t.dyn_ltree,t.dyn_dtree)),In(t),s&&Dn(t)},Hn=(t,e,i)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=i,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(pn[i]+an+1)]++,t.dyn_dtree[2*An(e)]++),t.sym_next===t.sym_end),qn={_tr_init:Nn,_tr_stored_block:Ln,_tr_flush_block:jn,_tr_tally:Hn,_tr_align:t=>{Mn(t,2,3),Sn(t,256,gn),(t=>{16===t.bi_valid?(Cn(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}};var Vn=(t,e,i,s)=>{let r=65535&t,n=t>>>16&65535,a=0;for(;0!==i;){a=i>2e3?2e3:i,i-=a;do{r=r+e[s++]|0,n=n+r|0}while(--a);r%=65521,n%=65521}return r|n<<16};const Xn=new Uint32Array((()=>{let t,e=[];for(var i=0;i<256;i++){t=i;for(var s=0;s<8;s++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e})());var Yn=(t,e,i,s)=>{const r=Xn,n=s+i;t^=-1;for(let i=s;i<n;i++)t=t>>>8^r[255&(t^e[i])];return-1^t},Wn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Kn={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Zn,_tr_stored_block:Qn,_tr_flush_block:$n,_tr_tally:Jn,_tr_align:ta}=qn,{Z_NO_FLUSH:ea,Z_PARTIAL_FLUSH:ia,Z_FULL_FLUSH:sa,Z_FINISH:ra,Z_BLOCK:na,Z_OK:aa,Z_STREAM_END:oa,Z_STREAM_ERROR:ha,Z_DATA_ERROR:la,Z_BUF_ERROR:ua,Z_DEFAULT_COMPRESSION:ca,Z_FILTERED:da,Z_HUFFMAN_ONLY:fa,Z_RLE:ga,Z_FIXED:_a,Z_DEFAULT_STRATEGY:ba,Z_UNKNOWN:pa,Z_DEFLATED:ma}=Kn,xa=258,va=262,Ta=42,wa=113,ya=666,Ea=(t,e)=>(t.msg=Wn[e],e),Aa=t=>2*t-(t>4?9:0),Ca=t=>{let e=t.length;for(;--e>=0;)t[e]=0},Ma=t=>{let e,i,s,r=t.w_size;e=t.hash_size,s=e;do{i=t.head[--s],t.head[s]=i>=r?i-r:0}while(--e);e=r,s=e;do{i=t.prev[--s],t.prev[s]=i>=r?i-r:0}while(--e)};let Sa=(t,e,i)=>(e<<t.hash_shift^i)&t.hash_mask;const Fa=t=>{const e=t.state;let i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+i),t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))},ka=(t,e)=>{$n(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Fa(t.strm)},Ia=(t,e)=>{t.pending_buf[t.pending++]=e},Da=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},Ua=(t,e,i,s)=>{let r=t.avail_in;return r>s&&(r=s),0===r?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),i),1===t.state.wrap?t.adler=Vn(t.adler,e,r,i):2===t.state.wrap&&(t.adler=Yn(t.adler,e,r,i)),t.next_in+=r,t.total_in+=r,r)},Ra=(t,e)=>{let i,s,r=t.max_chain_length,n=t.strstart,a=t.prev_length,o=t.nice_match;const h=t.strstart>t.w_size-va?t.strstart-(t.w_size-va):0,l=t.window,u=t.w_mask,c=t.prev,d=t.strstart+xa;let f=l[n+a-1],g=l[n+a];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(i=e,l[i+a]===g&&l[i+a-1]===f&&l[i]===l[n]&&l[++i]===l[n+1]){n+=2,i++;do{}while(l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&n<d);if(s=xa-(d-n),n=d-xa,s>a){if(t.match_start=e,a=s,s>=o)break;f=l[n+a-1],g=l[n+a]}}}while((e=c[e&u])>h&&0!==--r);return a<=t.lookahead?a:t.lookahead},Ba=t=>{const e=t.w_size;let i,s,r;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-va)&&(t.window.set(t.window.subarray(e,e+e-s),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),Ma(t),s+=e),0===t.strm.avail_in)break;if(i=Ua(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=i,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=Sa(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=Sa(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<va&&0!==t.strm.avail_in)},Oa=(t,e)=>{let i,s,r,n=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,a=0,o=t.strm.avail_in;do{if(i=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r)break;if(r=t.strm.avail_out-r,s=t.strstart-t.block_start,i>s+t.strm.avail_in&&(i=s+t.strm.avail_in),i>r&&(i=r),i<n&&(0===i&&e!==ra||e===ea||i!==s+t.strm.avail_in))break;a=e===ra&&i===s+t.strm.avail_in?1:0,Qn(t,0,0,a),t.pending_buf[t.pending-4]=i,t.pending_buf[t.pending-3]=i>>8,t.pending_buf[t.pending-2]=~i,t.pending_buf[t.pending-1]=~i>>8,Fa(t.strm),s&&(s>i&&(s=i),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+s),t.strm.next_out),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s,t.block_start+=s,i-=s),i&&(Ua(t.strm,t.strm.output,t.strm.next_out,i),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i)}while(0===a);return o-=t.strm.avail_in,o&&(o>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=o&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-o,t.strm.next_in),t.strstart),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),a?4:e!==ea&&e!==ra&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(Ua(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,n=r>t.w_size?t.w_size:r,s=t.strstart-t.block_start,(s>=n||(s||e===ra)&&e!==ea&&0===t.strm.avail_in&&s<=r)&&(i=s>r?r:s,a=e===ra&&0===t.strm.avail_in&&i===s?1:0,Qn(t,t.block_start,i,a),t.block_start+=i,Fa(t.strm)),a?3:1)},Pa=(t,e)=>{let i,s;for(;;){if(t.lookahead<va){if(Ba(t),t.lookahead<va&&e===ea)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=Sa(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-va&&(t.match_length=Ra(t,i)),t.match_length>=3)if(s=Jn(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=Sa(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Sa(t,t.ins_h,t.window[t.strstart+1]);else s=Jn(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(s&&(ka(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===ra?(ka(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ka(t,!1),0===t.strm.avail_out)?1:2},za=(t,e)=>{let i,s,r;for(;;){if(t.lookahead<va){if(Ba(t),t.lookahead<va&&e===ea)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=Sa(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-va&&(t.match_length=Ra(t,i),t.match_length<=5&&(t.strategy===da||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,s=Jn(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=Sa(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,s&&(ka(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(s=Jn(t,0,t.window[t.strstart-1]),s&&ka(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(s=Jn(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===ra?(ka(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ka(t,!1),0===t.strm.avail_out)?1:2};function Ga(t,e,i,s,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=s,this.func=r}const La=[new Ga(0,0,0,0,Oa),new Ga(4,4,8,4,Pa),new Ga(4,5,16,8,Pa),new Ga(4,6,32,32,Pa),new Ga(4,4,16,16,za),new Ga(8,16,32,32,za),new Ga(8,16,128,128,za),new Ga(8,32,128,256,za),new Ga(32,128,258,1024,za),new Ga(32,258,258,4096,za)];function Na(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ma,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Ca(this.dyn_ltree),Ca(this.dyn_dtree),Ca(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Ca(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Ca(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ja=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==Ta&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&e.status!==wa&&e.status!==ya?1:0},Ha=t=>{if(ja(t))return Ea(t,ha);t.total_in=t.total_out=0,t.data_type=pa;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?Ta:wa,t.adler=2===e.wrap?0:1,e.last_flush=-2,Zn(e),aa},qa=t=>{const e=Ha(t);var i;return e===aa&&((i=t.state).window_size=2*i.w_size,Ca(i.head),i.max_lazy_match=La[i.level].max_lazy,i.good_match=La[i.level].good_length,i.nice_match=La[i.level].nice_length,i.max_chain_length=La[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),e},Va=(t,e,i,s,r,n)=>{if(!t)return ha;let a=1;if(e===ca&&(e=6),s<0?(a=0,s=-s):s>15&&(a=2,s-=16),r<1||r>9||i!==ma||s<8||s>15||e<0||e>9||n<0||n>_a||8===s&&1!==a)return Ea(t,ha);8===s&&(s=9);const o=new Na;return t.state=o,o.strm=t,o.status=Ta,o.wrap=a,o.gzhead=null,o.w_bits=s,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=r+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<r+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=e,o.strategy=n,o.method=i,qa(t)};var Xa=(t,e)=>{if(ja(t)||e>na||e<0)return t?Ea(t,ha):ha;const i=t.state;if(!t.output||0!==t.avail_in&&!t.input||i.status===ya&&e!==ra)return Ea(t,0===t.avail_out?ua:ha);const s=i.last_flush;if(i.last_flush=e,0!==i.pending){if(Fa(t),0===t.avail_out)return i.last_flush=-1,aa}else if(0===t.avail_in&&Aa(e)<=Aa(s)&&e!==ra)return Ea(t,ua);if(i.status===ya&&0!==t.avail_in)return Ea(t,ua);if(i.status===Ta&&0===i.wrap&&(i.status=wa),i.status===Ta){let e=ma+(i.w_bits-8<<4)<<8,s=-1;if(s=i.strategy>=fa||i.level<2?0:i.level<6?1:6===i.level?2:3,e|=s<<6,0!==i.strstart&&(e|=32),e+=31-e%31,Da(i,e),0!==i.strstart&&(Da(i,t.adler>>>16),Da(i,65535&t.adler)),t.adler=1,i.status=wa,Fa(t),0!==i.pending)return i.last_flush=-1,aa}if(57===i.status)if(t.adler=0,Ia(i,31),Ia(i,139),Ia(i,8),i.gzhead)Ia(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Ia(i,255&i.gzhead.time),Ia(i,i.gzhead.time>>8&255),Ia(i,i.gzhead.time>>16&255),Ia(i,i.gzhead.time>>24&255),Ia(i,9===i.level?2:i.strategy>=fa||i.level<2?4:0),Ia(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Ia(i,255&i.gzhead.extra.length),Ia(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=Yn(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Ia(i,0),Ia(i,0),Ia(i,0),Ia(i,0),Ia(i,0),Ia(i,9===i.level?2:i.strategy>=fa||i.level<2?4:0),Ia(i,3),i.status=wa,Fa(t),0!==i.pending)return i.last_flush=-1,aa;if(69===i.status){if(i.gzhead.extra){let e=i.pending,s=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+s>i.pending_buf_size;){let r=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+r),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>e&&(t.adler=Yn(t.adler,i.pending_buf,i.pending-e,e)),i.gzindex+=r,Fa(t),0!==i.pending)return i.last_flush=-1,aa;e=0,s-=r}let r=new Uint8Array(i.gzhead.extra);i.pending_buf.set(r.subarray(i.gzindex,i.gzindex+s),i.pending),i.pending+=s,i.gzhead.hcrc&&i.pending>e&&(t.adler=Yn(t.adler,i.pending_buf,i.pending-e,e)),i.gzindex=0}i.status=73}if(73===i.status){if(i.gzhead.name){let e,s=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>s&&(t.adler=Yn(t.adler,i.pending_buf,i.pending-s,s)),Fa(t),0!==i.pending)return i.last_flush=-1,aa;s=0}e=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Ia(i,e)}while(0!==e);i.gzhead.hcrc&&i.pending>s&&(t.adler=Yn(t.adler,i.pending_buf,i.pending-s,s)),i.gzindex=0}i.status=91}if(91===i.status){if(i.gzhead.comment){let e,s=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>s&&(t.adler=Yn(t.adler,i.pending_buf,i.pending-s,s)),Fa(t),0!==i.pending)return i.last_flush=-1,aa;s=0}e=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Ia(i,e)}while(0!==e);i.gzhead.hcrc&&i.pending>s&&(t.adler=Yn(t.adler,i.pending_buf,i.pending-s,s))}i.status=103}if(103===i.status){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(Fa(t),0!==i.pending))return i.last_flush=-1,aa;Ia(i,255&t.adler),Ia(i,t.adler>>8&255),t.adler=0}if(i.status=wa,Fa(t),0!==i.pending)return i.last_flush=-1,aa}if(0!==t.avail_in||0!==i.lookahead||e!==ea&&i.status!==ya){let s=0===i.level?Oa(i,e):i.strategy===fa?((t,e)=>{let i;for(;;){if(0===t.lookahead&&(Ba(t),0===t.lookahead)){if(e===ea)return 1;break}if(t.match_length=0,i=Jn(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(ka(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===ra?(ka(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ka(t,!1),0===t.strm.avail_out)?1:2})(i,e):i.strategy===ga?((t,e)=>{let i,s,r,n;const a=t.window;for(;;){if(t.lookahead<=xa){if(Ba(t),t.lookahead<=xa&&e===ea)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(r=t.strstart-1,s=a[r],s===a[++r]&&s===a[++r]&&s===a[++r])){n=t.strstart+xa;do{}while(s===a[++r]&&s===a[++r]&&s===a[++r]&&s===a[++r]&&s===a[++r]&&s===a[++r]&&s===a[++r]&&s===a[++r]&&r<n);t.match_length=xa-(n-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(i=Jn(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=Jn(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(ka(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===ra?(ka(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ka(t,!1),0===t.strm.avail_out)?1:2})(i,e):La[i.level].func(i,e);if(3!==s&&4!==s||(i.status=ya),1===s||3===s)return 0===t.avail_out&&(i.last_flush=-1),aa;if(2===s&&(e===ia?ta(i):e!==na&&(Qn(i,0,0,!1),e===sa&&(Ca(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),Fa(t),0===t.avail_out))return i.last_flush=-1,aa}return e!==ra?aa:i.wrap<=0?oa:(2===i.wrap?(Ia(i,255&t.adler),Ia(i,t.adler>>8&255),Ia(i,t.adler>>16&255),Ia(i,t.adler>>24&255),Ia(i,255&t.total_in),Ia(i,t.total_in>>8&255),Ia(i,t.total_in>>16&255),Ia(i,t.total_in>>24&255)):(Da(i,t.adler>>>16),Da(i,65535&t.adler)),Fa(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?aa:oa)},Ya=(t,e)=>{let i=e.length;if(ja(t))return ha;const s=t.state,r=s.wrap;if(2===r||1===r&&s.status!==Ta||s.lookahead)return ha;if(1===r&&(t.adler=Vn(t.adler,e,i,0)),s.wrap=0,i>=s.w_size){0===r&&(Ca(s.head),s.strstart=0,s.block_start=0,s.insert=0);let t=new Uint8Array(s.w_size);t.set(e.subarray(i-s.w_size,i),0),e=t,i=s.w_size}const n=t.avail_in,a=t.next_in,o=t.input;for(t.avail_in=i,t.next_in=0,t.input=e,Ba(s);s.lookahead>=3;){let t=s.strstart,e=s.lookahead-2;do{s.ins_h=Sa(s,s.ins_h,s.window[t+3-1]),s.prev[t&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=t,t++}while(--e);s.strstart=t,s.lookahead=2,Ba(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,t.next_in=a,t.input=o,t.avail_in=n,s.wrap=r,aa},Wa={deflateInit:(t,e)=>Va(t,e,ma,15,8,ba),deflateInit2:Va,deflateReset:qa,deflateResetKeep:Ha,deflateSetHeader:(t,e)=>ja(t)||2!==t.state.wrap?ha:(t.state.gzhead=e,aa),deflate:Xa,deflateEnd:t=>{if(ja(t))return ha;const e=t.state.status;return t.state=null,e===wa?Ea(t,la):aa},deflateSetDictionary:Ya,deflateInfo:"pako deflate (from Nodeca project)"};const Ka=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Za=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const e in i)Ka(i,e)&&(t[e]=i[e])}}return t},Qa=t=>{let e=0;for(let i=0,s=t.length;i<s;i++)e+=t[i].length;const i=new Uint8Array(e);for(let e=0,s=0,r=t.length;e<r;e++){let r=t[e];i.set(r,s),s+=r.length}return i};let $a=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){$a=!1}const Ja=new Uint8Array(256);for(let t=0;t<256;t++)Ja[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Ja[254]=Ja[254]=1;var to=t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,i,s,r,n,a=t.length,o=0;for(r=0;r<a;r++)i=t.charCodeAt(r),55296==(64512&i)&&r+1<a&&(s=t.charCodeAt(r+1),56320==(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),r++)),o+=i<128?1:i<2048?2:i<65536?3:4;for(e=new Uint8Array(o),n=0,r=0;n<o;r++)i=t.charCodeAt(r),55296==(64512&i)&&r+1<a&&(s=t.charCodeAt(r+1),56320==(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),r++)),i<128?e[n++]=i:i<2048?(e[n++]=192|i>>>6,e[n++]=128|63&i):i<65536?(e[n++]=224|i>>>12,e[n++]=128|i>>>6&63,e[n++]=128|63&i):(e[n++]=240|i>>>18,e[n++]=128|i>>>12&63,e[n++]=128|i>>>6&63,e[n++]=128|63&i);return e},eo=(t,e)=>{const i=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let s,r;const n=new Array(2*i);for(r=0,s=0;s<i;){let e=t[s++];if(e<128){n[r++]=e;continue}let a=Ja[e];if(a>4)n[r++]=65533,s+=a-1;else{for(e&=2===a?31:3===a?15:7;a>1&&s<i;)e=e<<6|63&t[s++],a--;a>1?n[r++]=65533:e<65536?n[r++]=e:(e-=65536,n[r++]=55296|e>>10&1023,n[r++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&$a)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let i="";for(let s=0;s<e;s++)i+=String.fromCharCode(t[s]);return i})(n,r)},io=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let i=e-1;for(;i>=0&&128==(192&t[i]);)i--;return i<0||0===i?e:i+Ja[t[i]]>e?i:e};var so=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const ro=Object.prototype.toString,{Z_NO_FLUSH:no,Z_SYNC_FLUSH:ao,Z_FULL_FLUSH:oo,Z_FINISH:ho,Z_OK:lo,Z_STREAM_END:uo,Z_DEFAULT_COMPRESSION:co,Z_DEFAULT_STRATEGY:fo,Z_DEFLATED:go}=Kn;function _o(t){this.options=Za({level:co,method:go,chunkSize:16384,windowBits:15,memLevel:8,strategy:fo},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new so,this.strm.avail_out=0;let i=Wa.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==lo)throw new Error(Wn[i]);if(e.header&&Wa.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?to(e.dictionary):"[object ArrayBuffer]"===ro.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,i=Wa.deflateSetDictionary(this.strm,t),i!==lo)throw new Error(Wn[i]);this._dict_set=!0}}function bo(t,e){const i=new _o(e);if(i.push(t,!0),i.err)throw i.msg||Wn[i.err];return i.result}_o.prototype.push=function(t,e){const i=this.strm,s=this.options.chunkSize;let r,n;if(this.ended)return!1;for(n=e===~~e?e:!0===e?ho:no,"string"==typeof t?i.input=to(t):"[object ArrayBuffer]"===ro.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(n===ao||n===oo)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(r=Wa.deflate(i,n),r===uo)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),r=Wa.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===lo;if(0!==i.avail_out){if(n>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},_o.prototype.onData=function(t){this.chunks.push(t)},_o.prototype.onEnd=function(t){t===lo&&(this.result=Qa(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var po={Deflate:_o,deflate:bo,deflateRaw:function(t,e){return(e=e||{}).raw=!0,bo(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,bo(t,e)},constants:Kn};const mo=16209;var xo=function(t,e){let i,s,r,n,a,o,h,l,u,c,d,f,g,_,b,p,m,x,v,T,w,y,E,A;const C=t.state;i=t.next_in,E=t.input,s=i+(t.avail_in-5),r=t.next_out,A=t.output,n=r-(e-t.avail_out),a=r+(t.avail_out-257),o=C.dmax,h=C.wsize,l=C.whave,u=C.wnext,c=C.window,d=C.hold,f=C.bits,g=C.lencode,_=C.distcode,b=(1<<C.lenbits)-1,p=(1<<C.distbits)-1;t:do{f<15&&(d+=E[i++]<<f,f+=8,d+=E[i++]<<f,f+=8),m=g[d&b];e:for(;;){if(x=m>>>24,d>>>=x,f-=x,x=m>>>16&255,0===x)A[r++]=65535&m;else{if(!(16&x)){if(64&x){if(32&x){C.mode=16191;break t}t.msg="invalid literal/length code",C.mode=mo;break t}m=g[(65535&m)+(d&(1<<x)-1)];continue e}for(v=65535&m,x&=15,x&&(f<x&&(d+=E[i++]<<f,f+=8),v+=d&(1<<x)-1,d>>>=x,f-=x),f<15&&(d+=E[i++]<<f,f+=8,d+=E[i++]<<f,f+=8),m=_[d&p];;){if(x=m>>>24,d>>>=x,f-=x,x=m>>>16&255,16&x){if(T=65535&m,x&=15,f<x&&(d+=E[i++]<<f,f+=8,f<x&&(d+=E[i++]<<f,f+=8)),T+=d&(1<<x)-1,T>o){t.msg="invalid distance too far back",C.mode=mo;break t}if(d>>>=x,f-=x,x=r-n,T>x){if(x=T-x,x>l&&C.sane){t.msg="invalid distance too far back",C.mode=mo;break t}if(w=0,y=c,0===u){if(w+=h-x,x<v){v-=x;do{A[r++]=c[w++]}while(--x);w=r-T,y=A}}else if(u<x){if(w+=h+u-x,x-=u,x<v){v-=x;do{A[r++]=c[w++]}while(--x);if(w=0,u<v){x=u,v-=x;do{A[r++]=c[w++]}while(--x);w=r-T,y=A}}}else if(w+=u-x,x<v){v-=x;do{A[r++]=c[w++]}while(--x);w=r-T,y=A}for(;v>2;)A[r++]=y[w++],A[r++]=y[w++],A[r++]=y[w++],v-=3;v&&(A[r++]=y[w++],v>1&&(A[r++]=y[w++]))}else{w=r-T;do{A[r++]=A[w++],A[r++]=A[w++],A[r++]=A[w++],v-=3}while(v>2);v&&(A[r++]=A[w++],v>1&&(A[r++]=A[w++]))}break}if(64&x){t.msg="invalid distance code",C.mode=mo;break t}m=_[(65535&m)+(d&(1<<x)-1)]}}break}}while(i<s&&r<a);v=f>>3,i-=v,f-=v<<3,d&=(1<<f)-1,t.next_in=i,t.next_out=r,t.avail_in=i<s?s-i+5:5-(i-s),t.avail_out=r<a?a-r+257:257-(r-a),C.hold=d,C.bits=f};const vo=15,To=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),wo=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),yo=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Eo=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ao=(t,e,i,s,r,n,a,o)=>{const h=o.bits;let l,u,c,d,f,g,_=0,b=0,p=0,m=0,x=0,v=0,T=0,w=0,y=0,E=0,A=null;const C=new Uint16Array(16),M=new Uint16Array(16);let S,F,k,I=null;for(_=0;_<=vo;_++)C[_]=0;for(b=0;b<s;b++)C[e[i+b]]++;for(x=h,m=vo;m>=1&&0===C[m];m--);if(x>m&&(x=m),0===m)return r[n++]=20971520,r[n++]=20971520,o.bits=1,0;for(p=1;p<m&&0===C[p];p++);for(x<p&&(x=p),w=1,_=1;_<=vo;_++)if(w<<=1,w-=C[_],w<0)return-1;if(w>0&&(0===t||1!==m))return-1;for(M[1]=0,_=1;_<vo;_++)M[_+1]=M[_]+C[_];for(b=0;b<s;b++)0!==e[i+b]&&(a[M[e[i+b]]++]=b);if(0===t?(A=I=a,g=20):1===t?(A=To,I=wo,g=257):(A=yo,I=Eo,g=0),E=0,b=0,_=p,f=n,v=x,T=0,c=-1,y=1<<x,d=y-1,1===t&&y>852||2===t&&y>592)return 1;for(;;){S=_-T,a[b]+1<g?(F=0,k=a[b]):a[b]>=g?(F=I[a[b]-g],k=A[a[b]-g]):(F=96,k=0),l=1<<_-T,u=1<<v,p=u;do{u-=l,r[f+(E>>T)+u]=S<<24|F<<16|k}while(0!==u);for(l=1<<_-1;E&l;)l>>=1;if(0!==l?(E&=l-1,E+=l):E=0,b++,0===--C[_]){if(_===m)break;_=e[i+a[b]]}if(_>x&&(E&d)!==c){for(0===T&&(T=x),f+=p,v=_-T,w=1<<v;v+T<m&&(w-=C[v+T],!(w<=0));)v++,w<<=1;if(y+=1<<v,1===t&&y>852||2===t&&y>592)return 1;c=E&d,r[c]=x<<24|v<<16|f-n}}return 0!==E&&(r[f+E]=_-T<<24|64<<16),o.bits=x,0};const{Z_FINISH:Co,Z_BLOCK:Mo,Z_TREES:So,Z_OK:Fo,Z_STREAM_END:ko,Z_NEED_DICT:Io,Z_STREAM_ERROR:Do,Z_DATA_ERROR:Uo,Z_MEM_ERROR:Ro,Z_BUF_ERROR:Bo,Z_DEFLATED:Oo}=Kn,Po=16180,zo=16190,Go=16191,Lo=16192,No=16194,jo=16199,Ho=16200,qo=16206,Vo=16209,Xo=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Yo(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Wo=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Po||e.mode>16211?1:0},Ko=t=>{if(Wo(t))return Do;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Po,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,Fo},Zo=t=>{if(Wo(t))return Do;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Ko(t)},Qo=(t,e)=>{let i;if(Wo(t))return Do;const s=t.state;return e<0?(i=0,e=-e):(i=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Do:(null!==s.window&&s.wbits!==e&&(s.window=null),s.wrap=i,s.wbits=e,Zo(t))},$o=(t,e)=>{if(!t)return Do;const i=new Yo;t.state=i,i.strm=t,i.window=null,i.mode=Po;const s=Qo(t,e);return s!==Fo&&(t.state=null),s};let Jo,th,eh=!0;const ih=t=>{if(eh){Jo=new Int32Array(512),th=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Ao(1,t.lens,0,288,Jo,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Ao(2,t.lens,0,32,th,0,t.work,{bits:5}),eh=!1}t.lencode=Jo,t.lenbits=9,t.distcode=th,t.distbits=5},sh=(t,e,i,s)=>{let r;const n=t.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),s>=n.wsize?(n.window.set(e.subarray(i-n.wsize,i),0),n.wnext=0,n.whave=n.wsize):(r=n.wsize-n.wnext,r>s&&(r=s),n.window.set(e.subarray(i-s,i-s+r),n.wnext),(s-=r)?(n.window.set(e.subarray(i-s,i),0),n.wnext=s,n.whave=n.wsize):(n.wnext+=r,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=r))),0};var rh=(t,e)=>{let i,s,r,n,a,o,h,l,u,c,d,f,g,_,b,p,m,x,v,T,w,y,E=0;const A=new Uint8Array(4);let C,M;const S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Wo(t)||!t.output||!t.input&&0!==t.avail_in)return Do;i=t.state,i.mode===Go&&(i.mode=Lo),a=t.next_out,r=t.output,h=t.avail_out,n=t.next_in,s=t.input,o=t.avail_in,l=i.hold,u=i.bits,c=o,d=h,y=Fo;t:for(;;)switch(i.mode){case Po:if(0===i.wrap){i.mode=Lo;break}for(;u<16;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}if(2&i.wrap&&35615===l){0===i.wbits&&(i.wbits=15),i.check=0,A[0]=255&l,A[1]=l>>>8&255,i.check=Yn(i.check,A,2,0),l=0,u=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&l)<<8)+(l>>8))%31){t.msg="incorrect header check",i.mode=Vo;break}if((15&l)!==Oo){t.msg="unknown compression method",i.mode=Vo;break}if(l>>>=4,u-=4,w=8+(15&l),0===i.wbits&&(i.wbits=w),w>15||w>i.wbits){t.msg="invalid window size",i.mode=Vo;break}i.dmax=1<<i.wbits,i.flags=0,t.adler=i.check=1,i.mode=512&l?16189:Go,l=0,u=0;break;case 16181:for(;u<16;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}if(i.flags=l,(255&i.flags)!==Oo){t.msg="unknown compression method",i.mode=Vo;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=Vo;break}i.head&&(i.head.text=l>>8&1),512&i.flags&&4&i.wrap&&(A[0]=255&l,A[1]=l>>>8&255,i.check=Yn(i.check,A,2,0)),l=0,u=0,i.mode=16182;case 16182:for(;u<32;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}i.head&&(i.head.time=l),512&i.flags&&4&i.wrap&&(A[0]=255&l,A[1]=l>>>8&255,A[2]=l>>>16&255,A[3]=l>>>24&255,i.check=Yn(i.check,A,4,0)),l=0,u=0,i.mode=16183;case 16183:for(;u<16;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}i.head&&(i.head.xflags=255&l,i.head.os=l>>8),512&i.flags&&4&i.wrap&&(A[0]=255&l,A[1]=l>>>8&255,i.check=Yn(i.check,A,2,0)),l=0,u=0,i.mode=16184;case 16184:if(1024&i.flags){for(;u<16;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}i.length=l,i.head&&(i.head.extra_len=l),512&i.flags&&4&i.wrap&&(A[0]=255&l,A[1]=l>>>8&255,i.check=Yn(i.check,A,2,0)),l=0,u=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&i.flags&&(f=i.length,f>o&&(f=o),f&&(i.head&&(w=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(s.subarray(n,n+f),w)),512&i.flags&&4&i.wrap&&(i.check=Yn(i.check,s,f,n)),o-=f,n+=f,i.length-=f),i.length))break t;i.length=0,i.mode=16186;case 16186:if(2048&i.flags){if(0===o)break t;f=0;do{w=s[n+f++],i.head&&w&&i.length<65536&&(i.head.name+=String.fromCharCode(w))}while(w&&f<o);if(512&i.flags&&4&i.wrap&&(i.check=Yn(i.check,s,f,n)),o-=f,n+=f,w)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&i.flags){if(0===o)break t;f=0;do{w=s[n+f++],i.head&&w&&i.length<65536&&(i.head.comment+=String.fromCharCode(w))}while(w&&f<o);if(512&i.flags&&4&i.wrap&&(i.check=Yn(i.check,s,f,n)),o-=f,n+=f,w)break t}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&i.flags){for(;u<16;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}if(4&i.wrap&&l!==(65535&i.check)){t.msg="header crc mismatch",i.mode=Vo;break}l=0,u=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=Go;break;case 16189:for(;u<32;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}t.adler=i.check=Xo(l),l=0,u=0,i.mode=zo;case zo:if(0===i.havedict)return t.next_out=a,t.avail_out=h,t.next_in=n,t.avail_in=o,i.hold=l,i.bits=u,Io;t.adler=i.check=1,i.mode=Go;case Go:if(e===Mo||e===So)break t;case Lo:if(i.last){l>>>=7&u,u-=7&u,i.mode=qo;break}for(;u<3;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}switch(i.last=1&l,l>>>=1,u-=1,3&l){case 0:i.mode=16193;break;case 1:if(ih(i),i.mode=jo,e===So){l>>>=2,u-=2;break t}break;case 2:i.mode=16196;break;case 3:t.msg="invalid block type",i.mode=Vo}l>>>=2,u-=2;break;case 16193:for(l>>>=7&u,u-=7&u;u<32;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}if((65535&l)!=(l>>>16^65535)){t.msg="invalid stored block lengths",i.mode=Vo;break}if(i.length=65535&l,l=0,u=0,i.mode=No,e===So)break t;case No:i.mode=16195;case 16195:if(f=i.length,f){if(f>o&&(f=o),f>h&&(f=h),0===f)break t;r.set(s.subarray(n,n+f),a),o-=f,n+=f,h-=f,a+=f,i.length-=f;break}i.mode=Go;break;case 16196:for(;u<14;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}if(i.nlen=257+(31&l),l>>>=5,u-=5,i.ndist=1+(31&l),l>>>=5,u-=5,i.ncode=4+(15&l),l>>>=4,u-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=Vo;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;u<3;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}i.lens[S[i.have++]]=7&l,l>>>=3,u-=3}for(;i.have<19;)i.lens[S[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,C={bits:i.lenbits},y=Ao(0,i.lens,0,19,i.lencode,0,i.work,C),i.lenbits=C.bits,y){t.msg="invalid code lengths set",i.mode=Vo;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;E=i.lencode[l&(1<<i.lenbits)-1],b=E>>>24,p=E>>>16&255,m=65535&E,!(b<=u);){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}if(m<16)l>>>=b,u-=b,i.lens[i.have++]=m;else{if(16===m){for(M=b+2;u<M;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}if(l>>>=b,u-=b,0===i.have){t.msg="invalid bit length repeat",i.mode=Vo;break}w=i.lens[i.have-1],f=3+(3&l),l>>>=2,u-=2}else if(17===m){for(M=b+3;u<M;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}l>>>=b,u-=b,w=0,f=3+(7&l),l>>>=3,u-=3}else{for(M=b+7;u<M;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}l>>>=b,u-=b,w=0,f=11+(127&l),l>>>=7,u-=7}if(i.have+f>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=Vo;break}for(;f--;)i.lens[i.have++]=w}}if(i.mode===Vo)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=Vo;break}if(i.lenbits=9,C={bits:i.lenbits},y=Ao(1,i.lens,0,i.nlen,i.lencode,0,i.work,C),i.lenbits=C.bits,y){t.msg="invalid literal/lengths set",i.mode=Vo;break}if(i.distbits=6,i.distcode=i.distdyn,C={bits:i.distbits},y=Ao(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,C),i.distbits=C.bits,y){t.msg="invalid distances set",i.mode=Vo;break}if(i.mode=jo,e===So)break t;case jo:i.mode=Ho;case Ho:if(o>=6&&h>=258){t.next_out=a,t.avail_out=h,t.next_in=n,t.avail_in=o,i.hold=l,i.bits=u,xo(t,d),a=t.next_out,r=t.output,h=t.avail_out,n=t.next_in,s=t.input,o=t.avail_in,l=i.hold,u=i.bits,i.mode===Go&&(i.back=-1);break}for(i.back=0;E=i.lencode[l&(1<<i.lenbits)-1],b=E>>>24,p=E>>>16&255,m=65535&E,!(b<=u);){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}if(p&&!(240&p)){for(x=b,v=p,T=m;E=i.lencode[T+((l&(1<<x+v)-1)>>x)],b=E>>>24,p=E>>>16&255,m=65535&E,!(x+b<=u);){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}l>>>=x,u-=x,i.back+=x}if(l>>>=b,u-=b,i.back+=b,i.length=m,0===p){i.mode=16205;break}if(32&p){i.back=-1,i.mode=Go;break}if(64&p){t.msg="invalid literal/length code",i.mode=Vo;break}i.extra=15&p,i.mode=16201;case 16201:if(i.extra){for(M=i.extra;u<M;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}i.length+=l&(1<<i.extra)-1,l>>>=i.extra,u-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;E=i.distcode[l&(1<<i.distbits)-1],b=E>>>24,p=E>>>16&255,m=65535&E,!(b<=u);){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}if(!(240&p)){for(x=b,v=p,T=m;E=i.distcode[T+((l&(1<<x+v)-1)>>x)],b=E>>>24,p=E>>>16&255,m=65535&E,!(x+b<=u);){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}l>>>=x,u-=x,i.back+=x}if(l>>>=b,u-=b,i.back+=b,64&p){t.msg="invalid distance code",i.mode=Vo;break}i.offset=m,i.extra=15&p,i.mode=16203;case 16203:if(i.extra){for(M=i.extra;u<M;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}i.offset+=l&(1<<i.extra)-1,l>>>=i.extra,u-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=Vo;break}i.mode=16204;case 16204:if(0===h)break t;if(f=d-h,i.offset>f){if(f=i.offset-f,f>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=Vo;break}f>i.wnext?(f-=i.wnext,g=i.wsize-f):g=i.wnext-f,f>i.length&&(f=i.length),_=i.window}else _=r,g=a-i.offset,f=i.length;f>h&&(f=h),h-=f,i.length-=f;do{r[a++]=_[g++]}while(--f);0===i.length&&(i.mode=Ho);break;case 16205:if(0===h)break t;r[a++]=i.length,h--,i.mode=Ho;break;case qo:if(i.wrap){for(;u<32;){if(0===o)break t;o--,l|=s[n++]<<u,u+=8}if(d-=h,t.total_out+=d,i.total+=d,4&i.wrap&&d&&(t.adler=i.check=i.flags?Yn(i.check,r,d,a-d):Vn(i.check,r,d,a-d)),d=h,4&i.wrap&&(i.flags?l:Xo(l))!==i.check){t.msg="incorrect data check",i.mode=Vo;break}l=0,u=0}i.mode=16207;case 16207:if(i.wrap&&i.flags){for(;u<32;){if(0===o)break t;o--,l+=s[n++]<<u,u+=8}if(4&i.wrap&&l!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=Vo;break}l=0,u=0}i.mode=16208;case 16208:y=ko;break t;case Vo:y=Uo;break t;case 16210:return Ro;default:return Do}return t.next_out=a,t.avail_out=h,t.next_in=n,t.avail_in=o,i.hold=l,i.bits=u,(i.wsize||d!==t.avail_out&&i.mode<Vo&&(i.mode<qo||e!==Co))&&sh(t,t.output,t.next_out,d-t.avail_out),c-=t.avail_in,d-=t.avail_out,t.total_in+=c,t.total_out+=d,i.total+=d,4&i.wrap&&d&&(t.adler=i.check=i.flags?Yn(i.check,r,d,t.next_out-d):Vn(i.check,r,d,t.next_out-d)),t.data_type=i.bits+(i.last?64:0)+(i.mode===Go?128:0)+(i.mode===jo||i.mode===No?256:0),(0===c&&0===d||e===Co)&&y===Fo&&(y=Bo),y},nh={inflateReset:Zo,inflateReset2:Qo,inflateResetKeep:Ko,inflateInit:t=>$o(t,15),inflateInit2:$o,inflate:rh,inflateEnd:t=>{if(Wo(t))return Do;let e=t.state;return e.window&&(e.window=null),t.state=null,Fo},inflateGetHeader:(t,e)=>{if(Wo(t))return Do;const i=t.state;return 2&i.wrap?(i.head=e,e.done=!1,Fo):Do},inflateSetDictionary:(t,e)=>{const i=e.length;let s,r,n;return Wo(t)?Do:(s=t.state,0!==s.wrap&&s.mode!==zo?Do:s.mode===zo&&(r=1,r=Vn(r,e,i,0),r!==s.check)?Uo:(n=sh(t,e,i,i),n?(s.mode=16210,Ro):(s.havedict=1,Fo)))},inflateInfo:"pako inflate (from Nodeca project)"};var ah=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const oh=Object.prototype.toString,{Z_NO_FLUSH:hh,Z_FINISH:lh,Z_OK:uh,Z_STREAM_END:ch,Z_NEED_DICT:dh,Z_STREAM_ERROR:fh,Z_DATA_ERROR:gh,Z_MEM_ERROR:_h}=Kn;function bh(t){this.options=Za({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new so,this.strm.avail_out=0;let i=nh.inflateInit2(this.strm,e.windowBits);if(i!==uh)throw new Error(Wn[i]);if(this.header=new ah,nh.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=to(e.dictionary):"[object ArrayBuffer]"===oh.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(i=nh.inflateSetDictionary(this.strm,e.dictionary),i!==uh)))throw new Error(Wn[i])}function ph(t,e){const i=new bh(e);if(i.push(t),i.err)throw i.msg||Wn[i.err];return i.result}bh.prototype.push=function(t,e){const i=this.strm,s=this.options.chunkSize,r=this.options.dictionary;let n,a,o;if(this.ended)return!1;for(a=e===~~e?e:!0===e?lh:hh,"[object ArrayBuffer]"===oh.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),n=nh.inflate(i,a),n===dh&&r&&(n=nh.inflateSetDictionary(i,r),n===uh?n=nh.inflate(i,a):n===gh&&(n=dh));i.avail_in>0&&n===ch&&i.state.wrap>0&&0!==t[i.next_in];)nh.inflateReset(i),n=nh.inflate(i,a);switch(n){case fh:case gh:case dh:case _h:return this.onEnd(n),this.ended=!0,!1}if(o=i.avail_out,i.next_out&&(0===i.avail_out||n===ch))if("string"===this.options.to){let t=io(i.output,i.next_out),e=i.next_out-t,r=eo(i.output,t);i.next_out=e,i.avail_out=s-e,e&&i.output.set(i.output.subarray(t,t+e),0),this.onData(r)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(n!==uh||0!==o){if(n===ch)return n=nh.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},bh.prototype.onData=function(t){this.chunks.push(t)},bh.prototype.onEnd=function(t){t===uh&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Qa(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var mh={Inflate:bh,inflate:ph,inflateRaw:function(t,e){return(e=e||{}).raw=!0,ph(t,e)},ungzip:ph,constants:Kn};const{Deflate:xh,deflate:vh,deflateRaw:Th,gzip:wh}=po,{Inflate:yh,inflate:Eh,inflateRaw:Ah,ungzip:Ch}=mh;var Mh=Eh;class Sh{constructor(t){var e=this;e.m=t.getUint16(),e.a=t.getUint16(),e.i=t.getUint32(),e.d=t.getUint32(),e.b=t.getUint16(),e.j=t.getUint16(),e.c=t.getUint16(),e.h=Pe(t.getFloat(),t.getFloat(),t.getFloat()),e.e=Pe(t.getFloat(),t.getFloat(),t.getFloat()),e.f=t.getInt16(),e.k=t.getUint16(),t.getBool()&&(e.l=t.getString())}g(){}}class Fh{constructor(t){var e;if(this.p=t.getInt32(),this.r=t.getInt32(),this.e=Pe(t.getFloat(),t.getFloat(),t.getFloat()),(e=t.getInt32())>0){this.d=new Array(e);for(let i=0;i<e;++i)this.d[i]=t.getInt16()}if((e=t.getInt32())>0){this.j=new Array(e);for(let i=0;i<e;++i)this.j[i]=t.getInt16()}this.q=new wr(t,fr),this.n=new wr(t,_r),this.i=new wr(t,br),this.g=new wr(t,br),this.o=t.getFloat(),this.f=t.getFloat(),this.l=t.getFloat(),this.b=t.getInt16(),this.m=t.getInt16(),this.c=new wr(t,_r),this.k=new wr(t,pr),this.h=t.getInt16()}}class kh{constructor(t){this.a=t.getInt32(),this.b=t.getUint32(),this.c=t.getUint32()}}class Ih{constructor(t){this.m=t.getUint8(),this.b=t.getInt8(),this.e=t.getUint16(),this.k=t.getUint16(),this.d=t.getUint16(),this.j=t.getInt16(),this.i=t.getUint16(),this.l=t.getUint16(),this.g=t.getUint16(),this.f=t.getInt16(),this.c=t.getUint16(),this.h=t.getInt16(),this.a=t.getInt16()}}class Dh{constructor(t){this.i=t.getInt16(),this.e=t.getInt16(),this.j=Pe(t.getFloat(),t.getFloat(),t.getFloat()),this.g=new wr(t,fr),this.b=new wr(t,br),this.c=new wr(t,fr),this.h=new wr(t,br),this.f=new wr(t,br),this.d=new wr(t,br),this.a=new wr(t,pr)}}const Uh=class{constructor(t){var e=this;e.e=t.getInt16(),e.b=t.getFloat(),e.c=t.getFloat(),e.d=t.getUint16(),e.a=t.getUint32()}};const Rh=class{constructor(t){var e=this;e.d=t.getFloat(),e.c=t.getFloat(),e.a=t.getUint32(),e.b=t.getUint32()}};class Bh{constructor(t){if(this.I=[],this.G=[],this.N=[],this.x=[],this.l=[],this.B=[],this.h=[],this.S=[],this.e=[],this.L=[],this.w=[],this.F=[],this.z=[],this.s=[],this.d=[],this.J=[],this.Q=[],this.f=[],this.r=[],this.R=[],this.k=[],this.g=[],this.M=[],this.q=[],this.p=[],this.b=[],this.O=[],this.j=[],this.i=[],this.H=[],this.a=[],this.c=[],this.P=[],this.o=[],this.K=[],this.D=[],!t)return void console.error("Bad buffer for DataView");let e=new rn(t);if(604210112!=e.getUint32())return void console.log("Bad magic value");if(e.getUint32()<2e3)return void console.log("Bad version");this.E=e.getUint32();var i=e.getUint32(),s=e.getUint32(),r=e.getUint32(),n=e.getUint32(),a=e.getUint32(),o=e.getUint32(),h=e.getUint32(),l=e.getUint32(),u=e.getUint32(),c=e.getUint32(),d=e.getUint32(),f=e.getUint32(),g=e.getUint32(),_=e.getUint32(),b=e.getUint32(),p=e.getUint32(),m=e.getUint32(),x=e.getUint32(),v=e.getUint32(),T=e.getUint32(),w=e.getUint32(),y=e.getUint32(),E=e.getUint32(),A=e.getUint32(),C=e.getUint32(),M=e.getUint32(),S=e.getUint32(),F=e.getUint32(),k=e.getUint32(),I=e.getUint32(),D=e.getUint32(),U=e.getUint32(),R=e.getUint32(),B=e.getUint32(),O=e.getUint32(),P=e.getUint32();let z=new Uint8Array(t,e.position),G=null;try{G=Mh(z)}catch(t){return void console.log("Decompression error: "+t)}if(G.length<P)console.log("Unexpected data size",G.length,P);else{e=new rn(G.buffer),e.position=i;var L=e.getInt32();if(L>0){this.I=new Array(L);for(let t=0;t<L;++t)this.I[t]=new Yr(e)}e.position=s;var N=e.getInt32();if(N>0){this.G=new Array(N);for(let t=0;t<N;++t)this.G[t]=e.getUint16()}e.position=r;var j=e.getInt32();if(j>0){this.N=new Array(j);for(let t=0;t<j;++t)this.N[t]=e.getUint32()}e.position=n;var H=e.getInt32();if(H>0){this.x=new Array(H);for(let t=0;t<H;++t)this.x[t]=new Sh(e)}e.position=a;var q=e.getInt32();if(q>0){this.l=new Array(q);for(let t=0;t<q;++t)this.l[t]=e.getInt16()}e.position=o;var V=e.getInt32();if(V>0){this.B=new Array(V);for(let t=0;t<V;++t)this.B[t]=new sn(e)}e.position=h;var X=e.getInt32();if(X>0){this.h=new Array(X);for(let t=0;t<X;++t)this.h[t]=e.getInt16()}e.position=l;var Y=e.getInt32();if(Y>0){this.S=new Array(Y);for(let t=0;t<Y;++t)this.S[t]=e.getInt16()}e.position=u;var W=e.getInt32();if(W>0){this.e=new Array(W);for(let t=0;t<W;++t)this.e[t]=new Wr(e)}e.position=c;var K=e.getInt32();if(K>0){this.L=new Array(K);for(let t=0;t<K;++t)this.L[t]=new Ih(e)}e.position=d;var Z=e.getInt32();if(Z>0){this.w=new Array(Z);for(let t=0;t<Z;++t)this.w[t]=e.getInt16()}e.position=f;var Q=e.getInt32();if(Q>0){this.u=new Array(Q);for(let t=0;t<Q;++t)this.u[t]=new Kr(e)}e.position=g;var $=e.getInt32();if($>0){this.F=new Array($);for(let t=0;t<$;++t)this.F[t]=new kh(e)}e.position=_;var J=e.getInt32();if(J>0){this.z=new Array(J);for(let t=0;t<J;++t)this.z[t]=e.getInt16()}e.position=b;var tt=e.getInt32();if(tt>0){this.Q=new Array(tt);for(let t=0;t<tt;++t)this.Q[t]=new Zr(e)}e.position=p;var et=e.getInt32();if(et>0){this.f=new Array(et);for(let t=0;t<et;++t)this.f[t]=e.getInt16()}e.position=m,this.A=Pe(e.getFloat(),e.getFloat(),e.getFloat()),this.n=Pe(e.getFloat(),e.getFloat(),e.getFloat()),this.C=e.getFloat(),this.t=Pe(e.getFloat(),e.getFloat(),e.getFloat()),this.y=Pe(e.getFloat(),e.getFloat(),e.getFloat()),this.v=e.getFloat(),e.position=x;var it=e.getInt32();if(it>0){this.s=new Array(it);for(let t=0;t<it;++t)this.s[t]=e.getUint16()}e.position=v;var st=e.getInt32();if(st>0){this.d=new Array(st);for(let t=0;t<st;++t)this.d[t]=Pe(e.getFloat(),e.getFloat(),e.getFloat())}e.position=T;var rt=e.getInt32();if(rt>0){this.J=new Array(rt);for(let t=0;t<rt;++t)this.J[t]=Pe(e.getFloat(),e.getFloat(),e.getFloat())}e.position=w;var nt=e.getInt32();if(nt>0){this.r=new Array(nt);for(let t=0;t<nt;++t)this.r[t]=e.getInt16()}e.position=y;var at=e.getInt32();if(at>0){this.R=new Array(at);for(let t=0;t<at;++t)this.R[t]=new Qr(e)}e.position=E;var ot=e.getInt32();if(ot>0){this.k=new Array(ot);for(let t=0;t<ot;++t)this.k[t]=e.getInt16()}e.position=A;var ht=e.getInt32();if(ht>0){this.g=new Array(ht);for(let t=0;t<ht;++t)this.g[t]=new $r(e)}e.position=C;var lt=e.getInt32();if(lt>0){this.M=new Array(lt);for(let t=0;t<lt;++t)this.M[t]=new Jr(e)}e.position=M;var ut=e.getInt32();if(ut>0){this.q=new Array(ut);for(let t=0;t<ut;++t)this.q[t]=e.getInt16()}e.position=S;var ct=e.getInt32();if(ct>0){this.p=new Array(ct);for(let t=0;t<ct;++t)this.p[t]=new Dh(e)}e.position=F;var dt=e.getInt32();if(dt>0){this.b=new Array(dt);for(let t=0;t<dt;++t)this.b[t]=new en(e)}e.position=I;var ft=e.getInt32();if(ft>0){this.j=new Array(ft);for(let t=0;t<ft;++t)this.j[t]=new tn(e)}e.position=D;var gt=e.getInt32();if(gt>0){this.i=new Array(gt);for(let t=0;t<ft;++t)this.i[t]=e.getInt16()}e.position=U;var _t=e.getInt32();if(_t>0){this.H=new Array(_t);for(let t=0;t<_t;++t)this.H[t]=new Uh(e)}e.position=O;var bt=e.getInt32();if(bt>0){this.D=new Array(bt);for(let t=0;t<bt;++t)this.D[t]=new Rh(e)}if(R>0){e.position=R;if(e.getUint32()){const t=e.position,i=e.getInt32(),s=e.getUint32(),r=e.getInt32(),n=e.getUint32(),a=e.getInt32(),o=e.getUint32(),h=e.getInt32(),l=e.getUint32();let u=e.position;e.position=t+s;for(let t=0;t<i;t++)this.a.push(Pe(e.getFloat(),e.getFloat(),e.getFloat()));e.position=t+n;for(let t=0;t<r;t++)this.c.push(Pe(e.getFloat(),e.getFloat(),e.getFloat()));e.position=t+o;for(let t=0;t<a;t++)this.P.push(e.getUint16());e.position=t+l;for(let t=0;t<h;t++)this.o.push(e.getUint16());e.position=u}}if(B>0){e.position=B;if(e.getUint32()){this.m=Pe(e.getFloat(),e.getFloat(),e.getFloat()),this.K=[];for(let t=0;t<5;t++)this.K.push(e.getInt32())}}e.position=k;var pt=e.getInt32();if(pt>0){this.O=new Array(pt);for(let t=0;t<pt;++t)this.O[t]=new Fh(e)}}}}const Oh=class{constructor(t){this.i=t,this.F=new Float32Array([1,1,1,1]),this.E=!1,this.q=!0,this.s=null,this.C=null,this.g=0,this.x=null,this.w=[],this.a=[],this.c=new Array,this.A=null,this.B=[],this.b=t.e,this.D=t.g,this.m=!1,this.h=!1,this.j=!1,this.l=Vi(),this.z=Be(),this.n=$s()}k(t){this.s=t;const e=t.k,i=this.i;this.C=e.e[this.i.k],this.g=this.C.d,Kr.c(this);let s=e.z[i.f];1==i.g&&s>-1&&1==e.F[s].a&&(this.b=-1e3,this.D=3);for(let s=0;s<this.D;s++){if(i.f>-1&&i.f<e.z.length){let r=e.z[i.f+s];r>-1&&r<e.F.length&&this.w.splice(s,0,t.T[r])}if(i.a>-1&&i.a<e.f.length){let t=e.f[i.a+s];t>-1&&e.Q&&t<e.Q.length?(this.a.splice(s,0,e.Q[t]),console.log("TextureAnim found for batch:",this.i.f,"animIdx:",t)):this.a.splice(s,0,null)}if(i.h>-1&&i.h<e.q.length){let t=e.q[i.h+s];t>-1&&t<e.M.length?this.B.splice(s,0,e.M[t]):this.B.splice(s,0,null)}}this.c=new Array(this.a.length);for(let t=0;t<this.c.length;t++)this.c[t]=ri();e.g&&i.j>-1&&i.j<e.g.length&&(this.A=e.g[i.j])}f(){this.s.k;let t=Xi(this.C.h[0],this.C.h[1],this.C.h[2],1),e=this.s.O[this.C.c].j,i=ri();ui(i,i,this.s.Q.viewMatrix),ui(i,i,this.s.au),ui(i,i,e),ts(t,t,i),t[3]=0;let s=es(t);if((3&this.i.m)>0){let e=Vi();s>0?Qi(e,t,1/s):Yi(e,t),Qi(e,e,Oe(Pe(i[8],i[9],i[10]))*this.C.g),1&this.i.m?Zi(e,t,e):Ki(e,t,e),s=$i(e)}return s}t(){this.s,this.s.Q.context;const t=this.s.m;if(this.l[0]=this.l[1]=this.l[2]=this.l[3]=1,this.A&&this.A.b(t,this.s.g,this.l),this.B[0]&&(this.l[3]*=this.B[0].d(t,this.s.g)),this.l[3]*=this.s.o[3],!(this.l[3]<=.001)){for(let e=0;e<this.B.length;e++){const i=this.B[e];i&&(this.F[e]=i.d(t,this.s.g))}if(!this.E||this.s.aB){const t=this.o();let e=!0;for(const i of t){const t=i.l;e=e&&null!=t}if(this.E=e,!e)return;this.y=this.v(!1,!1),this.d=this.v(!0,!1),this.e=this.v(!1,!0)}if(this.a.forEach((e,i)=>{if(!this.s.af&&(oi(this.c[i]),this.a[i])){let e=!1,s=!1;this.a[i].c&&this.a[i].c.b(t.c.e)?(this.z=this.a[i].c.e(t,this.s.g),s=!0):Ge(this.z,0,0,0),this.a[i].a&&this.a[i].a.b(t.c.e)?(this.n=this.a[i].a.e(t,this.s.g),e=!0):hr(this.n,0,0,0,1);let r,n=!1;if(this.a[i].d&&this.a[i].d.b(t.c.e)&&(r=this.a[i].d.e(t,this.s.g),n=!0),oi(this.c[i]),ci(this.c[i],this.c[i],Pe(.5,.5,0)),n&&di(this.c[i],this.c[i],r),e){let t=ri();_i(t,this.n,[0,0,0]),ui(this.c[i],this.c[i],t)}s&&ci(this.c[i],this.c[i],this.z),ci(this.c[i],this.c[i],Pe(-.5,-.5,0))}}),this.E){(this.l[3]<1?this.d:this.y).d=this.f()}}}r(t,e){if(!this.y)return;const i=this.s.ax.g();if(e)i.d(this.e);else{const e=this.y.b.a()<=vs.GxBlend_AlphaKey,s=null!=this.s.gradientEffect,r=this.l[3]<1;t&&e&&(r||s)?(i.d(this.e),i.d(this.d)):(!t&&e||t&&!e)&&i.d(this.y)}}v(t,e){const i=this,s=t&&i.x.a<2?vs.GxBlend_Alpha:i.x.a,r=[0,1,2,10,3,4,5,13],n=r[s],a=this.s.ax,o=this.s,h=Object.assign(Object.assign({},this.s.aN),this.s.aO);for(let t=0;t<this.a.length;t++)h["uTextureMatrix"+(t+1).toString()]=this.c[t];h.uColor=this.l,h.uTexSampleAlpha=this.F,h.uBlendMode=n,h.uHasSpecEmiss=!!o.X[0]&&!!o.X[2],h.uHasEmissiveGlowing=o.N,h.uUnlit=this.m?1:0,this.s.gradientEffect&&(h.u_mulLum_OpaqMat=[0,1,0,0]);let l=!this.s.l;const u=a.e(this.s.U,new Dr(i.h,l,r[s],!0,!i.j,e?0:15),new Ii(this.b,i.o(),h,null!=this.s.gradientEffect&&s<=2));return a.b(new Ur(o.p,2*i.C.a,i.C.k),u,this.i.l,this.i.b)}u(){return this.w}o(){const t=[],e=this.s;return this.w.forEach((i,s)=>{let r=null;i&&(-1e3==this.b?e.X?(r=e.X[s],r||(r={l:null,h:!1})):r={l:null,h:!1}:r=0==i.c.a?i.e:i.c.a>0&&this.s.y[i.c.a]?this.s.y[i.c.a]:{l:null,h:!1},r||(this.w[s].a||(WH.debug("can't find texture for material",s,"type",this.w[s].type,"index",this.w[s].d),this.w[s].a=!0),r={l:this.s.Q.greenPixelTexture})),t[s]=r}),t}get show(){return this.q}set show(t){this.q=t}get meshId(){return this.g}p(){this.s=null,this.C=null,this.x=null,this.w=null,this.a=null,this.A=null,this.B=null,this.l=null,this.c=null,this.z=null,this.n=null}};class Ph{constructor(t,e){this.c=e,this.d=t,this.e=null,this.a=!1}b(){this.e&&this.e.j(),this.e=null}f(t){0!=this.c.c&&(this.e||(this.e=t.getTexture(this.c.c)))}get type(){return this.c.a}}const zh=function(t,e){const i=Math.abs(t),s=Math.abs(e);return Number((i-Math.floor(i/s)*s).toPrecision(8))*Math.sign(t)},Gh="DressingRoom",Lh="Stand";class Nh{constructor(){this.a=null,this.d=-1,this.c=ri(),this.b=1}}class jh{constructor(t,e,i){this.Q=t,this.ax=e,this.aG=i,this.f=!1,this.g=[],this.l=!1,this.G=!0,this.aL=!0,this.af=!1,this.ak=!1,this.m=new cr,this.u=null,this.v=0,this.C=null,this.d=null,this.y={},this.X=[],this.N=!1,this.aB=!1,this.ay=1,this.H=Be(),this.aw=Be(),this.z=null,this.D=null,this.S=new Set,this.p=null,this.au=ri(),this.a=ri(),this.aP=ri(),this.j=ri(),this.o=Xi(1,1,1,1),this.as=null,this.aO={},this.aQ=-1,this.R=!1,this.ab=ri(),this.A=Be(),this.ao=Be(),this.ac=Vi(),this.aj=Vi(),this.L=!1,this.n=!1,this.E=null,this.at=[],this.m.f=0,this.m.c.e=-1,this.aa(i)}aM(t){this.at.push(t)}aa(t){const e=this.Q.options.contentPath+"mo3/"+t+".mo3";$.ajax({url:e,type:"GET",dataType:"binary",responseType:"arraybuffer",processData:!1,renderer:this.Q,success:t=>{this.aA(t)},error:function(t,e,i){console.log(i)}})}aA(t){this.k=new Bh(t),this.ag()}Z(t){this.ay=t}ag(){const t=this.k,e=t.F.length,i=t.B.length,s=t.N.length,r=t.b.length,n=t.O.length;this.g=new Array(s);for(let t=0;t<s;++t)this.g[t]=0;if(i>0){this.O=new Array(i);for(let e=0;e<i;e++)this.O[e]=new Ar(this,e,t.B[e]);this.ai=new Array(i);for(let e=0;e<i;e++){this.ai[e]=[];for(let s=0;s<i;s++)t.B[s].e==e&&this.ai[e].push(s)}}this.T=new Array;for(let i=0;i<e;i++)this.T[i]=new Ph(i,t.F[i]),this.T[i].f(this.Q);this.am=new Array(r);for(let e=0;e<r;e++)this.am[e]=new Nr(this,t.b[e]),t.j&&t.j.length&&e<t.j.length&&this.am[e].as(t.j[e]);this.w=new Array(n);for(let e=0;e<n;e++)this.w[e]=new Xr(this,t.O[e]);if(this.u&&this.aI(this.u),t.L){const e=t.L.length;this.h=new Array(e);for(let i=0;i<e;++i)this.h[i]=new Oh(t.L[i]),this.h[i].k(this);this.r=this.h.concat()}this.k.I&&t.G&&(this.z=this.ax.o(t.I),this.D=this.ax.n(t.G.length),this.p=this.ax.h(this.z,this.D),this.D.d(new Uint16Array(t.G))),this.U=this.ax.l(t.B.length,t.g.length,t.M.length,t.Q.length),this.aN={uInvTranspViewModelMat:this.j,uModelMatrix:this.au,uDiffuseColor:this.o},this.al("Stand");for(let t of this.at)t();if(this.at=[],Ge(this.ao,this.ay,this.ay,this.ay),oi(this.au),this.L&&gi(this.au,this.au,Math.PI/2),this.n){let t=Be();oi(ri()),Ge(t,1,-1,1),di(this.au,this.au,t)}di(this.au,this.au,this.ao),this.Q.doUpdateBounds=!0,this.f=!0}K(){this.L=!0}aC(){this.n=!0}V(t){const e=this.k;return e&&e.x&&t>-1&&t<e.x.length?e.x[t].l:t==e.x.length?Gh:""}aD(){this.al(Lh)}get isMirrored(){return this.t}set isMirrored(t){this.aB=this.t!=t,this.t=t}ap(t,e,i,s=1){null!=t||null!=i?(this.E||(this.E=new Nh),this.E.a=t,this.E.d=e,i?ni(this.E.c,i):oi(this.E.c),this.E.b=s,this.Q.doUpdateBounds=!0):this.E=null}ad(){this.Q.context;this.k.I&&this.k.G&&this.aQ!=this.Q.currFrame&&(this.z&&this.z.dc(this.O,this.S),this.U.b(this.O),this.aQ=this.Q.currFrame)}i(t,e,i){const s=[Pe(t[0],t[1],t[2]),Pe(t[0],t[1],e[2]),Pe(t[0],e[1],t[2]),Pe(t[0],e[1],e[2]),Pe(e[0],t[1],t[2]),Pe(e[0],t[1],e[2]),Pe(e[0],e[1],t[2]),Pe(e[0],e[1],e[2])].map(t=>{const e=Be();return Je(e,t,i),e}),r=Pe(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=Pe(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);return s.forEach(t=>{He(r,r,t),qe(n,n,t)}),[r,n]}aH(){var t,e,i,s,r,n;if(!this.h)return null;let a=this.H,o=this.aw;return Ge(a,9999,9999,999),Ge(o,-9999,-9999,-9999),He(a,a,null===(i=null===(e=null===(t=this.m)||void 0===t?void 0:t.c)||void 0===e?void 0:e.c)||void 0===i?void 0:i.h),qe(o,o,null===(n=null===(r=null===(s=this.m)||void 0===s?void 0:s.c)||void 0===r?void 0:r.c)||void 0===n?void 0:n.e),this.i(a,o,this.au)}aJ(){const t=this.k;if(!this.f)return;if(this.E){Ge(this.ao,this.ay,this.ay,this.ay);const t=this.E.a,s=this.E;if(!t.f)return;Ve(this.ao,this.ao,s.b),e=this.au,i=this.ao,e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,ui(this.au,s.c,this.au),s.d>=0&&s.d<t.O.length&&ui(this.au,t.O[s.d].j,this.au),ui(this.au,t.au,this.au)}var e,i;ui(this.a,this.Q.viewMatrix,this.au),li(this.aP,this.a),hi(this.j,this.aP),this.gradientEffect&&this.c();let s=1e3*this.Q.delta;if(!this.af&&this.m.c.e>-1){let e=s;for(let i=0;i<this.g.length;i++)this.g[i]+=e,t.N[i]>0&&(this.g[i]%=t.N[i]);this.q(this.m,e)}let r=this.h?this.h.length:0;this.S.clear();for(let t=0;t<r;++t){let e=this.h[t];if(!e.show)continue;let i=e.C.k,s=e.C.a;for(let t=0;t<i;++t)this.S.add(this.k.G[s+t])}let n=t.B.length;if(this.O){for(let t=0;t<n;++t)this.O[t].i=!1;for(let t=0;t<n;++t)this.O[t].t(s);this.ad()}if(this.h&&this.h.forEach(t=>t.t()),this.r&&this.r.sort(function(t,e){return t.i.b!=e.i.b?t.i.b-e.i.b:t.meshId-e.meshId}),this.aB=!1,this.am&&this.G)for(let t=0;t<this.am.length;++t)this.am[t].D(this.m,this.Q.delta);if(this.w&&this.aL)for(let t=0;t<this.w.length;++t)this.w[t].Y(this.m,this.Q.delta),this.w[t].r()}ae(t,e){this.y[t]=e,this.aB=!0}F(t,e,i){this.X=[t,e,i],this.aB=!0}x(t){this.N=t}B(t){this.ak=!!t}an(t){this.G=!!t}ar(t){this.aL=!!t}e(t,e){const i=this;if(!i.f)return;let s=100*e,r=s+As[e]+t,n=i.h.some(t=>t.meshId==r);r=n?r:100*e+1,i.aK(s,s+99,!1),i.aK(r,r,!0)}aK(t,e,i){const s=this.k;if(!this.h||0==this.h.length)return!1;for(let s=0;s<this.h.length;++s){const r=this.h[s];r.meshId>=t&&r.meshId<=e&&(r.show=i)}if(s.i&&s.i.length>0)for(let r=0;r<s.i.length;++r){let n=s.i[r];n>=t&&n<=e&&(this.am[r].aj=i)}return!0}Y(t,e){if(!this.h)return;const i=e+1;let s=t>0?e+t:-2==t?e+0:i,r=this.h.some(t=>t.meshId==s);s=r||-2==t?s:i,this.aK(s,s,!0)}I(t){this.af=t}aq(t){this.k.x&&(this.av(t,this.m),this.m.a=!1,this.m.c.b=!1,this.m.c.a=0)}q(t,e){const i=this.k;if(t.c.a+=e,t.e.e<0&&!this.ak&&!t.a)if(t.c.c.f>-1){let e=32767*Math.random(),s=0,r=t.c.e,n=i.x[r];for(s+=n.b;s<e&&n.f>-1;)r=n.f,n=i.x[r],s+=n.b;t.e.e=r,t.e.c=i.x[r],t.e.a=0}else{let e=i.x.find(e=>e.m==t.c.c.m&&0==e.a);e&&(t.e.e=e.k,t.e.c=e,t.e.a=0)}let s=t.c,r=t.e,n=s.c.i-s.a,a=0,o=null;if(r.e>-1&&(o=i.x[r.e],a=o.j),a>0&&n<a?(r.a=zh(a-n,o.i),t.f=n/a):t.f=1,t.d>0){let i=e/1e3;t.b.a+=e,t.d-=i/this.Q.crossFadeDuration}if(s.a>=s.c.i)if(r.e>-1&&!s.b){if(r.e>-1)for(;!(32&i.x[r.e].d)&&(64&i.x[r.e].d)>0&&(r.e=i.x[r.e].k,r.c=i.x[r.e],!(r.e<0)););t.c=r,t.e=new ur,t.f=1}else s.c.i>0&&(s.a=zh(s.a,s.c.i))}al(t,e=!0){this.av(t,this.m,e)}av(t,e,i=!0){const s=this.k;let r=!1,n=!1;const a=t==Gh;a&&(t=Lh,this.B(!0));for(let o=0;o<s.x.length;++o){const h=s.x[o];if(h.l&&(h.l==t&&0==h.a)){r=!0,i&&null!=e.c&&(null!=e.b&&(e.d=1),e.b=new ur,e.b.e=e.c.e,e.b.c=e.c.c,e.b.a=e.c.a),n=e.c.e!=o,e.c.e=o,e.c.c=h,e.c.a=0,e.e=new ur,e.f=0,e.a=a,WH.debug("Set animation to",h.m,h.l);break}}return t==Lh||r?n:this.av(Lh,e)}W(t){this.R=t}aF(t){const e=this.k;let i=null;if(!e.k||!e.k.length)return null;if(t<e.k.length)i=e.R[e.k[t]];else for(let t=0;t<e.k.length;t++){const s=e.k[t];if(-1!=s){i=e.R[s];break}}return i}get gradientEffect(){return this.as}set gradientEffect(t){this.aB=!0,this.as=t,this.s()}J(t){if(this.E){const t=this.E.a;if(t&&!t.f)return}if(this.z&&this.r)if(this.gradientEffect){if(t)for(let t=0;t<this.r.length;++t)this.r[t].show&&this.r[t].r(!1,!0);for(let e=0;e<this.r.length;++e)this.r[e].show&&this.r[e].r(t,!1)}else for(let e=0;e<this.r.length;++e)this.r[e].show&&this.r[e].r(t,!1);if(this.am&&this.G)for(let e=0;e<this.am.length;++e)this.am[e].Z(t);if(this.w&&this.aL)for(let e=0;e<this.w.length;++e)this.w[e].h(t)}P(t){if(this.v==t)return;if(this.f)for(let t=0;t<this.O.length;t++)this.O[t].z=null;if(this.v=t,t<=0)return;let e=this.Q.options.contentPath+"bone/"+t+".bone",i=this;$.ajax({url:e,type:"GET",dataType:"binary",responseType:"arraybuffer",processData:!1,renderer:this.Q,success:function(t){i.az(t)},error:function(t,e,i){console.log(i)}})}az(t){let e=new rn(t);e.getInt32();for(;e.position<e.buffer.byteLength;){let t=String.fromCharCode(e.getUint8(),e.getUint8(),e.getUint8(),e.getUint8()),i=e.getUint32();if("BIDA"==t){let t=i/2;this.C=new Array(t);for(let i=0;i<t;i++)this.C[i]=e.getUint16()}if("BOMT"==t){let t=i/64;this.d=new Array(t);for(let i=0;i<t;i++){let t=ai(e.getFloat(),e.getFloat(),e.getFloat(),e.getFloat(),e.getFloat(),e.getFloat(),e.getFloat(),e.getFloat(),e.getFloat(),e.getFloat(),e.getFloat(),e.getFloat(),e.getFloat(),e.getFloat(),e.getFloat(),e.getFloat());this.d[i]=t}}}this.f&&this.M()}M(){if(!(this.v<=0)&&this.C&&this.C.length)for(let t=0;t<this.C.length;t++)this.O[this.C[t]].z=this.d[t]}s(){if(!this.gradientEffect)return;const t=this.gradientEffect,e=this.aO;e.u_gradGradientColors_0=[...t.Colors0,0],e.u_gradGradientColors_1=[...t.Colors1,0],e.u_gradGradientColors_2=[...t.Colors2,t.Alpha[0]],e.u_gradEdgeColor=[...t.EdgeColor,t.Alpha[1]],e.u_gradBoundingBox=[this.ac[0],this.ac[1],this.ac[2],1/(this.aw[2]-this.H[2])],e.u_gradUpVec=[this.ao[0],this.ao[1],this.ao[2],0],e.u_gradFlags=[(1&t.gradFlags)>0?1:0,.7,(4&t.gradFlags)>0?1:0,(8&t.gradFlags)>0?1:0]}c(){if(!this.gradientEffect)return;this.gradientEffect;const t=this.aO;Wi(this.ac,this.H[2],this.H[2],this.H[2],1),ts(this.ac,this.ac,this.a),Wi(this.aj,0,0,1,0),ts(this.aj,this.aj,this.j),Ge(this.ao,this.aj[0],this.aj[1],this.aj[2]),Ke(this.ao,this.ao),t.u_gradBoundingBox[0]=this.ac[0],t.u_gradBoundingBox[1]=this.ac[1],t.u_gradBoundingBox[2]=this.ac[2],t.u_gradBoundingBox[3]=1/(this.aw[2]-this.H[2]),t.u_gradUpVec[0]=this.ao[0],t.u_gradUpVec[1]=this.ao[1],t.u_gradUpVec[2]=this.ao[2]}b(t){let e=Ks();if(Zs(e,t),this.am)for(let i=0;i<this.am.length;i++)this.am[i].al(t,e);if(this.w)for(let e=0;e<this.w.length;e++)this.w[e].aa(t)}ah(){return this.E}aI(t){if(this.am)for(let e=0;e<this.am.length;e++)this.am[e].g(t);this.u=t}}class Hh{static c(t,e,i){const s=Rs[e];if(s){const e=i?4:0;return s.slice(2*t+e,2*t+e+2)}}static b(t,e,i,s){let r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];if(!t)return WH.debug("selectBestTexture:","textures are null"),null;for(let n=0;n<t.length;n++){let a=t[n],o=a.Gender,h=a.Class,l=a.Race,u=a.ExtraData,c=0;if(e>1||o!=e){if(o<2)continue;c=0}else c=2;let d=1;if(i>0&&h==i)d=0;else if(h>0)continue;let f=1;if(s>0&&l==s)f=0;else if(l>0)continue;r[u+3*(f+2*(c+d))]=a.FileDataId}for(let t=0;t<2;t++)for(let e=0;e<2;e++)for(let i=0;i<2;i++){let s=3*(t+2*(e+2*i));if(r[s]>0){let t;return t={b:r[s],c:r[s+1],a:r[s+2]},t}}const n=Hh.c(e,s,!0);return n&&0!=n[0]?(s=n[0],e=n[1],Hh.b(t,e,i,s)):null}static a(t,e,i,s,r){let n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(let a=0;a<t.length;a++){let o=t[a],h=o.Gender,l=o.Class,u=o.Race,c=o.ExtraData,d=0;if(i>1||h!=i){if(h<2)continue;d=0}else d=2;let f=1;if(s>0&&l==s)f=0;else if(l>0)continue;let g=1;if(r>0&&u==r)g=0;else if(u>0)continue;let _=1;if(-1==e||c!=e){if(-1!=c&&-1!=e)continue}else _=0;n[_+2*(g+2*(d+f))]=o.FileDataId}for(let t=0;t<2;t++)for(let e=0;e<2;e++)for(let i=0;i<2;i++)for(let s=0;s<2;s++){let r=s+2*(t+2*(e+2*i));if(n[r])return n[r]}const a=Hh.c(i,r,!1);return a&&0!=a[0]?(r=a[0],i=a[1],Hh.a(t,e,i,s,r)):0}}class qh{constructor(){this.f=!1,this.a=[]}get loaded(){let t=!!this.c&&this.c.f;if(t&&this.a.length>0){for(let t of this.a)t();this.a=[]}return t}isLoaded(){return this.loaded}h(t){this.a.push(t)}d(){return this.c}g(t){t.c(this.c,this.f)}getNumAnimations(){var t;return(null===(t=this.c)||void 0===t?void 0:t.f)?0==this.c.k.x.length?0:this.c.k.x.length+1:0}getAnimation(t){var e;return(null===(e=this.c)||void 0===e?void 0:e.f)?this.c.V(t):""}resetAnimation(){var t;if(null===(t=this.c)||void 0===t?void 0:t.f)return this.c.aD()}setAnimPaused(t){var e;if(null===(e=this.c)||void 0===e?void 0:e.f)return this.c.I(t)}setTPose(t){var e;if(null===(e=this.c)||void 0===e?void 0:e.f)return this.c.W(t)}setAnimation(t,e){var i;(null===(i=this.c)||void 0===i?void 0:i.f)&&this.c.al(t,!!e)}setParticlesEnabled(t){var e;(null===(e=this.c)||void 0===e?void 0:e.f)&&this.c.an(t)}setRibbonsEnabled(t){var e;(null===(e=this.c)||void 0===e?void 0:e.f)&&this.c.ar(t)}getTexUnits(){var t;return(null===(t=this.c)||void 0===t?void 0:t.f)?this.c.h:null}setAnimNoSubAnim(t){this.c&&this.c.B(t)}attachList(t){}setItems(t){}clearSlots(t){}setSheath(t,e){}setAppearance(t){}setShouldersOverride(t){}setCustomizationsLoadedCallback(t){}setModelLoadedCallback(t){throw new Error("Method not implemented.")}setAnimationOverride(t,e){throw new Error("Method not implemented.")}resetAnimationOverride(t){throw new Error("Method not implemented.")}getAnimationDuration(t){throw new Error("Method not implemented.")}getModelBounds(){throw new Error("Method not implemented.")}isRenderReady(){throw new Error("Method not implemented.")}}class Vh extends qh{constructor(t,e,i,s,r,n){super(),this.fe=t,this.k=e,this.j=i,this.hg=s,this.l=r,this.f=n}get fileDataId(){return this.c?this.c.aG:0}get modelInstance(){return this.c}dc(){256&this.k.Item.Flags&&(this.winding=!0,this.isMirrored=!0,this.c.aC())}m(t,e,i){this.c&&this.c.ap(t,e,i)}i(t,e){this.c&&this.c.e(t,e)}ba(t,e,i){this.c&&this.c.aK(t,e,i)}setParticlesEnabled(t){this.c&&this.c.an(t)}get winding(){return!!this.c&&this.c.l}set winding(t){this.c&&(this.c.l=t)}get isMirrored(){return!!this.c&&this.c.isMirrored}set isMirrored(t){this.c&&(this.c.isMirrored=t)}getBounds(){return this.modelInstance.f?this.modelInstance.aH():[null,null]}b(){this.c&&this.c.aJ()}e(t){this.c&&this.c.J(t)}}class Xh extends Vh{constructor(t,e,i,s){if(super(t,null,0,0,0,s),this.c=new jh(t,t.renderer,e),i)for(let e in i)0!=i[e]&&this.c.ae(+e,t.getTexture(i[e]))}}class Yh{constructor(){this.a=!1}}const Wh=class{constructor(t,e){this.c=t,this.k=[],this.l=!1,this.e=!1,this.h=e}a(t){for(let e=0;e<this.h.length;e++)this.k[e]&&this.k[e].b&&this.k[e].b.loaded&&this.k[e].b.d().al(t)}b(t){this.l=t}n(){if(this.c.loaded)for(let t=0;t<this.h.length;t++)switch(this.h[t].EffectType){case 1:this.j(t);break;case 2:this.f(t);break;case 6:case 7:case 11:case 12:case 13:break;case 16:this.d(t)}}j(t){let e=this.c.d();if(1==this.h[t].ProcEffectType){let i=this.h[t].Value[0];e.o=Xi((i>>16&255)/255,(i>>8&255)/255,(255&i)/255,e.o[3])}else if(14==this.h[t].ProcEffectType){let i=Math.min(Math.max(this.h[t].Value[0],0),1);e.o[3]=i}else if(22==this.h[t].ProcEffectType){let i=this.h[t].Value[3];e.o=Xi((i>>16&255)/255,(i>>8&255)/255,(255&i)/255,e.o[3])}}f(t){if(!this.c)return;if(!this.c.loaded)return;let e=this.c.d();if(!this.k[t]){const i=new Yh;if(this.k[t]=i,0==this.h[t].ModelType){const s=new Xh(e.Q,this.h[t].Model,{2:this.h[t].Texture},!1);i.b=s}else 1==this.h[t].ModelType||2==this.h[t].ModelType&&fl.b(e.Q,Ms.NPC,this.h[t].Model).then(t=>{i.b=t})}const i=this.k[t];if(!i.a){if(!i.b&&!i.c)return;if(i.b&&!i.b.loaded)return;if(i.c&&!i.c.v)return;let b=this.h[t].AttachmentID;this.h[t].Positioner>-1&&(b=this.h[t].Positioner),b<0&&(b=19);let p=e.aF(b);const m=p?p.d:-1;let x=ri();if(p){let t=p.a;ci(x,x,Pe(t[0],t[1],t[2]))}if(ci(x,x,Pe(this.h[t].Offset[0],-this.h[t].Offset[1],this.h[t].Offset[2])),gi(x,x,-this.h[t].Yaw),s=x,r=x,n=this.h[t].Pitch,a=Math.sin(n),o=Math.cos(n),h=r[0],l=r[1],u=r[2],c=r[3],d=r[8],f=r[9],g=r[10],_=r[11],r!==s&&(s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=h*o-d*a,s[1]=l*o-f*a,s[2]=u*o-g*a,s[3]=c*o-_*a,s[8]=h*a+d*o,s[9]=l*a+f*o,s[10]=u*a+g*o,s[11]=c*a+_*o,fi(x,x,this.h[t].Roll),di(x,x,[this.h[t].Scale1,this.h[t].Scale1,this.h[t].Scale1]),di(x,x,[this.h[t].Scale2,this.h[t].Scale2,this.h[t].Scale2]),i.b){const e=i.b.d();e.I(this.l),this.h[t].ModelAlpha&&(e.o[3]=this.h[t].ModelAlpha),e.ap(this.c.d(),m,x)}this.k[t].a=!0}var s,r,n,a,o,h,l,u,c,d,f,g,_;this.k[t].b&&this.k[t].b.b(),this.k[t].c&&this.k[t].c.I()}d(t){const e=this.c.d();e.gradientEffect||(e.gradientEffect=this.h[t])}i(t){for(const e of this.k)e&&e.a&&(e.b&&e.b.e(t),e.c&&e.c.s(t))}m(){for(const t of this.k)t&&(t.a=!1,t.b&&t.b.loaded&&t.b.d().ap(null,-1,null),t.c&&t.c&&t.c.d())}g(t){this.k.forEach(e=>{e.b&&e.b.g(t),e.c&&e.c.o(t)})}};class Kh extends qh{constructor(t,e){super(),this.v=t,this.t=e,this.n=!1,this.x=!1,this.s=!1,this.z=-1,this.o=-1,this.hg=[],this.dc={},this.B=[],this.k=!1,this.y=null,this.fe=0,this.u(e)}u(t){if(this.k)return;this.v.options;if(t.StateKit&&this.B.push(new Wh(this,t.StateKit.effects)),t.Creature&&(this.y=t.Creature.CreatureGeosetData,this.fe=t.Creature.CreatureGeosetDataID),t.Model&&(this.c=new jh(this.v,this.v.renderer,t.Model),this.c.K(),t.Creature&&t.Creature.ParticleColor&&this.c.aI(t.Creature.ParticleColor),t.Scale&&this.c.Z(t.Scale)),this.t.Creature&&this.t.Creature.Texture&&(this.r=this.ba(-1,Hh.b(this.t.TextureFiles[this.t.Creature.Texture],3,0,0)),this.c.F(this.r.c,this.r.a,this.r.b)),t.Textures)for(let e in t.Textures)0!=t.Textures[e]&&this.c.ae(+e,this.v.getTexture(t.Textures[e]));this.s=!0,this.q()}ba(t,e){let i=new Gs;return e.b>0&&(i.c=this.v.getTexture(e.b)),e.c>0&&(i.a=this.v.getTexture(e.c)),e.a>0&&(i.b=this.v.getTexture(e.a)),i}q(){this.k||(this.s=!0,this.r||(this.x=!0))}m(t){this.C=null,t<=0||(this.n=!1,fl.b(this.v,Ms.NPC,t).then(t=>{t instanceof Kh&&(this.C=t)}))}A(){this.c,this.C}setAnimation(t,e=!0){this.C&&(this.C.setAnimation(t),t="Mount"),this.c?this.c.al(t,e):this.h(()=>{var i;null===(i=this.c)||void 0===i||i.al(t,e)})}p(){const t=this.c;if(t.aK(0,0,!0),0!=this.fe&&(t.aK(1,1699,!1),this.y))for(let e of this.y){let i=100*(e.GeosetIndex+1),s=i+e.GeosetValue;t.aK(i,i+99,!1),t.aK(s,s,!0)}}w(){this.p()}j(){const t=this.c;t.f&&this.s&&t.h&&0!=t.h.length&&(this.w(),this.s=!1)}setParticlesEnabled(t){this.c&&this.c.an(t)}getBounds(){if(this.c&&this.c.f){const[t,e]=this.c.aH();if(this.C&&this.C.loaded&&this.n){const[i,s]=this.C.getBounds();qe(i,i,Pe(0,0,0)),He(t,t,i),qe(e,e,s)}return[t,e]}return[null,null]}b(){if(!this.k&&this.loaded){if(!this.n&&this.c&&this.C&&this.C.loaded){const t=this.C.c.k,e=t.R[t.k[0]],i=ri();ci(i,i,e.a),this.c.ap(this.C.c,e.d,i,1/this.C.c.ay),this.c.al("Mount",!1),this.n=!0}this.i&&this.i.b(),this.C&&this.C.b(),this.B&&this.B.forEach(t=>t.n()),this.j(),this.c.aJ()}}e(t){this.c.J(t),this.C&&this.C.e(t),this.B&&this.B.forEach(e=>e.i(t))}g(t){super.g(t),this.C&&this.C.g(t),this.i&&this.i.g(t),this.B&&this.B.forEach(e=>e.g(t))}}function Zh(t){return new Promise((e,i)=>{$.getJSON(t).done(function(t){e(t)}).fail(function(t,e,s){let r=e+", "+s;console.log("Error loading metadata: "+r),i(e)})})}function Qh(t,e,i){let s;return e==Ms.HELM?$h(t,1,i):e==Ms.SHOULDER?$h(t,3,i):e==Ms.ITEM?$h(t,-1,i):(e==Ms.NPC||e==Ms.HUMANOIDNPC?s="meta/npc/":e==Ms.OBJECT?s="meta/object/":e==Ms.CHARACTER?s="meta/character/":e==Ms.ITEMVISUAL&&(s="meta/itemvisual/"),Zh(t+s+i+".json"))}function $h(t,e,i){let s="meta/item/";return 1!=e&&3!=e&&4!=e&&5!=e&&6!=e&&7!=e&&8!=e&&9!=e&&10!=e&&16!=e&&19!=e&&20!=e||(s="meta/armor/"+e+"/"),Zh(t+s+i+".json")}class Jh{constructor(){this.e=null,this.c=1,this.d=0,this.a=-1,this.b=!1}}class tl{constructor(t,e){this.a=t,this.b=e}}class el extends Jh{constructor(){super(...arguments),this.ba=[]}}class il{constructor(t,e){this.b=t,this.a=e}}function sl(t,e){return t==e||!!t&&(!!e&&(t.a==e.a&&(t.b==e.b||!!t.b&&(!!e.b&&(t.b.b==e.b.b&&(t.b.a==e.b.a&&t.b.c==e.b.c))))))}class rl{constructor(t,e){this.c=t,this.g=[],this.d=e,this.b={},this.f={}}i(){const t=[];for(let e of this.d.Options)for(let i of e.Choices)for(let e of i.Elements)e.SkinnedModel&&t.push(e.SkinnedModel.CollectionFileDataID);const e=new Set(t),i=this.c.v;i.renderer;if(0!=e.size)for(let t of e){const e=new el;e.e=new Xh(i,t,{},!0),this.c.CB[t]=e}}h(t){return Hh.b(this.d.TextureFiles[t],this.c.qp,this.c.N,this.c.sr)}a(t){WH.debug("applyCustomization options",t),this.g=[],this.c.hg=[];for(const t in this.c.CB){this.c.CB[t].ba=[]}let e=0,i={},s={};for(let r=0;r<t.length;r++){let n=this.d.Options.find(e=>e.Id==t[r].optionId);if(WH.debug("option",n),n){let a=n.Choices.find(e=>e.Id==t[r].choiceId);if(WH.debug("choice",a),a){let r=a.Elements.filter(e=>e.BoneSet&&e.BoneSet.BoneFileDataID&&(0==e.VariationChoiceID||t.some(t=>t.choiceId==e.VariationChoiceID)));r.length>0&&(e=r[0].BoneSet.BoneFileDataID);let o=a.Elements.filter(e=>e.Material&&(0==e.VariationChoiceID||t.some(t=>t.choiceId==e.VariationChoiceID)));o.sort((t,e)=>e.VariationChoiceID-t.VariationChoiceID),o.forEach(t=>{WH.debug("element material",t);let e=this.h(t.Material.MaterialResourcesID);if(!e)return void WH.debug("element material: can't get texture files for material",t);let r=this.d.TextureLayers.find(e=>e.ChrModelTextureTargetID==t.Material.TextureTarget);if(!r)return void WH.debug("element material: can't get texture layer for material",t);const n=new il(e,r.TextureType);sl(n,this.f[t.Material.TextureTarget])?(i[t.Material.TextureTarget]=this.b[t.Material.TextureTarget],s[t.Material.TextureTarget]=this.f[t.Material.TextureTarget]):(i[t.Material.TextureTarget]=this.c.ba(r.TextureType,e),s[t.Material.TextureTarget]=n)}),a.Elements.filter(e=>e.Geoset&&(0==e.VariationChoiceID||t.some(t=>t.choiceId==e.VariationChoiceID))).sort((t,e)=>t.Geoset.GeosetType-e.Geoset.GeosetType||t.Geoset.GeosetID-e.Geoset.GeosetID).forEach(t=>{WH.debug("element geoset",t),this.g.push(100*t.Geoset.GeosetType+t.Geoset.GeosetID)}),a.Elements.filter(e=>e.SkinnedModel&&(0==e.VariationChoiceID||t.some(t=>t.choiceId==e.VariationChoiceID))).forEach(t=>{WH.debug("element skinnedmodel",t),t.ChrCustItemGeoModifyID;const e=this.c.CB[t.SkinnedModel.CollectionFileDataID];t.SkinnedModel.GeosetID<100&&e.ba.push(new tl(100*t.SkinnedModel.GeosetType+t.SkinnedModel.GeosetID,(1&t.SkinnedModel.Flags)>0))});let h=a.Elements.find(e=>0!=e.CondModelFileDataId&&(0==e.VariationChoiceID||t.some(t=>t.choiceId==e.VariationChoiceID)));24!=n.Id&&353!=n.Id||(h&&!this.c.overrideModelFile?this.c.overrideModelFile=h.CondModelFileDataId:!h&&this.c.overrideModelFile&&(this.c.overrideModelFile=0)),a.Elements.filter(e=>e.ChrCustItemGeoModifyID&&(0==e.VariationChoiceID||t.some(t=>t.choiceId==e.VariationChoiceID))).forEach(t=>{WH.debug("element ChrCustItemGeoModify",t),this.c&&this.c.hg.push(t.ChrCustItemGeoModifyID)})}}}if(!this.b[10]){let e=this.d.Options.find(t=>t.Id==this.d.HairStyleOptionId);if(e){let r=e.Choices[1];if(r){let e=r.Elements.filter(e=>e.Material&&10==e.Material.TextureTarget&&(0==e.VariationChoiceID||t.some(t=>t.choiceId==e.VariationChoiceID)));if(e.length>0){let t=this.h(e[0].Material.MaterialResourcesID);if(t){const r=new il(t,0);sl(r,this.f[e[0].Material.TextureTarget])?(i[e[0].Material.TextureTarget]=this.b[e[0].Material.TextureTarget],s[e[0].Material.TextureTarget]=this.f[e[0].Material.TextureTarget]):(i[e[0].Material.TextureTarget]=this.c.ba(6,t),s[e[0].Material.TextureTarget]=r)}}}}}this.b=i,this.f=s,this.c.d().P(e),this.c.x=!0}e(){let t=[];for(let e=0;e<this.d.Options.length;e++){let i=this.d.Options[e];if(i){let e=i.Choices[0];e&&t.push({optionId:i.Id,choiceId:e.Id})}}this.a(t)}j(t){let e={options:t,sheathMain:-1,sheathOff:-1};for(let t of this.d.Options)e.options.some(e=>e.optionId==t.Id)||e.options.push({optionId:t.Id,choiceId:t.Choices[0].Id});return e}}class nl{constructor(){this.c=null,this.a=1,this.b=!1}}const al=class{constructor(t,e,i){this.j=t,this.f=e,this.h=[],this.b=!1,this.g=[],i&&this.d(i)}m(){}d(t){this.a=t;Qh(this.j.fe.options.contentPath,Ms.ITEMVISUAL,t).then(t=>{this.l(t)})}l(t){if(this.h=new Array(7),t.ItemEffects)for(let e=0;e<t.ItemEffects.length;++e){let i=t.ItemEffects[e];if(-1==i.SubClass||this.f==i.SubClass){if(i.Model){const t=new nl;this.h[i.Slot-1]=t,t.c=new jh(this.j.fe,this.j.fe.renderer,i.Model),t.a=i.Scale&&1!=i.Scale?i.Scale:1}if(i.kit){const t=new Wh(this.j,i.kit.effects);this.g.push(t)}}}for(var e=0;e<this.h.length;++e)t.Equipment[e]&&null==this.h[e]&&(this.h[e]=new nl,this.h[e].c=new jh(this.j.fe,this.j.fe.renderer,t.Equipment[e]));this.b=!0}k(t){for(let e=0;e<this.h.length;e++){const i=this.h[e];i&&i.b&&i.c.J(t)}}e(t){for(let e=0;e<this.h.length;e++){const i=this.h[e];i&&i.b&&(i.c&&i.c.f&&t.c(i.c,!1))}}c(t,e,i){if(t.b)return;if(!i.loaded)return;if(!t.c||!t.c.f)return;const s=i.modelInstance.k;let r=null;if(e<=8&&6!=e&&7!=e){if(!s.R[e])return;r=s.R[e]}else r=i.modelInstance.aF(19);let n=ri();ci(n,n,r.a),di(n,n,Pe(t.a,t.a,t.a)),t.c.ap(i.modelInstance,r.d,n),t.b=!0}i(){if(this.j.loaded){for(const t of this.g)t&&t.n();for(let t=0;t<this.h.length;t++){const e=this.h[t];e&&(this.c(e,t,this.j),e.c.aJ())}}}};class ol{constructor(t,e,i){this.j=t,this.L=[],this.v=!1,this.n=null,this.J=[],this.H=ri(),WH.debug("Creating item",i),this.q=e,this.A=i,this.c=t.sr,this.e=t.qp,this.k=t.N,this.F=Ss[e],this.m=Fs[e],this.l=null,this.E=null,this.G=null,this.y=0,this.f=0,this.v=!1,this.K=!1,this.r=0,this.D=3,this.x=0,i&&this.w()}p(){var t=this;if(t.L){for(let e=0;e<t.L.length;++e)t.L[e]&&(t.L[e].e=null,t.L[e]=null);t.L=null}if(t.l){for(let e=0;e<t.l.length;++e)t.l[e].texture&&t.l[e].texture.j(),t.l[e].texture=null,t.l[e]=null;t.l=null}if(t.E=null,t.G=null,t.J){for(let e=0;e<t.J.length;e++)t.J[e].m();t.J=null}t.v=!1,WH.debug("Destroyed item",this.A)}w(){let t=this,e=this.j.v.options;WH.debug("Loading item",this.A),$h(e.contentPath,this.q,this.A).then(t=>{this.C(t)}).catch(()=>{t.K=!0})}C(t){if(!this.j)return void WH.debug("Char model was destroyed before it was loaded",this.A);const e=this.j.v,i=(e.options,this.e),s=this.c,r=this.k;if(this.f=t.Item.Flags,this.y=t.Item.InventoryType,this.t=t.Item.ItemClass,this.B=t.Item.ItemSubClass,t.ComponentTextures){this.l=[];for(let n in t.ComponentTextures){const a=parseInt(n),o=Hh.b(t.TextureFiles[t.ComponentTextures[n]],i,r,s);if(o){let t;t={region:a,gender:this.e,file:o.b,texture:null},12!=a?t.texture=e.getTexture(o.b):16==this.q&&this.j.d().ae(2,e.getTexture(o.b)),this.l.push(t)}}}this.E=t.Item.GeosetGroup,this.G=t.Item.AttachGeosetGroup,this.x=t.Item.GeosetGroupOverride,1==this.q&&(0==i?this.h=t.Item.HideGeosetMale:this.a=t.Item.HideGeosetFemale);let n=0;if(3==this.q?n=2:Is[this.q]!=Ms.ARMOR&&(n=1),n>0&&t.ComponentModels)for(let i=0;i<n;++i){let s=fl.c(e,t,Is[this.q],this.c,this.e,this.k);if(3==this.q&&s.cba(i+1),null==s.modelInstance)continue;const r=new Jh;r.e=s,r.d=i,t.Item&&t.Item.ParticleColor&&r.e.modelInstance.aI(t.Item.ParticleColor),this.L.push(r)}if((6==this.q||16==this.q)&&t.ComponentModels){let n=0;if(16==this.q&&(n=1),t.ComponentModels[n]){const a=t.ComponentModels[n],o=Hh.a(t.ModelFiles[a],-1,i,r,s),h=new Jh,l=0==n?t.Textures:t.Textures2;h.e=new Xh(e,o,l,!1),this.L=[h]}}const a=this.q;if((4==a||5==a||20==a||6==a||7==a||10==a||8==a||1==a||9==a||19==a||16==a)&&t.ComponentModels){let n=0;if(1!=a&&6!=a||(n=1),t.ComponentModels[n]){const a=t.ComponentModels[n];if(a&&t.ModelFiles&&t.ModelFiles[a]){const o=Hh.a(t.ModelFiles[a],-1,i,r,s);if(o){const i=0==n?t.Textures:t.Textures2;this.n=new Jh,this.n.e=new Xh(e,o,i,!0),this.n.e.h(()=>{this.j.s=!0})}}}}7==a&&this.E[2]>0&&(this.m+=2);const o=0!=this.r?this.r:0!=t.Item.ItemVisual?t.Item.ItemVisual:0;if(0!=o){const t=2==this.t?this.B:-1;for(let e=0;e<this.L.length;e++)this.J.push(new al(this.L[e].e,t,o))}this.v=!0,WH.debug("Loaded item:","DisplayId",this.A,"InventoryType",this.y),this.j.s=!0}u(t){for(let t=0;t<this.J.length;t++)this.J[t].m();this.J=[],this.r=t}i(t){this.D=t}b(t){if(3==this.q){const e=t.e.shoulderIndex;if(1==e&&!(1&this.D))return!0;if(2==e&&!(2&this.D))return!0}return!1}s(t){for(let e=0;e<this.J.length;++e)this.J[e]&&this.J[e].k(t);for(let e=0;e<this.L.length;++e){const i=this.L[e];if(i&&i.e){if(this.b(i))continue;i.e.e(t)}}}d(){if(this.L)for(let t=0;t<this.L.length;++t)this.L[t].b=!1,this.L[t].e&&this.L[t].e.m(null,-1,null);this.n&&(this.n.b=!1)}z(t,e,i){if(!t)return;if(!t.e)return;if(!t.e.modelInstance.f)return;const s=t.d;if(s<i.length){let r=e.R[i[s]];if(t.b&&r.d==t.a)return;let n=!1,a=Es[t.e.fileDataId],o=Be(),h=ri();if(oi(h),a&&(Ge(o,1,1,-1),di(h,h,o),n=!0),(22==this.q||23==this.q||22==this.F)&&256&this.f&&(Ge(o,1,-1,1),di(h,h,o),n=!0,t.e.isMirrored=!0),13==this.q&&1024&this.f&&(Ge(o,1,-1,1),di(h,h,o),n=!0,t.e.isMirrored=!0),t.e.winding=n,5==this.j.z&&26==this.q&&2==this.t&&18==this.B&&(oi(h),fi(h,h,-Math.PI/2)),ci(h,h,r.a),ui(h,h,this.H),27==this.q){let e=t.e.k.Scale;Ge(o,e,e,e),di(h,h,o)}t.e.m(this.j.d(),r.d,h),t.b=!0,t.a=r.d}t.b=!0}g(t){ni(this.H,t);for(let t=0;t<this.L.length;++t)this.L[t].b=!1}I(){if(!this.j.loaded)return;const t=this.j.d().k,e=this.j.kj(this.F,this);for(let i=0;i<this.L.length;++i)this.z(this.L[i],t,e),this.J[i]&&this.J[i].i();this.n&&this.j.M(this.n);for(let t=0;t<this.L.length;++t){const e=this.L[t];if(e&&e.e){if(this.b(e))continue;e.e.b()}}}o(t){this.L.forEach(e=>{e.e.g(t)}),this.n&&this.n.e.g(t)}}class hl extends Kh{constructor(t,e){super(t,e),this.gf=new Map,this.I=[],this.CB={},this.on=null,t.options.charCustomization&&(this.wv=t.options.charCustomization),this.H=new Array(52);for(let t=0;t<52;t++)this.H[t]=100*t+As[t]}get overrideModelFile(){return this.L}set overrideModelFile(t){const e=this.L;this.L=t,e!=t&&(this.E(),this.ed(),this.s=!0)}E(){let t=this.L?this.L:this.Az.Model;this.c=new jh(this.v,this.v.renderer,t),this.c.K(),this.c.x(27==this.sr||30==this.sr),this.on=null,this.s=!0}u(t){const e=this.v.options;this.sr=t.Character.Race,this.qp=t.Character.Gender,this.N=e.cls?e.cls:0;const i=e&&e.items;Qh(e.contentPath,Ms.CHARACTER,t.Character.ChrModelId).then(s=>{var r,n;this.Az=s,this.E(),(r=e.contentPath,n=t.Character.ChrModelId,new Promise((t,e)=>{const i=r+"meta/charactercustomization/"+n+".json";$.getJSON(i,function(e){t(e)})})).then(e=>{var s,r;if(WH.debug("Got customization data v2",e),this.ml=new rl(this,e),null===(s=this.P)||void 0===s||s.call(this,this.ml.d),this.ml.i(),this.wv)this.setAppearance(this.wv);else if(t.Character.Race>0&&(null===(r=null==t?void 0:t.Creature)||void 0===r?void 0:r.CreatureCustomizations)){let e=this.ml.j(t.Creature.CreatureCustomizations);this.setAppearance(e)}else this.ml.e();this.x&&this.q(),t.Equipment&&this.G(t.Equipment),i&&this.G(i)})}),this.x=!0}ed(){for(const[t,e]of this.gf)e.d();for(const t in this.CB){this.CB[t].b=!1}for(const t of this.B)t.m()}ih(t,e,i){if(!this.gf)return;if(3==t&&this.I&&this.I[0])return;let s=new ol(this,t,e);i&&s.u(i);let r=s.F,n=ks[t];this.gf.get(r)&&0!=n?(s.F=n,this.gf.set(n,s)):this.gf.set(r,s)}ut(t){var e=this.gf.get(t);e||(t=Ss[t],e=this.gf.get(t)),e&&(this.gf.delete(t),e.p())}kj(t,e){const i=this.c.k,s=[],r={14:t=>[0],26:t=>2==t.t&&18==t.B?[1]:null};if(i.R&&i.k){const n={1:t=>[11],3:t=>[6,5],22:t=>{var e;return(null===(e=r[t.q])||void 0===e?void 0:e.call(r,t))||[2]},21:t=>[1],17:t=>[1],15:t=>[2],25:t=>[1],13:t=>[1],14:t=>[0],23:t=>[2],6:t=>[53],26:t=>[1],16:t=>[57],27:t=>[55]};if(n[t]){const r=n[t](e);for(let n=0;n<r.length;++n){let a=r[n];(this.z>=0||this.o>=0||this.C)&&Bs[t]&&(a=Bs[t]),this.z>=0&&21==t&&Os[this.z][t]&&(a=Os[this.z][t]),this.o>=0&&22==t&&Os[this.o][t]&&(a=Os[this.o][t]),15==e.y&&this.o>=0&&22==t&&Os[this.o][e.q]&&(a=Os[this.o][e.q]),a>=i.k.length||-1==i.k[a]||s.push(i.k[a])}}}return s}G(t){if($.isArray(t))for(let e=0;e<t.length;++e)this.ih(t[e][0],t[e][1],t[e][2]);else for(let e in t)this.ih(parseInt(e),t[e]);this.s=!0,this.D()}yx(t,e,i){for(const s in this.CB){this.CB[s].e.ba(t,e,i)}}w(){var t;const e=this.c;for(let t=0;t<52;t++)this.H[t]=100*t+As[t];for(const e of(null===(t=this.ml)||void 0===t?void 0:t.g)||[])e>=0&&(this.H[Math.floor(e/100)]=e);for(const t in this.CB){const e=this.CB[t].ba,i=this.CB[t].e;i.ba(0,Ps,!1);for(const t of e)i.ba(t.a,t.a,!0),this.H[Math.floor(t.a/100)]=t.a}e.aK(0,Ps,!1),e.aK(0,0,!0);for(let t=0;t<this.H.length;t++)e.aK(this.H[t],this.H[t],!0);let i=this.gf.get(1),s=this.gf.get(3),r=this.gf.get(4),n=this.gf.get(5),a=this.gf.get(6),o=this.gf.get(7),h=this.gf.get(8),l=this.gf.get(9),u=this.gf.get(10),c=this.gf.get(19),d=this.gf.get(16),f=!1,g=!1;n&&n.E&&n.E[2]?g=!0:o&&o.E&&o.E[2]&&(f=!0);let _=g||f;this.gf.forEach(t=>{if(t&&t.v&&t.n){let e=t.n.e.modelInstance;if(!e.f)return;e.aK(0,Ps,!1),1==t.q?(e.Y(t.E[0],2700),e.Y(t.E[1],2100)):3==t.q?e.Y(t.E[0],2600):4==t.q?(e.Y(t.E[0],800),e.Y(t.E[1],1e3)):5==t.q||20==t.q?(u&&u.v&&u.E[0]?e.Y(-2,800):e.Y(t.E[0],800),e.Y(t.E[1],1e3),_&&e.Y(t.E[2],1300),e.Y(t.E[3],2200),e.Y(t.E[4],2800)):6==t.q?e.Y(t.E[0],1800):7==t.q?(e.Y(t.E[0],1100),e.Y(t.E[1],900),_&&e.Y(t.E[2],1300)):8==t.q?(e.Y(t.E[0],500),e.Y(t.E[1],2e3)):10==t.q?(0==t.E[0]&&n&&n.v&&n.E[0]?e.Y(-2,400):e.Y(t.E[0],400),e.Y(t.E[1],2300)):16==t.q?e.Y(t.E[0],1500):19==t.q?e.Y(t.E[0],1200):9==t.q&&(u&&u.v&&u.E[0]||null!=(null==u?void 0:u.n)||n&&n.v&&n.E[2]&&n.E[0]>0?e.Y(-2,2300):e.Y(t.E[0],2300))}}),this.I.forEach(t=>{if(t&&t.n){const e=t.n.e.modelInstance;e.aK(0,Ps,!1),e.Y(t.E[0],2600)}}),this.gf.forEach(t=>{if(t&&t.v&&t.L)for(let e of t.L){if(!e)continue;let i=e.e;1==t.q?(i.i(t.G[0],27),i.i(t.G[1],21)):3==t.q?i.i(t.G[0],26):4==t.q?(i.i(t.G[0],8),i.i(t.G[1],10)):5==t.q||20==t.q?(i.i(t.G[0],8),i.i(t.G[1],10),i.i(t.G[2],13),i.i(t.G[3],22),i.i(t.G[4],28)):6==t.q?i.i(t.G[0],18):7==t.q?(i.i(t.G[0],11),i.i(t.G[1],9),i.i(t.G[2],13)):8==t.q?(i.i(t.G[0],5),i.i(t.G[1],20)):10==t.q?(i.i(t.G[0],4),i.i(t.G[1],23)):16==t.q?i.i(t.G[0],15):19==t.q?i.i(t.G[0],12):9==t.q&&i.i(t.G[0],23)}}),this.I.forEach(t=>{if(t&&t.L)for(let e of t.L){let i=e.e;i.i(t.G[0],26),t.x>0&&(i.ba(2600,2699,!1),i.i(t.x,26))}});if(i&&i.v){const t=i.n||i.L[0],s=this.sr,r=0==this.qp?i.h:i.a;if(t&&r)for(let t=0;t<r.length;t++)if(r[t].RaceId==s){const i=r[t].GeosetGroup;if(5==s&&(1==i||2==i))continue;if(i<52)if(0==i)e.aK(1,99,!1);else{const t=100*i;e.aK(t,t+99,!1)}}}if(i&&i.L&&i.x>0)for(let t of i.L){let e=t.e;e.ba(2600,2799,!1),e.i(i.x,27)}if(s&&s.L&&s.x>0)for(let t of s.L){let e=t.e;e.ba(2600,2699,!1),e.i(s.x,26)}if(a&&a.L&&a.x>0)for(let t of a.L){let e=t.e;e.ba(1800,1899,!1),e.i(a.x,18)}let b=0;if(c&&(b|=16),u&&u.v&&u.E&&u.E[0]){let t=401+u.E[0];e.aK(401,499,!1),e.aK(t,t,!0)}else if(n&&n.v&&n.E&&n.E[0]){let t=801+n.E[0];e.aK(t,t,!0),u&&u.E&&0==u.E[0]&&(u.m=7,n.m=8,WH.debug("updating sorting for chest/gloves"))}if(!(n||a||l)&&r&&r.v&&r.E&&r.E[0]){let t=801+r.E[0];e.aK(t,t,!0)}if(c&&c.v)1048576&c.f||(e.aK(2200,2299,!1),e.aK(2202,2202,!0));else if(n&&n.v&&n.E&&n.E[3]){let t=2201+n.E[3];e.aK(2200,2299,!1),e.aK(t,t,!0)}let p,m=!1;if(a&&a.v&&a.E&&a.E[0]&&(m=!!(512&a.f)),g){e.aK(501,599,!1),e.aK(902,999,!1),e.aK(1100,1199,!1),e.aK(1300,1399,!1);let t=1301+n.E[2];e.aK(t,t,!0)}else if(f){e.aK(501,599,!1),e.aK(902,999,!1),e.aK(1100,1199,!1),e.aK(1300,1399,!1);let t=1301+o.E[2];e.aK(t,t,!0)}else if(h&&h.v&&h.E&&h.E[0]){e.aK(501,599,!1),e.aK(901,901,!0);let t=501+h.E[0];e.aK(t,t,!0)}else{let t;t=o&&o.v&&o.E&&o.E[1]?901+o.E[1]:901,e.aK(t,t,!0)}p=h&&h.v&&h.E&&h.E[1]?2e3+h.E[1]:!h||!h.v||1048576&h.f?2001:2002,e.aK(2001,2099,!1),e.aK(p,p,!0);let x=!1;if(!_&&c&&c.v&&c.E&&c.E[0]){let t;x=!1,m?(x=!0,t=1203):(x=!0,t=1201+c.E[0]),e.aK(t,t,!0)}else 16&b&&(e.aK(1201,1201,!0),_||(e.aK(1202,1202,!0),x=!0));if(!x&&!g)if(n&&n.v&&n.E&&n.E[1]){let t=1001+n.E[1];e.aK(t,t,!0)}else if(r&&r.v&&r.E&&r.E[1]){let t=1001+r.E[1];e.aK(t,t,!0)}if(!g&&o&&o.v&&o.E&&o.E[0]){let t=o.E[0],i=1101+t,s=e.h.some(t=>t.meshId==i);t>2?(e.aK(1300,1399,!1),s?e.aK(i,i,!0):e.aK(1301,1301,!0)):x||e.aK(i,i,!0)}if(c&&c.v&&c.E&&c.E[0]&&this.hg.length>0)for(let t of this.hg){const i=Cs[t];if(i&&12==i.GeosetType&&i.Original==c.E[0]+1){e.aK(1200,1299,!1);let t=1200+i.Override;e.aK(t,t,!0);break}}if(d&&d.v&&d.E&&d.E[0]){e.aK(1500,1599,!1);let t=1501+d.E[0];if(this.hg.length>0)for(let e of this.hg){const i=Cs[e];if(i&&15==i.GeosetType&&i.Original==d.E[0]+1){t=1500+i.Override;break}}e.aK(t,t,!0)}if(a&&a.v&&a.E&&a.E[0]){e.aK(1800,1899,!1);let t=1801+a.E[0];e.aK(t,t,!0)}o||g||f||x||m?e.aK(1400,1499,!1):e.aK(1401,1401,!0)}setParticlesEnabled(t){super.setParticlesEnabled(t),this.gf.forEach(e=>{if(e.L)for(let i=0;i<e.L.length;++i)e.L[i]&&e.L[i].e.setParticlesEnabled(t)})}q(){}K(){if(!this.x)return;let t=!1;if(this.gf.forEach(e=>{if(e.v||e.K){if(e.l)for(let i=0;i<e.l.length;++i)if(e.l[i].texture&&!e.l[i].texture.d())return void(t=!0)}else t=!0}),t)return;if(!this.ml)return;const e=this.ml.d.Materials,i=this.ml.d.TextureLayers,s=this.ml.d.TextureSections;let r=!0,n=!0;15!=this.sr&&21!=this.sr||(n=!1),this.gf.forEach(t=>{let e=t.F;4!=e&&5!=e&&19!=e||(r=!1,null==t.l&&(r=!0)),7==e&&(n=!1,null==t.l&&(n=!0))});let a=-1;if(27==this.sr)for(let t of i)9==t.BlendMode&&1==t.TextureType&&t.Layer>a&&(a=t.Layer);const o=(h=t=>t.TextureType,i.reduce((t,e)=>{var i;return(t[i=h(e)]||(t[i]=[])).push(e),t},{}));var h;for(const t in o){const e=o[t];for(const t of e){const e=this.ml.b[t.ChrModelTextureTargetID];if(e&&!e.d())return}}for(const t in o){const i=o[t],h=i[0].TextureType;if(!this.dc[t]){const i=e.find(t=>t.TextureType==h);if(!i){WH.debug("unable to find material info",h);continue}this.dc[t]=new js(this.v.context,i.Width,i.Height)}const l=this.dc[t];l.r();for(const t of i){let e=-1;t.Layer==a&&(e=0);const i=this.ml.b[t.ChrModelTextureTargetID];if(!i)continue;const o=t.TextureSection;if(3!=o&&5!=o||r&&3==o||n&&5==o){let r=0,n=0,a=1,h=1;if(-1!=o&&s){const t=s.find(t=>t.SectionType==o);if(!t){WH.debug("can't find texture section data",o);continue}r=t.X,n=t.Y,a=t.Width,h=t.Height}l.d(i,r,n,a,h,t.BlendMode,t.Layer,e)}}1==h&&52!=this.sr&&70!=this.sr&&this.cba(l),26!=h||52!=this.sr&&70!=this.sr||this.cba(l),l.a()}this.F(this.c);for(let t in this.CB){const e=this.CB[t];e.e&&e.e.loaded&&this.F(e.e.d())}this.x=!1}F(t){if(this.dc[1]){const e=this.dc[1];t.F(e.k(0),e.k(1),e.k(2))}for(let e in this.dc){this.dc[e];t.ae(e,this.dc[e].k(0))}}cba(t){const e=[];this.gf.forEach(t=>{e.push(t)}),e.sort(function(t,e){return t.m-e.m});const i=this.ml.d.TextureSections;for(let s=0;s<e.length;s++){const r=e[s];if(r.l)for(let e=0;e<r.l.length;e++){const s=r.l[e];if(s.gender==this.qp&&s.texture&&s.texture.d()&&12!=s.region){if(1&this.t.Character.ChrModelFlags&&7==s.region)continue;const e=i.find(t=>t.SectionType==s.region);if(!e){WH.debug("can't find texture section data",s.region);continue}const r=new Gs;r.c=s.texture,t.d(r,e.X,e.Y,e.Width,e.Height,0,-1,-1)}}}}setAppearance(t){var e;this.wv=t,this.z=t.sheathMain,this.o=t.sheathOff,null===(e=this.ml)||void 0===e||e.a(t.options),this.x=!0,this.s=!0,this.q(),this.D()}setCustomizationsLoadedCallback(t){this.P=t}setItems(t){const e=this.v.options;WH.debug("setItems",t);const i=[];for(let e=0;e<t.length;e++)i.push([t[e].slot,t[e].display,t[e].visual]);i.forEach(t=>{const i=[parseInt(t[0]),parseInt(t[1])];e.items.push(i)}),this.G(i),this.x=!0}attachList(t){const e=this.v.options;WH.debug("attachList",t);const i=t.split(","),s=[];for(let t=0;t<i.length;t+=2)s.push([i[t],i[t+1]]);s.forEach(t=>{const i=[parseInt(t[0]),parseInt(t[1])];e.items.push(i)}),this.G(s),this.x=!0}clearSlots(t){const e=this.v.options;WH.debug("clearSlots",t);const i=t.split(",");for(let t=0;t<i.length;++t){this.ut(parseInt(i[t]));const s=[];e.items.forEach(i=>{0!=e.items[t].indexOf(parseInt(i))&&s.push(i)}),e.items=s}this.D(),this.x=!0}setShouldersOverride(t){if(WH.debug("setShouldersOverride",t),!t||2!=t.length)return;for(let t=0;t<2;t++){const e=this.I[t];e&&e.p(),this.I[t]=null}for(let e=0;e<2;e++)if(null!=t[e]){const i=new ol(this,3,t[e]);let s=0;s=0==e?1:2,i.i(s),this.I[e]=i}const e=this.gf.get(3);if(e){let t=3;for(let e=0;e<2;e++)this.I[e]&&(t&=~(1<<e));e.i(t)}this.I&&(this.I[0]||this.I[1])&&this.ut(3)}setSheath(t,e){this.z=t,this.o=e,this.D()}D(){if(!this.loaded)return;const t=this.c;let e=(-1==this.o||!this.o)&&null!=this.gf.get(22),i=!(-1!=this.z&&this.z||null==this.gf.get(13)&&null==this.gf.get(21));for(let i of Ds){let s=t.k.S[i];s>0&&s<t.O.length&&this.c.O[s].a(e?"HandsClosed":"")}for(let e of Us){let s=t.k.S[e];s>0&&s<t.O.length&&t.O[s].a(i?"HandsClosed":"")}}M(t){const e=this.c;if(!e.f)return;const i=t.e.modelInstance;if(!i||!i.f)return;t.b||(i.ap(e,-1,null),t.b=!0);let s=i.O;if(s){for(let t=0;t<s.length;t++){let i=s[t],r=this.on[i.q.d];if("number"!=typeof r)continue;let n=s[t].j,a=e.O[r].j;s[t].d=!0,ni(n,a)}i.aJ()}}O(){const t=this.c;let e={};for(let i=0;i<t.O.length;i++)e[t.O[i].q.d]=i;this.on=e}b(){if(this.c&&this.c.f){this.on||(this.O(),this.D()),super.b();for(const t in this.CB){const e=this.CB[t];this.M(e)}this.gf.forEach(t=>{if(t){if(2==t.t&&13==t.B){if(21==t.F&&-1!=this.z)return;if(22==t.F&&-1!=this.o)return}t.I()}}),this.I.forEach(t=>{t&&t.L&&t.I()}),this.K()}}static J(t,e){const i=t.e;if(!i.loaded)return;const s=i.modelInstance;if(!s||!s.f)return;s.O&&s.J(e)}e(t){if(this.c&&this.c.f){super.e(t);for(const e in this.CB){const i=this.CB[e];hl.J(i,t)}if(this.gf.forEach(e=>{if(e){if(2==e.t&&13==e.B){if(21==e.F&&-1!=this.z)return;if(22==e.F&&-1!=this.o)return}e.s(t)}}),this.I.forEach(e=>{e&&e.L&&e.s(t)}),this.l)for(let e=0;e<this.l.length;e++){let i=this.l[e];i.f&&i.J(t)}this.gf.forEach(e=>{e&&e.n&&e.n.e&&e.n.b&&hl.J(e.n,t)})}}g(t){super.g(t);for(const e in this.CB){const i=this.CB[e];i.b&&(i.e&&i.e.loaded&&i.e.g(t))}if(this.gf.forEach(e=>{if(e){if(2==e.t&&13==e.B){if(21==e.F&&-1!=this.z)return;if(22==e.F&&-1!=this.o)return}e.o(t)}}),this.I.forEach(e=>{e&&e.L&&e.o(t)}),this.l)for(let e=0;e<this.l.length;e++){let i=this.l[e];i.f&&t.c(i,!1)}}}class ll extends Vh{constructor(t,e,i,s,r,n){super(t,e,i,s,r,n),this.cba()}cba(){let t=this.j;const e=this.hg,i=this.l,s=this.k;if(s.ComponentModels){let r=s.ComponentModels[0]||s.ComponentModels[1];r&&s.ModelFiles&&s.ModelFiles[r]&&(27==s.Item.InventoryType?this.c=new jh(this.fe,this.fe.renderer,s.ModelFiles[r][0].FileDataId):this.c=new jh(this.fe,this.fe.renderer,Hh.a(s.ModelFiles[r],-1,e,i,t)),this.c.K()),this.c&&s.Item.AttachGeosetGroup&&(this.c.e(s.Item.AttachGeosetGroup[0],27),this.c.e(s.Item.AttachGeosetGroup[1],21))}if(s.Textures)for(let t in s.Textures)0!=s.Textures[t]&&this.c.ae(parseInt(t),this.fe.getTexture(s.Textures[t]))}}class ul extends Vh{constructor(t,e,i,s,r,n){super(t,e,i,s,r,n),this.gf=0,this.ed()}get shoulderIndex(){return this.gf}cba(t){this.gf!=t&&(this.gf=t,this.ed())}ed(){this.c=null;let t=this.j;const e=this.hg,i=this.l,s=this.k;if(s.ComponentModels){let r=s.ComponentModels[0],n=s.ComponentModels[1];if(!r||1!=this.gf&&0!=this.gf){if(n&&(2==this.gf||0==this.gf)&&(n&&s.ModelFiles[n]&&(this.c=new jh(this.fe,this.fe.renderer,Hh.a(s.ModelFiles[n],1,e,i,t)),this.c.K()),s.Textures2&&this.c))for(let t in s.Textures2)0!=s.Textures2[t]&&this.c.ae(+t,this.fe.getTexture(s.Textures2[t]))}else if(r&&s.ModelFiles[r]&&(this.c=new jh(this.fe,this.fe.renderer,Hh.a(s.ModelFiles[r],0,e,i,t)),this.c.K()),this.c&&s.Textures)for(let t in s.Textures)0!=s.Textures[t]&&this.c.ae(+t,this.fe.getTexture(s.Textures[t]))}this.c&&s.Item.AttachGeosetGroup&&this.c.e(s.Item.AttachGeosetGroup[0],26)}b(){this.c.aJ()}e(t){this.c.J(t)}}class cl extends Vh{constructor(t,e,i,s,r,n){super(t,e,i,s,r,n),this.cba()}cba(){let t=this.j;const e=this.hg,i=this.l,s=this.k;if(s.ComponentModels){let r=s.ComponentModels[0];r&&s.ModelFiles&&s.ModelFiles[r]&&(this.c=new jh(this.fe,this.fe.renderer,Hh.a(s.ModelFiles[r],-1,e,i,t)))}if(this.c&&s.Textures)for(let t in s.Textures)0!=s.Textures[t]&&(this.c.y[+t]=this.fe.getTexture(s.Textures[t]))}isLoaded(){return!this.c&&!this.k.ComponentModels||this.loaded}}class dl extends qh{constructor(t,e){super(),this.dc=t,this.fe=e,this.ba()}ba(){this.c=new jh(this.dc,this.dc.renderer,this.fe.Model),this.c.Z(1|this.fe.Scale)}b(){this.c&&this.c.aJ()}getBounds(){return this.c.f?this.c.aH():[null,null]}e(t){this.c&&this.c.J(t)}}class fl{static a(t,e,i){if(e.Character||i==Ms.CHARACTER)return new hl(t,e);if(i==Ms.NPC||i==Ms.HUMANOIDNPC)return new Kh(t,e);if(i==Ms.HELM||i==Ms.SHOULDER||i==Ms.ITEM){const s=fl.c(t,e,i,1,0,0);return s.dc(),s}if(i==Ms.OBJECT)return new dl(t,e);throw"Couldn't create actor"}static c(t,e,i,s,r,n){if(i==Ms.HELM)return new ll(t,e,s,r,n,!1);if(i==Ms.SHOULDER)return new ul(t,e,s,r,n,!1);if(i==Ms.ITEM)return new cl(t,e,s,r,n,!1);throw"Couldn't create item actor"}static b(t,e,i){return e==Ms.PATH?new Promise((e,s)=>{e(new Xh(t,i,{},!1))}):Qh(t.options.contentPath,e,i).then(i=>fl.a(t,i,e))}}const gl=class{constructor(t){this.currFrame=0,this.clearColor=Pe(0,0,0),this.addedCss=!1,this.progressShown=!1,this.doUpdateBounds=!1,this.attributeState=new ke,this.gxDevice=null,this.textureCache=new Map,this.crossFadeDuration=.3,this.onContextMenu=function(t){return!1};var e=this;e.viewer=t,e.options=t.options,e.downloads={},e.context=null,e.bgImgLoaded=!1,e.width=0,e.height=0,e.time=0,e.delta=0,e.actors=[],e.screenshotDataURL=null,e.makeDataURL=!1,e.screenshotCallback=null,e.azimuth=1.5*Math.PI,e.zenith=Math.PI/2,e.distance=15,e.fov=30,e.zoom={rateStep:.1,rateAccelerationDecay:.4,interpolationRate:.3,range:[.3,4],rateCurrent:0,target:1,current:1},e.zoom.range=e.zoom.range.map(function(t){return Math.log(t)/Math.log(1+e.zoom.rateStep)}),e.translation=Pe(0,0,0),e.translationFromModel=Pe(0,0,0),e.target=Pe(0,0,0),e.eye=Pe(0,0,0),e.up=Pe(0,0,1),e.lookDir=Be(),e.fullscreen=!1,e.projMatrix=ri(),e.viewMatrix=ri(),e.panningMatrix=ri(),e.viewOffset=Be(),this.addedCss||(this.addedCss=!0,$("head").append('<link rel="stylesheet" href="//wow.zamimg.com/modelviewer/viewer/viewer.css" type="text/css" />'))}updateProgress(){if(!this.stop){var t=this,e=0,i=0;for(var s in t.downloads)e+=t.downloads[s].total,i+=t.downloads[s].loaded;if(e<=0)t.progressShown&&(t.progressBg.hide(),t.progressBar.hide(),t.progressShown=!1);else{t.progressShown||(t.progressBg.show(),t.progressBar.show(),t.progressShown=!0);var r=i/e;t.progressBar.width(Math.round(t.width*r)+"px")}}}destroy(){var t=this;t.stop=!0,t.canvas&&($(t.canvas).off(),t.canvas.detach(),t.progressBg.detach(),t.progressBar.detach(),t.canvas=t.progressBg=t.progressBar=null),t.clearBackground(),t.actors=[]}method(t,e){if("isBackgroundLoaded"===t)return this.bgImgLoaded;if("setBackground"!==t){if(this.actors.length>0&&this.actors[0]){const i=this.actors[0][t];return i?i.apply(this.actors[0],e):void WH.debug("Unknown viewer method",t,"args",e)}this.actorPromises.length>0&&this.actorPromises[0]&&(this.actorPromises[0]=this.actorPromises[0].then(i=>{const s=i[t];if(s)return s.apply(i,e),i;WH.debug("Unknown viewer method",t,"args",e)}))}else this.setBackground(e[0])}getTime(){return window.performance&&window.performance.now?window.performance.now():Date.now()}draw(t){var e,i=this,s=i.context;if(i.delta=.001*(t-i.time),i.time=t,i.currFrame++,this.doUpdateBounds&&i.actors.length>0){let[t,s]=[Be(),Be()];for(e=0;e<i.actors.length;++e){const[r,n]=i.actors[e].getBounds();r&&He(t,t,r),n&&qe(s,s,n)}const r=Be(),n=Be();Ne(r,s,t),Xe(n,t,r,.5);let a=r[2],o=r[0],h=r[1];const l=this.width/this.height,u=2*Math.tan(this.fov/2*.0174532925),c=1.2*a/u,d=1.2*o/(u*l);this.distance=Math.max(Math.max(c,d),2*h),Ge(this.translationFromModel,n[0],-n[2],0),this.doUpdateBounds=!1}for(i.updateCamera(),s.bindFramebuffer(s.FRAMEBUFFER,null),s.viewport(0,0,i.width,i.height),s.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],0),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),i.bgTexture&&i.program&&(s.useProgram(i.program),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,i.bgTexture),s.uniform1i(i.uTexture,0),s.uniform4f(i.uBGTransform,i.viewer.options.bgPosition[0]||0,i.viewer.options.bgPosition[1]||0,i.viewer.options.bgScale[0]||1,i.viewer.options.bgScale[1]||1),i.options.backgroundRotatation&&(s.uniform1f(i.uRotation,i.options.backgroundRotatation),s.uniform2f(i.uResolution,i.width,i.height)),s.bindBuffer(s.ARRAY_BUFFER,i.vb),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null),s.enableVertexAttribArray(i.aPosition),s.vertexAttribPointer(i.aPosition,2,s.FLOAT,!1,16,0),s.enableVertexAttribArray(i.aTexCoord),s.vertexAttribPointer(i.aTexCoord,2,s.FLOAT,!1,16,8),s.depthMask(!1),s.disable(s.CULL_FACE),s.blendFunc(s.ONE,s.ZERO),s.drawArrays(s.TRIANGLE_STRIP,0,4),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),s.enable(s.CULL_FACE),s.depthMask(!0),s.disableVertexAttribArray(i.aPosition),s.disableVertexAttribArray(i.aTexCoord)),e=0;e<i.actors.length;++e)i.actors[e].b();for(s.viewport(0,0,i.width,i.height),this.gxDevice.e(),e=0;e<i.actors.length;++e)i.actors[e].e(!1);for(e=0;e<i.actors.length;++e)i.actors[e].e(!0);this.gxDevice.a()}setAdaptiveMode(t){this.addaptiveMode=t,t&&$(window).trigger("resize")}setTranslation(t,e,i){this.translation=Pe(t,e,i)}setBackground(t){var e=this;e.bgImgLoaded=!1,e.options.background=t,e.clearBackground(),e.loadBackground()}clearBackground(){var t=this;if(t.context){var e=t.context;t.bgTexture&&e.deleteTexture(t.bgTexture),t.bgTexture=null,t.program&&e.deleteProgram(t.program),t.program=null,t.vb&&e.deleteBuffer(t.vb),t.vs&&e.deleteShader(t.vs),t.fs&&e.deleteShader(t.fs),t.vb=t.vs=t.fs=null}t.bgImg&&(t.bgImg=null)}updateCamera(){var t=this;t.zoom.target+=t.zoom.rateCurrent,t.zoom.rateCurrent*=1-t.zoom.rateAccelerationDecay,t.zoom.target=-Math.max(Math.min(-t.zoom.target,t.zoom.range[1]),t.zoom.range[0]),t.zoom.current+=(t.zoom.target-t.zoom.current)*t.zoom.interpolationRate;var e=t.distance*Math.pow(t.zoom.rateStep+1,-t.zoom.current),i=t.azimuth,s=t.zenith;1==t.up[2]?(t.eye[0]=-e*Math.sin(s)*Math.cos(i)+t.target[0],t.eye[1]=-e*Math.sin(s)*Math.sin(i)+t.target[1],t.eye[2]=-e*Math.cos(s)+t.target[2]):(t.eye[0]=-e*Math.sin(s)*Math.cos(i)+t.target[0],t.eye[1]=-e*Math.cos(s)+t.target[1],t.eye[2]=-e*Math.sin(s)*Math.sin(i)+t.target[2]),Ne(t.lookDir,t.target,t.eye),Ke(t.lookDir,t.lookDir),function(t,e,i,s){var r,n,a,o,h,l,u,c,d,f,g=e[0],_=e[1],b=e[2],p=s[0],m=s[1],x=s[2],v=i[0],T=i[1],w=i[2];Math.abs(g-v)<Ue&&Math.abs(_-T)<Ue&&Math.abs(b-w)<Ue?oi(t):(u=g-v,c=_-T,d=b-w,r=m*(d*=f=1/Math.hypot(u,c,d))-x*(c*=f),n=x*(u*=f)-p*d,a=p*c-m*u,(f=Math.hypot(r,n,a))?(r*=f=1/f,n*=f,a*=f):(r=0,n=0,a=0),o=c*a-d*n,h=d*r-u*a,l=u*n-c*r,(f=Math.hypot(o,h,l))?(o*=f=1/f,h*=f,l*=f):(o=0,h=0,l=0),t[0]=r,t[1]=o,t[2]=u,t[3]=0,t[4]=n,t[5]=h,t[6]=c,t[7]=0,t[8]=a,t[9]=l,t[10]=d,t[11]=0,t[12]=-(r*g+n*_+a*b),t[13]=-(o*g+h*_+l*b),t[14]=-(u*g+c*_+d*b),t[15]=1)}(t.viewMatrix,t.eye,t.target,t.up),oi(t.panningMatrix),1==t.up[2]?Ge(t.viewOffset,t.translation[0],-t.translation[1],0):Ge(t.viewOffset,t.translation[0],0,t.translation[1]),Le(t.viewOffset,t.viewOffset,this.translationFromModel),ci(t.panningMatrix,t.panningMatrix,t.viewOffset),ui(t.viewMatrix,t.panningMatrix,t.viewMatrix)}init(){var t,e=this,i=e.context;if(this.blackPixelTexture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.blackPixelTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([0,0,0,255])),i.bindTexture(i.TEXTURE_2D,null),this.greenPixelTexture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.greenPixelTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([0,255,0,255])),i.bindTexture(i.TEXTURE_2D,null),mi(e.projMatrix,.0174532925*e.fov,e.viewer.aspect,.1,500),e.updateCamera(),i.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],0),i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.enable(i.BLEND),e.options.models||e.options.items){e.actorPromises=[];var s=[].concat(e.options.models);if(s.length>0){const i=e.options.mount,r=e.options.shouldersOverride;for(t=0;t<s.length;++t){const n=fl.b(this,s[t].type,s[t].id).then(t=>(i&&i.id&&t instanceof Kh&&t.m(i.id),t instanceof hl&&t.setShouldersOverride(r),e.actors.push(t),t)).then(t=>t);e.actorPromises.push(n)}}}!function t(){if(!e.stop&&(window.requestAnimationFrame(t),e.gxDevice)){var s=e.getTime();if(!1!==e.makeDataURL){if(e.canvas[0].toDataURL){var r=e.clearColor,n=e.bgTexture;e.options.transparent&&(e.bgTexture=null,e.clearColor=Pe(0,0,0)),e.draw(s);var a=e.width*e.height*4,o=new Uint8Array(a);i.readPixels(0,0,e.width,e.height,i.RGBA,i.UNSIGNED_BYTE,o);let t=null;e.options.transparent?(e.clearColor=Pe(1,1,1),e.draw(s),t=new Uint8Array(a),i.readPixels(0,0,e.width,e.height,i.RGBA,i.UNSIGNED_BYTE,t)):t=o;for(var h=new Uint8Array(a),l=0,u=0;u<e.height;u++)for(var c=0;c<e.width;c++){l=4*(u*e.width+c);var d=4*((e.height-1-u)*e.width+c),f=o[l+0],g=o[l+1],_=o[l+2],b=t[l+0],p=t[l+1],m=t[l+2],x=.001,v=1-(b-f+x)/255,T=1-(p-g+x)/255,w=1-(m-_+x)/255,y=Math.max(0,Math.min(1,(v+T+w)/3));y<.05&&(f+g+_)/3<16&&(f=b,g=p,_=m,y=0),h[d+0]=f,h[d+1]=g,h[d+2]=_,h[d+3]=Math.round(255*y)}var E=document.createElement("canvas"),A=E.getContext("2d");E.width=e.width,E.height=e.height;var C=A.createImageData(e.width,e.height);C.data.set(h),A.putImageData(C,0,0),e.screenshotDataURL=E.toDataURL.apply(E,e.makeDataURL),e.screenshotCallback&&(e.screenshotCallback(),e.screenshotCallback=null),e.clearColor=r,e.bgTexture=n}e.makeDataURL=!1}e.draw(s)}}()}onDoubleClick(t){wi.isFullscreen()?wi.exitFullscreen():wi.requestFullscreen(this.canvas[0])}onFullscreen(t){let e=this;if(e.viewer.container)if(!e.fullscreen&&wi.isFullscreen()||this.addaptiveMode){if(e.restoreWidth=e.width,e.restoreHeight=e.height,e.fullscreen=!0,wi.isFullscreen()){var i=$(window);let t=window.screen.width||i.width(),e=window.screen.height||i.height();this.onResize(t,e,t/e)}else if(this.addaptiveMode){var s=e.viewer.container;this.onResize(s.width(),s.height(),s.width()/s.height())}}else e.fullscreen&&!wi.isFullscreen()&&(e.fullscreen=!1,this.onResize(e.restoreWidth,e.restoreHeight,e.viewer.aspect))}onResize(t,e,i){this.resize(t,e),mi(this.projMatrix,.0174532925*this.fov,i,.1,5e3)}onMouseDown(t){let e=this;3==t.which||t.ctrlKey?e.rightMouseDown=!0:e.mouseDown=!0,"touchstart"==t.type?(e.mouseX=t.originalEvent.touches[0].clientX,e.mouseY=t.originalEvent.touches[0].clientY):(e.mouseX=t.clientX,e.mouseY=t.clientY),$("body").addClass("unselectable"),t.preventDefault()}onMouseWheel(t){if(!this.options.wheelEventValidation||this.options.wheelEventValidation.call(this,t))return this.zoom.rateCurrent+=t.originalEvent.wheelDelta>0?1:-1,t.preventDefault(),!1}onMouseUp(t){let e=this;(e.mouseDown||e.rightMouseDown)&&($("body").removeClass("unselectable"),e.mouseDown=!1,e.rightMouseDown=!1)}onMouseMove(t){let e=this;if((e.mouseDown||e.rightMouseDown)&&void 0!==e.mouseX){var i,s;"touchmove"==t.type?(i=t.originalEvent.touches[0].clientX,s=t.originalEvent.touches[0].clientY):(i=t.clientX,s=t.clientY);var r=(i-e.mouseX)/e.width*Math.PI*2,n=(s-e.mouseY)/e.width*Math.PI*2;if(e.mouseDown){1==e.up[2]?e.azimuth-=r:e.azimuth+=r,e.zenith+=n;for(var a=2*Math.PI;e.azimuth<0;)e.azimuth+=a;for(;e.azimuth>a;)e.azimuth-=a;e.zenith<1e-4&&(e.zenith=1e-4),e.zenith>=Math.PI&&(e.zenith=Math.PI-1e-4)}else e.translation[0]+=r,e.translation[1]+=n;e.mouseX=i,e.mouseY=s,t.stopPropagation()}}resize(t,e){var i=this;if(i.width!==t||i.height!==e){if(i.fullscreen||i.viewer.container.css({height:e+"px",position:"relative"}),i.width=t,i.height=e,i.canvas)i.canvas.attr({width:t,height:e}),i.canvas.css({width:t+"px",height:e+"px"}),i.context.viewport(0,0,i.width,i.height);else{if(i.canvas=$("<canvas/>"),i.canvas.attr({width:t,height:e}),i.viewer.container.append(i.canvas),i.context=i.canvas[0].getContext("webgl",{alpha:!0,premultipliedAlpha:!1})||i.canvas[0].getContext("experimental-webgl",{alpha:!0,premultipliedAlpha:!1}),i.progressBg=$("<div/>",{css:{display:"none",position:"absolute",bottom:0,left:0,right:0,height:"10px",backgroundColor:"#000"}}),i.progressBar=$("<div/>",{css:{display:"none",position:"absolute",bottom:0,left:0,width:0,height:"10px",backgroundColor:"#ccc"}}),i.viewer.container.append(i.progressBg),i.viewer.container.append(i.progressBar),!i.context)return alert("No WebGL support, sorry! You should totally use Chrome."),i.canvas.detach(),void(i.canvas=null);const s=[.35,.35,.35,1],r=[1,1,1,1],n=[.35,.35,.35,1],a=Be(),o=Be(),h=Be();Ke(a,[5,-3,3]),Ke(o,[5,5,5]),Ke(h,[-5,-5,-5]);const l={uCameraPos:i.eye,uViewMatrix:i.viewMatrix,uProjMatrix:i.projMatrix,uAmbientColor:s,uPrimaryColor:r,uSecondaryColor:n,uLightDir1:a,uLightDir2:o,uLightDir3:h};this.gxDevice=new ws(i.context,l),this.renderer=this.gxDevice.c(),i.canvas.off("mousedown.webgl touchstart.webgl").on("mousedown.webgl touchstart.webgl",i.onMouseDown.bind(i)).off("wheel.webgl").on("wheel.webgl",i.onMouseWheel.bind(i)).off("dblclick.webgl").on("dblclick.webgl",i.onDoubleClick.bind(i)).off("contextmenu.webgl").on("contextmenu.webgl",i.onContextMenu.bind(i));let u=0,c=0,d=0;i.canvas.off("touchend.webgl").on("touchend.webgl",function(t){const e=t.originalEvent;if(!e||1!==e.changedTouches.length)return;const s=e.changedTouches[0],r=(new Date).getTime(),n=r-u,a=s.clientX-c,o=s.clientY-d,h=Math.sqrt(a*a+o*o);u=r,c=s.clientX,d=s.clientY,n<300&&h<30&&(t.preventDefault(),i.onDoubleClick.call(i,e))}),$(window).off("resize.webgl").on("resize.webgl",i.onFullscreen.bind(i)),$(document).off("mouseup.webgl touchend.webgl").on("mouseup.webgl touchend.webgl",i.onMouseUp.bind(i)).off("mousemove.webgl touchmove.webgl").on("mousemove.webgl touchmove.webgl",i.onMouseMove.bind(i)),i.onFullscreen(null)}i.options.background&&i.loadBackground()}}loadBackground(){var t=this,e=t.context;const i=function(){t.vb=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t.vb),e.bufferData(e.ARRAY_BUFFER,new Float32Array(16),e.DYNAMIC_DRAW);var i,s=t.compileShader(e.VERTEX_SHADER,"    attribute vec2 aPosition;    attribute vec2 aTexCoord;        varying vec2 vTexCoord;        void main(void) {        vTexCoord = aTexCoord;        gl_Position = vec4(aPosition, 0, 1);    }    ");i=t.options.backgroundRotatation?t.compileShader(e.FRAGMENT_SHADER,"\tprecision mediump float;    varying vec2 vTexCoord;    uniform sampler2D uTexture;    uniform vec2 uResolution;    uniform vec4 uBGTransform;    uniform float uRotation;    mat3 getTransform(vec2 pos, vec2 scale, float rotation, vec2 center) {        float c = cos(rotation);        float s = sin(rotation);        return mat3(            scale.x * c, scale.x * s, - scale.x * ( c * center.x + s * center.y ) + center.x + pos.x,            -scale.y * s, scale.y * c, - scale.y * ( - s * center.x + c * center.y ) + center.y + pos.y,            0.0, 0.0, 1.0        );    }    void main(void) {        vec2 uv = gl_FragCoord.xy / uResolution.xy;        mat3 transform = getTransform(uBGTransform.xy, uBGTransform.zw, uRotation, vec2(0.5));        uv = (vec3(uv, 1.0) * transform).xy;        gl_FragColor = texture2D(uTexture, uv);\t}"):t.compileShader(e.FRAGMENT_SHADER,"    precision mediump float;    varying vec2 vTexCoord;        uniform sampler2D uTexture;    uniform vec4 uBGTransform;        void main(void) {        gl_FragColor = texture2D(uTexture, vTexCoord.xy * uBGTransform.zw + uBGTransform.xy);    }    ");var r=e.createProgram();e.attachShader(r,s),e.attachShader(r,i),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)?(t.vs=s,t.fs=i,t.program=r,t.uTexture=e.getUniformLocation(r,"uTexture"),t.aPosition=e.getAttribLocation(r,"aPosition"),t.aTexCoord=e.getAttribLocation(r,"aTexCoord"),t.uBGTransform=e.getUniformLocation(r,"uBGTransform"),t.uRotation=e.getUniformLocation(r,"uRotation"),t.uResolution=e.getUniformLocation(r,"uResolution")):console.error("Error linking shaders")},s=function(){var i=t.width/t.bgImg.width,s=t.height/t.bgImg.height;const r=[-1,-1,0,s,1,-1,i,s,-1,1,0,0,1,1,i,0];e.bindBuffer(e.ARRAY_BUFFER,t.vb),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(r))};t.bgImg?t.bgImg.loaded&&(t.vb||i(),s()):(t.bgImg=new Image,t.bgImg.crossOrigin="",t.bgImg.onload=function(){var r;null===(r=t.bgImg)||void 0===r||(r.loaded=!0),t.bgImg&&(t.bgTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,t.bgTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.bgImg),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),t.vb||i(),s(),t.bgImgLoaded=!0)},t.bgImg.onerror=function(){t.bgImg=null},t.bgImg.src=t.options.contentPath+t.options.background,t.viewer.options.bgPosition=t.options.bgPosition||[0,0],t.viewer.options.bgScale=t.options.bgScale||[1,1])}compileShader(t,e){var i=this.context,s=i.createShader(t);if(i.shaderSource(s,e),i.compileShader(s),!i.getShaderParameter(s,i.COMPILE_STATUS))throw"Shader compile error: "+i.getShaderInfoLog(s);return s}getTexture(t){if(this.textureCache.has(t)){var e=this.textureCache.get(t);if(e.e||e.l)return e}const i=new ys(this,t);return this.textureCache.set(t,i),i}};let _l={Types:Ms};const bl=Object.assign(wi,{Tools:De,WebGL:gl,WEBGL:1,WOW:2,FLASH:2,Wow:_l});window.ZamModelViewer=bl})();